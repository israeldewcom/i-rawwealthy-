<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw Wealthy | Premium Investment Platform v37.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        /* ===== CSS VARIABLES & THEME ===== */
        :root {
            /* Color Palette */
            --primary-color: #7C3AED;
            --primary-dark: #5B21B6;
            --primary-light: #8B5CF6;
            --secondary-color: #10B981;
            --secondary-dark: #059669;
            --accent-blue: #3B82F6;
            --accent-red: #EF4444;
            --accent-orange: #F59E0B;
            --accent-yellow: #FBBF24;
            --dark-bg: #0F172A;
            --dark-card: #1E293B;
            --dark-border: #334155;
            --dark-hover: #2D3748;
            --text-primary: #F8FAFC;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #7C3AED 0%, #3B82F6 100%);
            --gradient-secondary: linear-gradient(135deg, #10B981 0%, #3B82F6 100%);
            --gradient-danger: linear-gradient(135deg, #EF4444 0%, #F59E0B 100%);
            --gradient-success: linear-gradient(135deg, #10B981 0%, #22C55E 100%);
            
            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.6);
            --shadow-glow: 0 0 20px rgba(124, 58, 237, 0.3);
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            --space-xxl: 4rem;
            
            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Z-index */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
        }
        
        /* Dark Theme Overrides */
        [data-theme="dark"] {
            --dark-bg: #0F172A;
            --dark-card: #1E293B;
        }
        
        /* Light Theme */
        [data-theme="light"] {
            --dark-bg: #F1F5F9;
            --dark-card: #FFFFFF;
            --dark-border: #E2E8F0;
            --dark-hover: #F8FAFC;
            --text-primary: #1E293B;
            --text-secondary: #475569;
            --text-muted: #64748B;
        }
        
        /* ===== BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color var(--transition-normal);
        }
        
        /* ===== TYPOGRAPHY ===== */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            line-height: 1.2;
        }
        
        h1 {
            font-size: 2.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        h2 {
            font-size: 2rem;
            margin-bottom: var(--space-md);
        }
        
        h3 {
            font-size: 1.5rem;
        }
        
        p {
            margin-bottom: var(--space-md);
            color: var(--text-secondary);
        }
        
        a {
            color: var(--primary-light);
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        a:hover {
            color: var(--primary-color);
        }
        
        /* ===== LAYOUT UTILITIES ===== */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-md);
        }
        
        .section {
            padding: var(--space-xl) 0;
        }
        
        .section-header {
            margin-bottom: var(--space-xl);
            text-align: center;
        }
        
        /* ===== COMPONENTS ===== */
        
        /* Cards */
        .card {
            background: var(--dark-card);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--dark-border);
            transition: all var(--transition-normal);
            margin-bottom: var(--space-md);
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: var(--space-md);
            margin-bottom: var(--space-md);
            border-bottom: 1px solid var(--dark-border);
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: none;
            outline: none;
            gap: 0.5rem;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-secondary {
            background: var(--dark-card);
            color: var(--text-primary);
            border: 1px solid var(--dark-border);
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: white;
        }
        
        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }
        
        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1rem;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-icon {
            width: 2.5rem;
            height: 2.5rem;
            padding: 0;
            border-radius: var(--radius-full);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: var(--space-lg);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--dark-bg);
            border: 2px solid var(--dark-border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            font-size: 0.875rem;
            transition: all var(--transition-fast);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }
        
        .form-control::placeholder {
            color: var(--text-muted);
        }
        
        .input-group {
            position: relative;
        }
        
        .input-group .form-control {
            padding-left: 2.5rem;
        }
        
        .input-group-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent-orange);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--accent-red);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent-blue);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        /* Alerts */
        .alert {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            border-left: 4px solid;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }
        
        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--accent-red);
            color: var(--accent-red);
        }
        
        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--accent-orange);
            color: var(--accent-orange);
        }
        
        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: var(--z-modal);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
            padding: var(--space-md);
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: relative;
            background: var(--dark-card);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform var(--transition-normal);
            border: 1px solid var(--dark-border);
            box-shadow: var(--shadow-xl);
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .modal-close:hover {
            background: var(--dark-hover);
            color: var(--text-primary);
        }
        
        /* Tables */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--radius-md);
            border: 1px solid var(--dark-border);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        .table th {
            background: var(--dark-hover);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--dark-border);
        }
        
        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .table tbody tr:hover {
            background: var(--dark-hover);
        }
        
        .table tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: var(--z-fixed);
            border-bottom: 1px solid var(--dark-border);
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem var(--space-md);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .logo-icon {
            width: 2rem;
            height: 2rem;
            border-radius: var(--radius-md);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .nav-menu {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }
        
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            color: var(--text-secondary);
            transition: all var(--transition-fast);
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: var(--text-primary);
            background: var(--dark-card);
        }
        
        .nav-user {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .user-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius-full);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            cursor: pointer;
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background: var(--dark-card);
            z-index: var(--z-modal);
            padding: var(--space-xl);
            transition: left var(--transition-normal);
            overflow-y: auto;
            border-right: 1px solid var(--dark-border);
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: calc(var(--z-modal) - 1);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--dark-border);
        }
        
        .sidebar-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-item {
            margin-bottom: 0.5rem;
        }
        
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            transition: all var(--transition-fast);
        }
        
        .sidebar-link:hover,
        .sidebar-link.active {
            color: var(--text-primary);
            background: var(--dark-hover);
        }
        
        .sidebar-link i {
            width: 1.25rem;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            padding-top: 80px;
            min-height: 100vh;
        }
        
        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .stat-card {
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
        }
        
        .stat-icon {
            width: 3rem;
            height: 3rem;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--space-md);
            font-size: 1.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .stat-change {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }
        
        .stat-change.positive {
            color: var(--secondary-color);
        }
        
        .stat-change.negative {
            color: var(--accent-red);
        }
        
        /* Investment Plans */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .plan-card {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
        }
        
        .plan-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .plan-badge.popular {
            background: var(--gradient-primary);
            color: white;
        }
        
        .plan-header {
            margin-bottom: var(--space-lg);
        }
        
        .plan-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            margin-bottom: var(--space-md);
        }
        
        .plan-features {
            list-style: none;
            margin-bottom: var(--space-lg);
        }
        
        .plan-features li {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }
        
        .plan-features li i {
            color: var(--secondary-color);
        }
        
        .plan-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: var(--dark-hover);
            border-radius: var(--radius-md);
        }
        
        .plan-stat {
            text-align: center;
        }
        
        .plan-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .plan-stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: var(--space-lg);
        }
        
        /* Loader */
        .loader {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid var(--dark-border);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }
        
        .loader-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Notifications */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: var(--z-popover);
            max-width: 400px;
        }
        
        .notification {
            background: var(--dark-card);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            box-shadow: var(--shadow-lg);
            border-left: 4px solid;
            transform: translateX(100%);
            opacity: 0;
            animation: slideIn 0.3s forwards;
            border: 1px solid var(--dark-border);
        }
        
        @keyframes slideIn {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            border-left-color: var(--secondary-color);
        }
        
        .notification.error {
            border-left-color: var(--accent-red);
        }
        
        .notification.warning {
            border-left-color: var(--accent-orange);
        }
        
        .notification.info {
            border-left-color: var(--accent-blue);
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1rem;
        }
        
        /* Footer */
        .footer {
            background: var(--dark-card);
            padding: var(--space-xl) 0;
            margin-top: var(--space-xxl);
            border-top: 1px solid var(--dark-border);
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-xl);
            margin-bottom: var(--space-xl);
        }
        
        .footer-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 0.5rem;
        }
        
        .footer-links a {
            color: var(--text-secondary);
            transition: color var(--transition-fast);
        }
        
        .footer-links a:hover {
            color: var(--text-primary);
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: var(--space-lg);
            border-top: 1px solid var(--dark-border);
            color: var(--text-muted);
            font-size: 0.875rem;
        }
        
        /* Page Sections */
        .page-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Progress Bars */
        .progress {
            height: 0.5rem;
            background: var(--dark-border);
            border-radius: var(--radius-full);
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width 1s ease;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: var(--space-lg);
            border-bottom: 1px solid var(--dark-border);
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all var(--transition-fast);
        }
        
        .tab:hover,
        .tab.active {
            color: var(--text-primary);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* File Upload */
        .file-upload {
            border: 2px dashed var(--dark-border);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            text-align: center;
            transition: all var(--transition-fast);
        }
        
        .file-upload:hover {
            border-color: var(--primary-color);
            background: var(--dark-hover);
        }
        
        .file-upload input[type="file"] {
            display: none;
        }
        
        .file-upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background: var(--dark-card);
            color: var(--text-primary);
            text-align: center;
            border-radius: var(--radius-md);
            padding: 0.5rem;
            position: absolute;
            z-index: var(--z-tooltip);
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            border: 1px solid var(--dark-border);
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--dark-border);
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .plans-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: var(--space-lg);
            }
            
            .container {
                padding: 0 var(--space-sm);
            }
            
            .sidebar {
                width: 100%;
                left: -100%;
            }
            
            .table-responsive {
                font-size: 0.875rem;
            }
        }
        
        @media (max-width: 576px) {
            .card {
                padding: var(--space-md);
            }
            
            .btn {
                padding: 0.625rem 1.25rem;
            }
            
            .modal-content {
                margin: var(--space-sm);
                padding: var(--space-md);
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
        }
        
        /* Utility Classes */
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .text-success {
            color: var(--secondary-color);
        }
        
        .text-danger {
            color: var(--accent-red);
        }
        
        .text-warning {
            color: var(--accent-orange);
        }
        
        .text-primary {
            color: var(--primary-color);
        }
        
        .text-muted {
            color: var(--text-muted);
        }
        
        .bg-primary {
            background: var(--gradient-primary);
        }
        
        .bg-success {
            background: var(--gradient-success);
        }
        
        .d-none {
            display: none !important;
        }
        
        .d-flex {
            display: flex;
        }
        
        .d-block {
            display: block;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .align-center {
            align-items: center;
        }
        
        .flex-wrap {
            flex-wrap: wrap;
        }
        
        .gap-1 {
            gap: 0.5rem;
        }
        
        .gap-2 {
            gap: 1rem;
        }
        
        .gap-3 {
            gap: 1.5rem;
        }
        
        .mb-0 {
            margin-bottom: 0;
        }
        
        .mb-1 {
            margin-bottom: 0.5rem;
        }
        
        .mb-2 {
            margin-bottom: 1rem;
        }
        
        .mb-3 {
            margin-bottom: 1.5rem;
        }
        
        .mb-4 {
            margin-bottom: 2rem;
        }
        
        .mt-0 {
            margin-top: 0;
        }
        
        .mt-1 {
            margin-top: 0.5rem;
        }
        
        .mt-2 {
            margin-top: 1rem;
        }
        
        .mt-3 {
            margin-top: 1.5rem;
        }
        
        .mt-4 {
            margin-top: 2rem;
        }
        
        .p-0 {
            padding: 0;
        }
        
        .p-1 {
            padding: 0.5rem;
        }
        
        .p-2 {
            padding: 1rem;
        }
        
        .p-3 {
            padding: 1.5rem;
        }
        
        .rounded {
            border-radius: var(--radius-md);
        }
        
        .rounded-lg {
            border-radius: var(--radius-lg);
        }
        
        .shadow {
            box-shadow: var(--shadow-md);
        }
        
        .w-100 {
            width: 100%;
        }
        
        .h-100 {
            height: 100%;
        }
        
        .position-relative {
            position: relative;
        }
        
        .position-absolute {
            position: absolute;
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle position-fixed" style="bottom: 20px; right: 20px; z-index: 1000;">
        <button id="themeToggle" class="btn btn-primary btn-icon">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-container">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-gem"></i>
                    </div>
                    <span>Raw Wealthy</span>
                </div>
                
                <ul class="nav-menu">
                    <li><a href="#dashboard" class="nav-link active" data-section="dashboard">Dashboard</a></li>
                    <li><a href="#investments" class="nav-link" data-section="investments">Investments</a></li>
                    <li><a href="#deposits" class="nav-link" data-section="deposits">Deposits</a></li>
                    <li><a href="#withdrawals" class="nav-link" data-section="withdrawals">Withdrawals</a></li>
                    <li><a href="#transactions" class="nav-link" data-section="transactions">Transactions</a></li>
                    <li><a href="#kyc" class="nav-link" data-section="kyc">KYC</a></li>
                    <li><a href="#support" class="nav-link" data-section="support">Support</a></li>
                    <li><a href="#referrals" class="nav-link" data-section="referrals">Referrals</a></li>
                    <li><a href="#profile" class="nav-link" data-section="profile">Profile</a></li>
                    <li class="admin-nav d-none"><a href="#admin" class="nav-link" data-section="admin">Admin</a></li>
                </ul>
                
                <div class="nav-user">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-gem"></i>
                </div>
                <span>Raw Wealthy</span>
            </div>
            <button class="sidebar-close" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <ul class="sidebar-menu">
            <li class="sidebar-item">
                <a href="#dashboard" class="sidebar-link active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#investments" class="sidebar-link" data-section="investments">
                    <i class="fas fa-chart-line"></i>
                    <span>Investments</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#deposits" class="sidebar-link" data-section="deposits">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Deposits</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#withdrawals" class="sidebar-link" data-section="withdrawals">
                    <i class="fas fa-wallet"></i>
                    <span>Withdrawals</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#transactions" class="sidebar-link" data-section="transactions">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transactions</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#kyc" class="sidebar-link" data-section="kyc">
                    <i class="fas fa-id-card"></i>
                    <span>KYC Verification</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#support" class="sidebar-link" data-section="support">
                    <i class="fas fa-headset"></i>
                    <span>Support</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#referrals" class="sidebar-link" data-section="referrals">
                    <i class="fas fa-users"></i>
                    <span>Referrals</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#profile" class="sidebar-link" data-section="profile">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
            </li>
            <li class="sidebar-item admin-nav d-none">
                <a href="#admin" class="sidebar-link" data-section="admin">
                    <i class="fas fa-cog"></i>
                    <span>Admin Panel</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="#logout" class="sidebar-link" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
        
        <div class="sidebar-footer mt-4 p-3">
            <div class="text-muted small">
                <div>Raw Wealthy v37.0</div>
                <div>Â© 2024 All Rights Reserved</div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Login Page (Default) -->
        <section id="login" class="page-section active">
            <div class="container">
                <div class="row justify-center" style="min-height: 80vh; align-items: center;">
                    <div class="col-md-6 col-lg-4">
                        <div class="card">
                            <div class="card-header text-center">
                                <div class="logo mb-3">
                                    <div class="logo-icon" style="width: 3rem; height: 3rem;">
                                        <i class="fas fa-gem"></i>
                                    </div>
                                </div>
                                <h3>Welcome Back</h3>
                                <p class="text-muted">Sign in to your account</p>
                            </div>
                            <div class="card-body">
                                <form id="loginForm">
                                    <div class="form-group">
                                        <label class="form-label">Email Address</label>
                                        <div class="input-group">
                                            <i class="input-group-icon fas fa-envelope"></i>
                                            <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Password</label>
                                        <div class="input-group">
                                            <i class="input-group-icon fas fa-lock"></i>
                                            <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                                        </div>
                                    </div>
                                    <div class="form-group mb-4">
                                        <div class="d-flex justify-between align-center">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="rememberMe">
                                                <label class="form-check-label" for="rememberMe">Remember me</label>
                                            </div>
                                            <a href="#forgot-password" class="text-primary small">Forgot password?</a>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-block btn-lg mb-3">
                                        <i class="fas fa-sign-in-alt"></i> Sign In
                                    </button>
                                    <div class="text-center">
                                        <p class="text-muted">Don't have an account? <a href="#register" class="text-primary">Sign up</a></p>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Register Page -->
        <section id="register" class="page-section">
            <div class="container">
                <div class="row justify-center" style="min-height: 80vh; align-items: center;">
                    <div class="col-md-8 col-lg-6">
                        <div class="card">
                            <div class="card-header text-center">
                                <h3>Create Account</h3>
                                <p class="text-muted">Join Raw Wealthy and start investing</p>
                            </div>
                            <div class="card-body">
                                <form id="registerForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Full Name</label>
                                                <input type="text" class="form-control" id="registerName" placeholder="Enter your full name" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Email Address</label>
                                                <input type="email" class="form-control" id="registerEmail" placeholder="Enter your email" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control" id="registerPhone" placeholder="Enter your phone number" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Referral Code (Optional)</label>
                                                <input type="text" class="form-control" id="registerReferral" placeholder="Enter referral code">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Password</label>
                                                <input type="password" class="form-control" id="registerPassword" placeholder="Create a password" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Confirm Password</label>
                                                <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Confirm password" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="termsAgreement" required>
                                            <label class="form-check-label" for="termsAgreement">
                                                I agree to the <a href="terms.html" class="text-primary">Terms of Service</a> and <a href="#" class="text-primary">Privacy Policy</a>
                                            </label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-block btn-lg mb-3">
                                        <i class="fas fa-user-plus"></i> Create Account
                                    </button>
                                    <div class="text-center">
                                        <p class="text-muted">Already have an account? <a href="#login" class="text-primary">Sign in</a></p>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Page -->
        <section id="dashboard" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>Dashboard</h1>
                    <p class="text-muted">Welcome back, <span id="userGreeting">User</span>! Here's your investment overview.</p>
                </div>
                
                <!-- Quick Stats -->
                <div class="stats-grid mb-4">
                    <div class="stat-card">
                        <div class="stat-icon bg-primary">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-value" id="totalBalance">â¦ 0.00</div>
                        <div class="stat-label">Total Balance</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>Loading...</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 100%);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-value" id="activeInvestments">â¦ 0.00</div>
                        <div class="stat-label">Active Investments</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>Loading...</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--gradient-success);">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-value" id="totalEarnings">â¦ 0.00</div>
                        <div class="stat-label">Total Earnings</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>Loading...</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="totalReferrals">0</div>
                        <div class="stat-label">Total Referrals</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>Loading...</span>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Recent Activity -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Recent Activity</h3>
                                <a href="#transactions" class="btn btn-sm btn-secondary">View All</a>
                            </div>
                            <div class="card-body">
                                <div id="recentActivity">
                                    <div class="text-center py-4">
                                        <div class="loader"></div>
                                        <p class="text-muted mt-2">Loading activity...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Investment Performance -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Investment Performance</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="investmentChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Quick Actions -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Quick Actions</h3>
                            </div>
                            <div class="card-body">
                                <div class="d-flex flex-column gap-2">
                                    <button class="btn btn-primary" data-action="make-deposit">
                                        <i class="fas fa-plus-circle"></i> Make Deposit
                                    </button>
                                    <button class="btn btn-success" data-action="new-investment">
                                        <i class="fas fa-chart-line"></i> New Investment
                                    </button>
                                    <button class="btn btn-outline" data-action="request-withdrawal">
                                        <i class="fas fa-wallet"></i> Request Withdrawal
                                    </button>
                                    <button class="btn btn-secondary" data-action="invite-friends">
                                        <i class="fas fa-share-alt"></i> Invite Friends
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notifications -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Notifications</h3>
                                <button class="btn btn-sm btn-secondary" id="markAllRead">Mark All Read</button>
                            </div>
                            <div class="card-body">
                                <div id="notificationsList">
                                    <div class="text-center py-4">
                                        <div class="loader"></div>
                                        <p class="text-muted mt-2">Loading notifications...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Investments Page -->
        <section id="investments" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>Investment Plans</h1>
                    <p class="text-muted">Choose from our premium investment plans with guaranteed returns</p>
                </div>
                
                <!-- Investment Plans -->
                <div class="plans-grid mb-4" id="investmentPlans">
                    <!-- Plans will be loaded dynamically -->
                </div>
                
                <!-- My Investments -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">My Investments</h3>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-secondary" id="refreshInvestments">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-sm btn-primary" data-action="new-investment">
                                <i class="fas fa-plus"></i> New Investment
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Plan</th>
                                        <th>Amount</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Earnings</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="investmentsTable">
                                    <tr>
                                        <td colspan="7" class="text-center py-4">
                                            <div class="loader"></div>
                                            <p class="text-muted mt-2">Loading investments...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Deposits Page -->
        <section id="deposits" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>Deposits</h1>
                    <p class="text-muted">Fund your account to start investing</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Make Deposit -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Make a Deposit</h3>
                            </div>
                            <div class="card-body">
                                <form id="depositForm">
                                    <div class="form-group">
                                        <label class="form-label">Amount (Minimum: â¦3,500)</label>
                                        <div class="input-group">
                                            <i class="input-group-icon fas fa-money-bill"></i>
                                            <input type="number" class="form-control" id="depositAmount" min="3500" value="3500" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Payment Method</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="payment-method-option">
                                                    <input type="radio" id="bankTransfer" name="paymentMethod" value="bank_transfer" checked>
                                                    <label for="bankTransfer" class="d-flex align-center gap-2 p-3 rounded border">
                                                        <i class="fas fa-university"></i>
                                                        <span>Bank Transfer</span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="payment-method-option">
                                                    <input type="radio" id="crypto" name="paymentMethod" value="crypto">
                                                    <label for="crypto" class="d-flex align-center gap-2 p-3 rounded border">
                                                        <i class="fab fa-bitcoin"></i>
                                                        <span>Crypto</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group" id="paymentProofSection">
                                        <label class="form-label">Payment Proof (Screenshot/Receipt)</label>
                                        <div class="file-upload">
                                            <input type="file" id="paymentProof" accept="image/*,.pdf">
                                            <label for="paymentProof" class="file-upload-label">
                                                <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                                <span>Click to upload payment proof</span>
                                                <span class="text-muted small">JPG, PNG or PDF (Max: 10MB)</span>
                                            </label>
                                        </div>
                                        <div id="paymentPreview" class="mt-2 d-none"></div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                                        <i class="fas fa-paper-plane"></i> Submit Deposit Request
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Deposit Stats -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <h4 class="mb-3">Deposit Statistics</h4>
                                <div class="mb-3">
                                    <div class="d-flex justify-between mb-1">
                                        <span>Total Deposits</span>
                                        <span id="totalDeposits" class="font-weight-bold">â¦ 0.00</span>
                                    </div>
                                    <div class="d-flex justify-between mb-1">
                                        <span>Pending Deposits</span>
                                        <span id="pendingDeposits" class="text-warning">â¦ 0.00</span>
                                    </div>
                                    <div class="d-flex justify-between">
                                        <span>Approved Deposits</span>
                                        <span id="approvedDeposits" class="text-success">â¦ 0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bank Details -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Bank Details</h3>
                            </div>
                            <div class="card-body">
                                <div id="bankDetailsInfo">
                                    <p class="text-muted">No bank details added</p>
                                    <button class="btn btn-sm btn-outline w-100" data-action="add-bank-details">
                                        <i class="fas fa-plus"></i> Add Bank Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Deposit History -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Deposit History</h3>
                        <button class="btn btn-sm btn-secondary" id="refreshDeposits">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Reference</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Proof</th>
                                    </tr>
                                </thead>
                                <tbody id="depositsTable">
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <div class="loader"></div>
                                            <p class="text-muted mt-2">Loading deposits...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Withdrawals Page -->
        <section id="withdrawals" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>Withdrawals</h1>
                    <p class="text-muted">Withdraw your earnings to your preferred payment method</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Request Withdrawal -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Request Withdrawal</h3>
                            </div>
                            <div class="card-body">
                                <form id="withdrawalForm">
                                    <div class="form-group">
                                        <label class="form-label">Amount (Minimum: â¦4, 000)</label>
                                        <div class="input-group">
                                            <i class="input-group-icon fas fa-money-bill"></i>
                                            <input type="number" class="form-control" id="withdrawalAmount" min="4000" value="4000" required>
                                        </div>
                                        <small class="text-muted">Available Balance: <span id="availableBalance">â¦ 0.00</span></small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Payment Method</label>
                                        <div class="row">
                                            <div class="col-4">
                                                <div class="payment-method-option">
                                                    <input type="radio" id="withdrawBank" name="withdrawMethod" value="bank_transfer" checked>
                                                    <label for="withdrawBank" class="d-flex flex-column align-center gap-1 p-3 rounded border text-center">
                                                        <i class="fas fa-university fa-2x mb-2"></i>
                                                        <span>Bank</span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="payment-method-option">
                                                    <input type="radio" id="withdrawCrypto" name="withdrawMethod" value="crypto">
                                                    <label for="withdrawCrypto" class="d-flex flex-column align-center gap-1 p-3 rounded border text-center">
                                                        <i class="fab fa-bitcoin fa-2x mb-2"></i>
                                                        <span>Crypto</span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="payment-method-option">
                                                    <input type="radio" id="withdrawPaypal" name="withdrawMethod" value="paypal">
                                                    <label for="withdrawPaypal" class="d-flex flex-column align-center gap-1 p-3 rounded border text-center">
                                                        <i class="fab fa-paypal fa-2x mb-2"></i>
                                                        <span>PayPal</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="withdrawalDetails">
                                        <!-- Dynamic content based on payment method -->
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="alert alert-info">
                                            <div class="d-flex justify-between mb-1">
                                                <span>Platform Fee (10%):</span>
                                                <span id="platformFee">â¦ 350.00</span>
                                            </div>
                                            <div class="d-flex justify-between">
                                                <span>Net Amount:</span>
                                                <span id="netAmount" class="font-weight-bold">â¦ 3,150.00</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                                        <i class="fas fa-paper-plane"></i> Submit Withdrawal Request
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Withdrawal Stats -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <h4 class="mb-3">Withdrawal Statistics</h4>
                                <div class="mb-3">
                                    <div class="d-flex justify-between mb-1">
                                        <span>Total Withdrawals</span>
                                        <span id="totalWithdrawals" class="font-weight-bold">â¦ 0.00</span>
                                    </div>
                                    <div class="d-flex justify-between mb-1">
                                        <span>Pending Withdrawals</span>
                                        <span id="pendingWithdrawals" class="text-warning">â¦ 0.00</span>
                                    </div>
                                    <div class="d-flex justify-between">
                                        <span>Paid Withdrawals</span>
                                        <span id="paidWithdrawals" class="text-success">â¦ 0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Withdrawal Information -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Withdrawal Information</h3>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-clock text-warning mr-2"></i>
                                        <span>Processing: 24-48 hours</span>
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-percentage text-danger mr-2"></i>
                                        <span>Platform Fee: 10%</span>
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-money-bill text-success mr-2"></i>
                                        <span>Minimum: â¦3,500</span>
                                    </li>
                                    <li>
                                        <i class="fas fa-check-circle text-primary mr-2"></i>
                                        <span>KYC Required</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Withdrawal History -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Withdrawal History</h3>
                        <button class="btn btn-sm btn-secondary" id="refreshWithdrawals">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Reference</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="withdrawalsTable">
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <div class="loader"></div>
                                            <p class="text-muted mt-2">Loading withdrawals...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Transactions Page -->
        <section id="transactions" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>Transaction History</h1>
                    <p class="text-muted">Track all your financial activities in one place</p>
                </div>
                
                <!-- Filters -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">Type</label>
                                    <select class="form-control" id="transactionType">
                                        <option value="">All Types</option>
                                        <option value="deposit">Deposit</option>
                                        <option value="withdrawal">Withdrawal</option>
                                        <option value="investment">Investment</option>
                                        <option value="earning">Earning</option>
                                        <option value="referral">Referral</option>
                                        <option value="bonus">Bonus</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" id="transactionStatus">
                                        <option value="">All Status</option>
                                        <option value="completed">Completed</option>
                                        <option value="pending">Pending</option>
                                        <option value="failed">Failed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">From Date</label>
                                    <input type="date" class="form-control" id="fromDate">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">To Date</label>
                                    <input type="date" class="form-control" id="toDate">
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <button class="btn btn-secondary mr-2" id="resetFilters">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                            <button class="btn btn-primary" id="filterTransactions">
                                <i class="fas fa-filter"></i> Apply Filters
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Transaction Summary -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="stat-value" id="totalIncome">â¦ 0.00</div>
                            <div class="stat-label">Total Income</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="stat-value" id="totalExpenses">â¦ 0.00</div>
                            <div class="stat-label">Total Expenses</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-success);">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="stat-value" id="netFlow">â¦ 0.00</div>
                            <div class="stat-label">Net Flow</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);">
                                <i class="fas fa-list"></i>
                            </div>
                            <div class="stat-value" id="totalTransactions">0</div>
                            <div class="stat-label">Total Transactions</div>
                        </div>
                    </div>
                </div>
                
                <!-- Transaction History -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Transactions</h3>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-secondary" id="refreshTransactions">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-sm btn-outline" id="exportTransactions">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Reference</th>
                                        <th>Proof</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTable">
                                    <tr>
                                        <td colspan="7" class="text-center py-4">
                                            <div class="loader"></div>
                                            <p class="text-muted mt-2">Loading transactions...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-4">
                            <button class="btn btn-outline" id="loadMoreTransactions">
                                <i class="fas fa-plus"></i> Load More
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- KYC Page -->
        <section id="kyc" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>KYC Verification</h1>
                    <p class="text-muted">Verify your identity to unlock full platform features</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <!-- KYC Status -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Verification Status</h3>
                            </div>
                            <div class="card-body">
                                <div id="kycStatus">
                                    <div class="text-center py-4">
                                        <div class="loader"></div>
                                        <p class="text-muted mt-2">Loading KYC status...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- KYC Submission -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Submit KYC Documents</h3>
                            </div>
                            <div class="card-body">
                                <form id="kycForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">ID Type</label>
                                                <select class="form-control" id="idType" required>
                                                    <option value="">Select ID Type</option>
                                                    <option value="national_id">National ID</option>
                                                    <option value="passport">Passport</option>
                                                    <option value="driver_license">Driver's License</option>
                                                    <option value="voters_card">Voter's Card</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">ID Number</label>
                                                <input type="text" class="form-control" id="idNumber" placeholder="Enter ID number" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">ID Front Image</label>
                                        <div class="file-upload">
                                            <input type="file" id="idFront" accept="image/*" required>
                                            <label for="idFront" class="file-upload-label">
                                                <i class="fas fa-id-card fa-2x mb-2"></i>
                                                <span>Upload ID Front Image</span>
                                                <span class="text-muted small">JPG, PNG (Max: 10MB)</span>
                                            </label>
                                        </div>
                                        <div id="idFrontPreview" class="mt-2 d-none"></div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">ID Back Image (Optional)</label>
                                        <div class="file-upload">
                                            <input type="file" id="idBack" accept="image/*">
                                            <label for="idBack" class="file-upload-label">
                                                <i class="fas fa-id-card fa-2x mb-2"></i>
                                                <span>Upload ID Back Image</span>
                                                <span class="text-muted small">JPG, PNG (Max: 10MB)</span>
                                            </label>
                                        </div>
                                        <div id="idBackPreview" class="mt-2 d-none"></div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Selfie with ID</label>
                                        <div class="file-upload">
                                            <input type="file" id="selfieWithId" accept="image/*" required>
                                            <label for="selfieWithId" class="file-upload-label">
                                                <i class="fas fa-camera fa-2x mb-2"></i>
                                                <span>Upload Selfie with ID</span>
                                                <span class="text-muted small">JPG, PNG (Max: 10MB)</span>
                                            </label>
                                        </div>
                                        <div id="selfiePreview" class="mt-2 d-none"></div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Address Proof (Optional)</label>
                                        <div class="file-upload">
                                            <input type="file" id="addressProof" accept="image/*,.pdf">
                                            <label for="addressProof" class="file-upload-label">
                                                <i class="fas fa-home fa-2x mb-2"></i>
                                                <span>Upload Address Proof</span>
                                                <span class="text-muted small">JPG, PNG or PDF (Max: 10MB)</span>
                                            </label>
                                        </div>
                                        <div id="addressProofPreview" class="mt-2 d-none"></div>
                                    </div>
                                    
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        <span>Verification typically takes 24-48 hours. Please ensure all documents are clear and readable.</span>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                                        <i class="fas fa-paper-plane"></i> Submit for Verification
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- KYC Benefits -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">KYC Benefits</h3>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li class="mb-3">
                                        <div class="d-flex align-start">
                                            <i class="fas fa-check-circle text-success mt-1 mr-2"></i>
                                            <div>
                                                <strong>Higher Withdrawal Limits</strong>
                                                <p class="text-muted small mb-0">Unlimited withdrawal amounts</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="mb-3">
                                        <div class="d-flex align-start">
                                            <i class="fas fa-check-circle text-success mt-1 mr-2"></i>
                                            <div>
                                                <strong>Faster Processing</strong>
                                                <p class="text-muted small mb-0">Priority withdrawal processing</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="mb-3">
                                        <div class="d-flex align-start">
                                            <i class="fas fa-check-circle text-success mt-1 mr-2"></i>
                                            <div>
                                                <strong>Full Platform Access</strong>
                                                <p class="text-muted small mb-0">Access to all investment plans</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="d-flex align-start">
                                            <i class="fas fa-check-circle text-success mt-1 mr-2"></i>
                                            <div>
                                                <strong>Enhanced Security</strong>
                                                <p class="text-muted small mb-0">Better protection for your account</p>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- KYC Requirements -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Document Requirements</h3>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-id-card text-primary mr-2"></i>
                                        <span>Valid government-issued ID</span>
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-camera text-primary mr-2"></i>
                                        <span>Clear selfie holding ID</span>
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-home text-primary mr-2"></i>
                                        <span>Proof of address (optional)</span>
                                    </li>
                                    <li>
                                        <i class="fas fa-image text-primary mr-2"></i>
                                        <span>Clear, readable documents</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Support Page -->
        <section id="support" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>Support Center</h1>
                    <p class="text-muted">Get help and support for any issues you encounter</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Create Ticket -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Create Support Ticket</h3>
                            </div>
                            <div class="card-body">
                                <form id="supportForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Category</label>
                                                <select class="form-control" id="ticketCategory" required>
                                                    <option value="">Select Category</option>
                                                    <option value="general">General Inquiry</option>
                                                    <option value="technical">Technical Issue</option>
                                                    <option value="investment">Investment</option>
                                                    <option value="withdrawal">Withdrawal</option>
                                                    <option value="deposit">Deposit</option>
                                                    <option value="kyc">KYC Verification</option>
                                                    <option value="account">Account Issue</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Priority</label>
                                                <select class="form-control" id="ticketPriority" required>
                                                    <option value="medium">Medium</option>
                                                    <option value="low">Low</option>
                                                    <option value="high">High</option>
                                                    <option value="urgent">Urgent</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Subject</label>
                                        <input type="text" class="form-control" id="ticketSubject" placeholder="Brief description of your issue" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Message</label>
                                        <textarea class="form-control" id="ticketMessage" rows="5" placeholder="Describe your issue in detail" required></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Attachments (Optional)</label>
                                        <div class="file-upload">
                                            <input type="file" id="ticketAttachments" multiple accept="image/*,.pdf,.doc,.docx">
                                            <label for="ticketAttachments" class="file-upload-label">
                                                <i class="fas fa-paperclip fa-2x mb-2"></i>
                                                <span>Click to upload files</span>
                                                <span class="text-muted small">Max 5 files, 10MB each</span>
                                            </label>
                                        </div>
                                        <div id="attachmentsPreview" class="mt-2"></div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                                        <i class="fas fa-paper-plane"></i> Submit Ticket
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <!-- FAQ -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Frequently Asked Questions</h3>
                            </div>
                            <div class="card-body">
                                <div class="accordion" id="faqAccordion">
                                    <!-- FAQ items will be loaded dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- My Tickets -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">My Tickets</h3>
                                <button class="btn btn-sm btn-secondary" id="refreshTickets">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="ticketsList">
                                    <div class="text-center py-4">
                                        <div class="loader"></div>
                                        <p class="text-muted mt-2">Loading tickets...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact Information -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Contact Information</h3>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled">
                                    <li class="mb-3">
                                        <div class="d-flex align-center">
                                            <i class="fas fa-envelope text-primary mr-3"></i>
                                            <div>
                                                <strong>Email</strong>
                                                <p class="text-muted mb-0">support@rawwealthy.com</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="mb-3">
                                        <div class="d-flex align-center">
                                            <i class="fas fa-phone text-primary mr-3"></i>
                                            <div>
                                                <strong>Phone</strong>
                                                <p class="text-muted mb-0">+234 906 123 4567</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="mb-3">
                                        <div class="d-flex align-center">
                                            <i class="fas fa-clock text-primary mr-3"></i>
                                            <div>
                                                <strong>Response Time</strong>
                                                <p class="text-muted mb-0">24-48 hours</p>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="d-flex align-center">
                                            <i class="fas fa-comments text-primary mr-3"></i>
                                            <div>
                                                <strong>Live Chat</strong>
                                                <p class="text-muted mb-0">Available 9AM-6PM</p>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Referrals Page -->
        <section id="referrals" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>Referral Program</h1>
                    <p class="text-muted">Earn commissions by referring friends and family</p>
                </div>
                
                <!-- Referral Stats -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value" id="totalReferralsCount">0</div>
                            <div class="stat-label">Total Referrals</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-success);">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-value" id="referralEarnings">â¦ 0.00</div>
                            <div class="stat-label">Referral Earnings</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-value" id="commissionRate">10%</div>
                            <div class="stat-label">Commission Rate</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #3B82F6 0%, #10B981 100%);">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-value" id="pendingEarnings">â¦ 0.00</div>
                            <div class="stat-label">Pending Earnings</div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Referral Links -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Your Referral Links</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">Your Referral Code</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="referralCode" readonly>
                                        <button class="btn btn-primary" id="copyReferralCode">
                                            <i class="fas fa-copy"></i> Copy
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Referral Link</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="referralLink" readonly>
                                        <button class="btn btn-primary" id="copyReferralLink">
                                            <i class="fas fa-copy"></i> Copy
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    <span>Earn 10% commission on your referrals' investments. Share your link with friends and family!</span>
                                </div>
                                
                                <!-- Share Buttons -->
                                <div class="d-flex flex-wrap gap-2">
                                    <button class="btn btn-outline" data-share="whatsapp">
                                        <i class="fab fa-whatsapp"></i> WhatsApp
                                    </button>
                                    <button class="btn btn-outline" data-share="telegram">
                                        <i class="fab fa-telegram"></i> Telegram
                                    </button>
                                    <button class="btn btn-outline" data-share="facebook">
                                        <i class="fab fa-facebook"></i> Facebook
                                    </button>
                                    <button class="btn btn-outline" data-share="twitter">
                                        <i class="fab fa-twitter"></i> Twitter
                                    </button>
                                    <button class="btn btn-outline" data-share="email">
                                        <i class="fas fa-envelope"></i> Email
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Referral History -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Referral History</h3>
                                <button class="btn btn-sm btn-secondary" id="refreshReferrals">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Joined</th>
                                                <th>Status</th>
                                                <th>Earnings</th>
                                            </tr>
                                        </thead>
                                        <tbody id="referralsTable">
                                            <tr>
                                                <td colspan="5" class="text-center py-4">
                                                    <div class="loader"></div>
                                                    <p class="text-muted mt-2">Loading referrals...</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- How It Works -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">How It Works</h3>
                            </div>
                            <div class="card-body">
                                <div class="timeline">
                                    <div class="timeline-item mb-3">
                                        <div class="timeline-icon bg-primary">
                                            <i class="fas fa-share-alt"></i>
                                        </div>
                                        <div class="timeline-content">
                                            <h6>Share Your Link</h6>
                                            <p class="text-muted small">Share your referral link with friends</p>
                                        </div>
                                    </div>
                                    <div class="timeline-item mb-3">
                                        <div class="timeline-icon bg-success">
                                            <i class="fas fa-user-plus"></i>
                                        </div>
                                        <div class="timeline-content">
                                            <h6>They Sign Up</h6>
                                            <p class="text-muted small">Friends sign up using your referral code</p>
                                        </div>
                                    </div>
                                    <div class="timeline-item mb-3">
                                        <div class="timeline-icon bg-warning">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                        <div class="timeline-content">
                                            <h6>They Invest</h6>
                                            <p class="text-muted small">They make their first investment</p>
                                        </div>
                                    </div>
                                    <div class="timeline-item">
                                        <div class="timeline-icon bg-danger">
                                            <i class="fas fa-trophy"></i>
                                        </div>
                                        <div class="timeline-content">
                                            <h6>You Earn</h6>
                                            <p class="text-muted small">Earn 10% commission on their investments</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Referral Materials -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Promotion Materials</h3>
                            </div>
                            <div class="card-body">
                                <div class="d-flex flex-column gap-2">
                                    <button class="btn btn-outline" data-material="banner">
                                        <i class="fas fa-image"></i> Download Banner
                                    </button>
                                    <button class="btn btn-outline" data-material="social">
                                        <i class="fas fa-share-alt"></i> Social Media Kit
                                    </button>
                                    <button class="btn btn-outline" data-material="email">
                                        <i class="fas fa-envelope"></i> Email Template
                                    </button>
                                    <button class="btn btn-outline" data-material="video">
                                        <i class="fas fa-video"></i> Promo Video
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Page -->
        <section id="profile" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>My Profile</h1>
                    <p class="text-muted">Manage your account information and settings</p>
                </div>
                
                <div class="row">
                    <div class="col-lg-4">
                        <!-- Profile Card -->
                        <div class="card mb-4">
                            <div class="card-body text-center">
                                <div class="user-avatar-lg mb-3" id="profileAvatar">
                                    <i class="fas fa-user fa-2x"></i>
                                </div>
                                <h3 id="profileName">Loading...</h3>
                                <p class="text-muted" id="profileEmail">Loading...</p>
                                
                                <div class="d-flex justify-center gap-2 mb-3">
                                    <span class="badge badge-success" id="kycBadge">Loading...</span>
                                    <span class="badge badge-primary">Premium</span>
                                </div>
                                
                                <div class="profile-stats">
                                    <div class="d-flex justify-between mb-2">
                                        <span class="text-muted">Member Since</span>
                                        <span id="memberSinceDate">Loading...</span>
                                    </div>
                                    <div class="d-flex justify-between mb-2">
                                        <span class="text-muted">Last Login</span>
                                        <span id="lastLoginDate">Loading...</span>
                                    </div>
                                    <div class="d-flex justify-between">
                                        <span class="text-muted">Account Status</span>
                                        <span class="badge badge-success" id="accountStatus">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Security -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Security</h3>
                            </div>
                            <div class="card-body">
                                <div class="d-flex flex-column gap-2">
                                    <button class="btn btn-outline" data-action="change-password">
                                        <i class="fas fa-lock"></i> Change Password
                                    </button>
                                    <button class="btn btn-outline" data-action="two-factor">
                                        <i class="fas fa-shield-alt"></i> Two-Factor Auth
                                    </button>
                                    <button class="btn btn-outline" data-action="login-history">
                                        <i class="fas fa-history"></i> Login History
                                    </button>
                                    <button class="btn btn-outline text-danger" data-action="delete-account">
                                        <i class="fas fa-trash"></i> Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        <!-- Profile Form -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Personal Information</h3>
                            </div>
                            <div class="card-body">
                                <form id="profileForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Full Name</label>
                                                <input type="text" class="form-control" id="fullName" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Email Address</label>
                                                <input type="email" class="form-control" id="profileEmailInput" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control" id="profilePhone" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Country</label>
                                                <select class="form-control" id="countrySelect">
                                                    <option value="ng">Nigeria</option>
                                                    <option value="gh">Ghana</option>
                                                    <option value="ke">Kenya</option>
                                                    <option value="za">South Africa</option>
                                                    <option value="us">United States</option>
                                                    <option value="uk">United Kingdom</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Risk Tolerance</label>
                                                <select class="form-control" id="riskTolerance">
                                                    <option value="low">Low</option>
                                                    <option value="medium" selected>Medium</option>
                                                    <option value="high">High</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Investment Strategy</label>
                                                <select class="form-control" id="investmentStrategy">
                                                    <option value="conservative">Conservative</option>
                                                    <option value="balanced" selected>Balanced</option>
                                                    <option value="aggressive">Aggressive</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Notification Preferences</label>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="emailNotifications" checked>
                                                    <label class="form-check-label" for="emailNotifications">Email</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="smsNotifications">
                                                    <label class="form-check-label" for="smsNotifications">SMS</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="pushNotifications" checked>
                                                    <label class="form-check-label" for="pushNotifications">Push</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Update Profile
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Bank Details -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Bank Details</h3>
                            </div>
                            <div class="card-body">
                                <form id="bankDetailsForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Bank Name</label>
                                                <input type="text" class="form-control" id="bankName" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Account Name</label>
                                                <input type="text" class="form-control" id="accountName" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Account Number</label>
                                                <input type="text" class="form-control" id="accountNumber" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Bank Code</label>
                                                <input type="text" class="form-control" id="bankCode">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-between align-center mb-3">
                                        <span>Verification Status</span>
                                        <span class="badge badge-warning" id="bankVerificationStatus">Not Verified</span>
                                    </div>
                                    
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-university"></i> Update Bank Details
                                        </button>
                                        <button type="button" class="btn btn-outline" id="verifyBankDetails">
                                            <i class="fas fa-check-circle"></i> Request Verification
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Page -->
        <section id="admin" class="page-section">
            <div class="container">
                <div class="section-header">
                    <h1>Admin Dashboard</h1>
                    <p class="text-muted">Manage users, investments, deposits, withdrawals, and platform settings</p>
                </div>
                
                <!-- Admin Stats -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value" id="adminTotalUsers">0</div>
                            <div class="stat-label">Total Users</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-success);">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-value" id="adminTotalDeposits">â¦ 0.00</div>
                            <div class="stat-label">Total Deposits</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--gradient-danger);">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="stat-value" id="adminTotalWithdrawals">â¦ 0.00</div>
                            <div class="stat-label">Total Withdrawals</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-value" id="adminTotalInvestments">â¦ 0.00</div>
                            <div class="stat-label">Total Investments</div>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Tabs -->
                <div class="card">
                    <div class="card-header">
                        <div class="tabs">
                            <button class="tab active" data-tab="pending">Pending Actions</button>
                            <button class="tab" data-tab="users">Users</button>
                            <button class="tab" data-tab="investments">Investments</button>
                            <button class="tab" data-tab="deposits">Deposits</button>
                            <button class="tab" data-tab="withdrawals">Withdrawals</button>
                            <button class="tab" data-tab="kyc">KYC</button>
                            <button class="tab" data-tab="settings">Settings</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Pending Actions Tab -->
                        <div class="tab-content active" id="pendingTab">
                            <div class="row">
                                <!-- Pending content will be loaded dynamically -->
                            </div>
                        </div>
                        
                        <!-- Users Tab -->
                        <div class="tab-content" id="usersTab">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Balance</th>
                                            <th>Status</th>
                                            <th>KYC</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminUsersTable">
                                        <tr>
                                            <td colspan="6" class="text-center py-4">
                                                <div class="loader"></div>
                                                <p class="text-muted mt-2">Loading users...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Other tabs will be loaded dynamically -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div>
                    <div class="logo mb-3">
                        <div class="logo-icon" style="width: 2rem; height: 2rem;">
                            <i class="fas fa-gem"></i>
                        </div>
                        <span>Raw Wealthy</span>
                    </div>
                    <p class="text-muted small">
                        A premium investment platform that connects you with lucrative raw material investment opportunities.
                    </p>
                    <div class="d-flex gap-2">
                        <a href="#" class="btn btn-icon btn-secondary">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="btn btn-icon btn-secondary">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="btn btn-icon btn-secondary">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="btn btn-icon btn-secondary">
                            <i class="fab fa-linkedin"></i>
                        </a>
                    </div>
                </div>
                
                <div>
                    <h4 class="footer-title">Platform</h4>
                    <ul class="footer-links">
                        <li><a href="#dashboard">Dashboard</a></li>
                        <li><a href="#investments">Investment Plans</a></li>
                        <li><a href="#deposits">Make Deposit</a></li>
                        <li><a href="#withdrawals">Withdraw Funds</a></li>
                        <li><a href="#referrals">Referral Program</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="footer-title">Company</h4>
                    <ul class="footer-links">
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="career.html">Careers</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="blog.html">Press</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="footer-title">Legal</h4>
                    <ul class="footer-links">
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                        <li><a href="cookie.html">Cookie Policy</a></li>
                        <li><a href="risk.html">Risk Disclosure</a></li>
                        <li><a href="aml.html">AML Policy</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="footer-title">Support</h4>
                    <ul class="footer-links">
                        <li><a href="#support">Help Center</a></li>
                        <li><a href="#support">FAQ</a></li>
                        <li><a href="#support">Contact Support</a></li>
                        <li><a href="#support">System Status</a></li>
                        <li><a href="#support">Documentation</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Raw Wealthy. All rights reserved. v37.0</p>
                <p class="text-muted small">This platform is for demonstration purposes only. Investments carry risk.</p>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div class="modal" id="investmentModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Invest in <span id="modalPlanName">Plan</span></h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="investmentModalForm">
                    <div class="form-group">
                        <label class="form-label">Investment Amount</label>
                        <div class="input-group">
                            <i class="input-group-icon fas fa-money-bill"></i>
                            <input type="number" class="form-control" id="modalInvestmentAmount" required>
                        </div>
                        <small class="text-muted">Minimum: <span id="modalMinAmount">â¦ 0.00</span></small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Payment Method</label>
                        <select class="form-control" id="modalPaymentMethod">
                            <option value="wallet">From Wallet</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="crypto">Crypto</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="autoRenew">
                            <label class="form-check-label" for="autoRenew">Auto-renew this investment</label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="modalPaymentProofSection">
                        <label class="form-label">Payment Proof</label>
                        <div class="file-upload">
                            <input type="file" id="modalPaymentProof" accept="image/*,.pdf">
                            <label for="modalPaymentProof" class="file-upload-label">
                                <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                <span>Upload payment proof</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="investment-summary mb-4">
                        <h4>Investment Summary</h4>
                        <div class="d-flex justify-between mb-2">
                            <span>Plan:</span>
                            <span id="summaryPlanName">-</span>
                        </div>
                        <div class="d-flex justify-between mb-2">
                            <span>Daily Interest:</span>
                            <span id="summaryDailyInterest">-</span>
                        </div>
                        <div class="d-flex justify-between mb-2">
                            <span>Duration:</span>
                            <span id="summaryDuration">-</span>
                        </div>
                        <div class="d-flex justify-between mb-2">
                            <span>Expected Earnings:</span>
                            <span id="summaryEarnings" class="text-success">-</span>
                        </div>
                        <div class="d-flex justify-between">
                            <span>Total Return:</span>
                            <span id="summaryTotalReturn" class="font-weight-bold">-</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                        <i class="fas fa-check-circle"></i> Confirm Investment
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Loader Overlay -->
    <div class="loader-overlay" id="loaderOverlay">
        <div class="loader" style="width: 3rem; height: 3rem; border-width: 4px;"></div>
        <div class="loading-text mt-3">Loading...</div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>// ==============================================
// RAW WEALTHY PREMIUM v50.3 - PRODUCTION READY
// Advanced Investment Platform with Complete Features
// ENHANCED WITH FORGOT PASSWORD, DUPLICATE PREVENTION, AND ADMIN INTEGRATION
// ==============================================

// ===== ENHANCED CONFIGURATION =====
const CONFIG = {
    API_BASE_URL: window.location.hostname === 'localhost' 
        ? 'http://localhost:10000'
        : 'https://real-wealthy-1.onrender.com',
    
    DEBUG_MODE: true,
    VERSION: '50.3.0',
    
    // Business Logic
    MIN_INVESTMENT: 3500,
    MIN_DEPOSIT: 3500,
    MIN_WITHDRAWAL: 4000,
    PLATFORM_FEE_PERCENT: 10,
    REFERRAL_COMMISSION_PERCENT: 10,
    WELCOME_BONUS: 100,
    
    // File upload limits
    MAX_FILE_SIZE: 10 * 1024 * 1024,
    ALLOWED_MIME_TYPES: {
        'image/jpeg': 'jpg',
        'image/jpg': 'jpg',
        'image/png': 'png',
        'image/gif': 'gif',
        'image/webp': 'webp',
        'application/pdf': 'pdf',
        'image/svg+xml': 'svg'
    },

    // Platform Bank Details (Updated from screenshot)
    PLATFORM_BANK_DETAILS: {
        bank_name: "OPay",
        account_name: "JOSEPH INALEGWU ISRAEL",
        account_number: "7072859483",
        note: "Use your registered name as depositor name",
        deposit_instructions: "After payment, upload your payment proof for verification"
    },
    
    // Session Management
    SESSION_TIMEOUT: 60 * 60 * 1000, // 1 hour
    DUPLICATE_PREVENTION_DELAY: 30000, // 30 seconds
    MAX_RETRY_ATTEMPTS: 3
};

// ===== ADVANCED DEBUGGING SYSTEM =====
const Debug = {
    enabled: CONFIG.DEBUG_MODE,
    
    log(level, module, message, data = null) {
        if (this.enabled) {
            const timestamp = new Date().toISOString().split('T')[1].slice(0, -1);
            const colors = {
                error: '#ef4444',
                warn: '#f59e0b',
                info: '#3b82f6',
                debug: '#10b981',
                trace: '#8b5cf6'
            };
            
            console.log(
                `%c[${timestamp}] [${module}] ${message}`,
                `color: ${colors[level] || '#94a3b8'}`,
                data ? data : ''
            );
        }
    },
    
    error(module, message, data) { this.log('error', module, message, data); },
    warn(module, message, data) { this.log('warn', module, message, data); },
    info(module, message, data) { this.log('info', module, message, data); },
    debug(module, message, data) { this.log('debug', module, message, data); }
};

// ===== ENHANCED STATE MANAGEMENT WITH DUPLICATE PREVENTION =====
class StateManager {
    static KEY_PREFIX = 'rawwealthy_';
    static TRANSACTION_KEYS = {
        INVESTMENT: 'last_investment',
        DEPOSIT: 'last_deposit',
        WITHDRAWAL: 'last_withdrawal'
    };
    
    static get(key, defaultValue = null) {
        try {
            const item = localStorage.getItem(`${this.KEY_PREFIX}${key}`);
            return item ? JSON.parse(item) : defaultValue;
        } catch (error) {
            Debug.error('StateManager', `Failed to get ${key}:`, error);
            return defaultValue;
        }
    }
    
    static set(key, value) {
        try {
            localStorage.setItem(`${this.KEY_PREFIX}${key}`, JSON.stringify(value));
            return true;
        } catch (error) {
            Debug.error('StateManager', `Failed to set ${key}:`, error);
            return false;
        }
    }
    
    static remove(key) {
        try {
            localStorage.removeItem(`${this.KEY_PREFIX}${key}`);
            return true;
        } catch (error) {
            Debug.error('StateManager', `Failed to remove ${key}:`, error);
            return false;
        }
    }
    
    // Duplicate transaction prevention
    static checkDuplicateTransaction(type, amount, threshold = CONFIG.DUPLICATE_PREVENTION_DELAY) {
        const key = this.TRANSACTION_KEYS[type] || type;
        const lastTransaction = this.get(key);
        
        if (!lastTransaction) return false;
        
        const timeDiff = Date.now() - lastTransaction.timestamp;
        const isDuplicate = timeDiff < threshold && lastTransaction.amount === amount;
        
        if (isDuplicate) {
            Debug.warn('StateManager', `Possible duplicate ${type} detected:`, {
                timeDiff,
                amount,
                threshold
            });
        }
        
        return isDuplicate;
    }
    
    static recordTransaction(type, amount, data = {}) {
        const key = this.TRANSACTION_KEYS[type] || type;
        this.set(key, {
            type,
            amount,
            timestamp: Date.now(),
            data,
            id: Date.now() + Math.random().toString(36).substr(2, 9)
        });
    }
    
    static clearTransaction(type) {
        const key = this.TRANSACTION_KEYS[type] || type;
        this.remove(key);
    }
}

// ===== ENHANCED GLOBAL STATE WITH RETRY MECHANISM =====
let authToken = StateManager.get('authToken');
let currentUser = StateManager.get('currentUser');
let isAdmin = StateManager.get('isAdmin', false);
let pendingTransactions = StateManager.get('pendingTransactions', {});
let retryCounts = StateManager.get('retryCounts', {});
let sessionStartTime = StateManager.get('sessionStartTime', Date.now());

// Session Management
const SessionManager = {
    init() {
        this.checkSessionTimeout();
        setInterval(() => this.checkSessionTimeout(), 60000); // Check every minute
    },
    
    checkSessionTimeout() {
        if (!authToken) return;
        
        const sessionDuration = Date.now() - sessionStartTime;
        if (sessionDuration > CONFIG.SESSION_TIMEOUT) {
            Debug.warn('SessionManager', 'Session expired due to timeout');
            this.showSessionTimeoutWarning();
        }
    },
    
    showSessionTimeoutWarning() {
        if (document.getElementById('sessionTimeoutModal')) return;
        
        const modalHTML = `
            <div class="modal active" id="sessionTimeoutModal">
                <div class="modal-backdrop"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Session Timeout</h3>
                    </div>
                    <div class="modal-body text-center">
                        <i class="fas fa-clock fa-3x text-warning mb-3"></i>
                        <h4 class="mb-3">Your Session is About to Expire</h4>
                        <p class="text-muted mb-4">For security reasons, you'll be logged out soon. Would you like to stay logged in?</p>
                        <div class="d-flex gap-2 justify-center">
                            <button class="btn btn-primary" id="extendSession">Stay Logged In</button>
                            <button class="btn btn-secondary" id="logoutNow">Logout Now</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        document.getElementById('extendSession').addEventListener('click', () => {
            this.extendSession();
            document.getElementById('sessionTimeoutModal').remove();
        });
        
        document.getElementById('logoutNow').addEventListener('click', () => {
            AuthManager.logout();
            document.getElementById('sessionTimeoutModal').remove();
        });
    },
    
    extendSession() {
        sessionStartTime = Date.now();
        StateManager.set('sessionStartTime', sessionStartTime);
        Debug.info('SessionManager', 'Session extended');
    },
    
    resetSession() {
        sessionStartTime = Date.now();
        StateManager.set('sessionStartTime', sessionStartTime);
    }
};

// ===== ENHANCED UTILITIES WITH RETRY LOGIC =====
class Utils {
    static formatCurrency(amount, currency = 'â¦') {
        try {
            if (amount === null || amount === undefined || isNaN(amount)) {
                return `${currency} 0.00`;
            }
            return `${currency} ${parseFloat(amount).toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            })}`;
        } catch (error) {
            Debug.error('Utils', 'formatCurrency error:', error);
            return `${currency} 0.00`;
        }
    }
    
    static formatDate(dateString) {
        try {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        } catch (error) {
            Debug.error('Utils', 'formatDate error:', error);
            return 'Invalid Date';
        }
    }
    
    static formatDateTime(dateString) {
        try {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch (error) {
            Debug.error('Utils', 'formatDateTime error:', error);
            return 'Invalid Date';
        }
    }
    
    static showLoader(message = 'Loading...') {
        const loader = document.getElementById('loaderOverlay');
        if (loader) {
            const textElement = loader.querySelector('.loading-text');
            if (textElement) {
                textElement.textContent = message;
            }
            loader.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        Debug.debug('UI', 'Loader shown:', message);
    }
    
    static hideLoader() {
        const loader = document.getElementById('loaderOverlay');
        if (loader) {
            loader.classList.remove('active');
            document.body.style.overflow = '';
        }
        Debug.debug('UI', 'Loader hidden');
    }
    
    static showNotification(message, type = 'info', duration = 5000) {
        try {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const title = type.charAt(0).toUpperCase() + type.slice(1);
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-title">
                        <i class="${icons[type] || 'fas fa-info-circle'} mr-2"></i> ${title}
                    </div>
                    <button class="notification-close">&times;</button>
                </div>
                <div class="notification-message">${message}</div>
            `;
            
            container.appendChild(notification);
            
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.remove();
            });
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
            
            Debug.debug('UI', 'Notification shown:', { type, message });
        } catch (error) {
            Debug.error('UI', 'Failed to show notification:', error);
        }
    }
    
    static showError(error, context = 'Unknown') {
        Debug.error('API', `Error in ${context}:`, error);
        
        let message = 'An unexpected error occurred';
        if (error.response?.data?.message) {
            message = error.response.data.message;
        } else if (error.message) {
            message = error.message;
        } else if (typeof error === 'string') {
            message = error;
        }
        
        this.showNotification(message, 'error');
    }
    
    static async copyToClipboard(text) {
        try {
            await navigator.clipboard.writeText(text);
            this.showNotification('Copied to clipboard!', 'success', 2000);
            return true;
        } catch (err) {
            Debug.error('Utils', 'Copy to clipboard failed:', err);
            this.showNotification('Failed to copy', 'error');
            return false;
        }
    }
    
    static validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    static generateId(prefix = 'id') {
        return `${prefix}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    static calculateTotalEarnings(user) {
        if (!user) return 0;
        const dailyEarnings = user.total_earnings || 0;
        const referralEarnings = user.referral_earnings || 0;
        return dailyEarnings + referralEarnings;
    }

    static calculateWithdrawableBalance(user) {
        if (!user) return 0;
        const dailyEarnings = user.total_earnings || 0;
        const referralEarnings = user.referral_earnings || 0;
        const totalWithdrawn = user.total_withdrawn || 0;
        return Math.max(0, dailyEarnings + referralEarnings - totalWithdrawn);
    }

    static hasBankDetails(user) {
        return user && user.bank_details && user.bank_details.account_number && user.bank_details.account_number.trim() !== '';
    }
    
    // Retry mechanism for failed requests
    static async retryOperation(operation, maxRetries = CONFIG.MAX_RETRY_ATTEMPTS, delay = 1000) {
        let lastError;
        
        for (let attempt = 1; attempt <= maxRetries; attempt++) {
            try {
                Debug.debug('Retry', `Attempt ${attempt} of ${maxRetries}`);
                return await operation();
            } catch (error) {
                lastError = error;
                
                if (attempt < maxRetries) {
                    Debug.warn('Retry', `Operation failed, retrying in ${delay}ms:`, error);
                    await this.sleep(delay);
                    delay *= 2; // Exponential backoff
                }
            }
        }
        
        throw lastError;
    }
    
    static sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // Duplicate transaction confirmation
    static async confirmDuplicateTransaction(type, amount) {
        return new Promise((resolve) => {
            const modalHTML = `
                <div class="modal active" id="duplicateModal">
                    <div class="modal-backdrop"></div>
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Confirm ${type}</h3>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body text-center">
                            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                            <h4 class="mb-3">${type} Already Submitted</h4>
                            <p class="text-muted mb-3">
                                You recently submitted a ${type.toLowerCase()} for ${this.formatCurrency(amount)}.
                                Are you sure you want to submit another one?
                            </p>
                            <div class="d-flex gap-2 justify-center">
                                <button class="btn btn-primary" id="confirmDuplicate">Yes, Submit Another</button>
                                <button class="btn btn-secondary" id="cancelDuplicate">No, Go Back</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            const modal = document.getElementById('duplicateModal');
            const closeModal = () => modal.remove();
            
            document.getElementById('confirmDuplicate').addEventListener('click', () => {
                closeModal();
                resolve(true);
            });
            
            document.getElementById('cancelDuplicate').addEventListener('click', () => {
                closeModal();
                resolve(false);
            });
            
            modal.querySelector('.modal-close').addEventListener('click', () => {
                closeModal();
                resolve(false);
            });
            
            modal.querySelector('.modal-backdrop').addEventListener('click', () => {
                closeModal();
                resolve(false);
            });
        });
    }
}

// ===== ENHANCED API SERVICE WITH RETRY AND DUPLICATE PREVENTION =====
class ApiService {
    static async request(endpoint, options = {}, retryConfig = { maxRetries: 3 }) {
        const url = `${CONFIG.API_BASE_URL}${endpoint}`;
        const requestId = Utils.generateId('req');
        
        Debug.debug('API', `[${requestId}] ${options.method || 'GET'} ${endpoint}`);
        
        const headers = options.body instanceof FormData ? {} : {
            'Content-Type': 'application/json'
        };
        
        if (authToken) {
            headers['Authorization'] = `Bearer ${authToken}`;
        }
        
        try {
            const response = await Utils.retryOperation(async () => {
                const response = await fetch(url, {
                    ...options,
                    headers,
                    credentials: 'include'
                });
                
                let data;
                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    const text = await response.text();
                    data = { text };
                }
                
                Debug.debug('API', `[${requestId}] Response:`, { 
                    status: response.status,
                    success: data.success 
                });
                
                if (!response.ok) {
                    throw {
                        response: { data },
                        message: data.message || `Request failed with status ${response.status}`,
                        status: response.status
                    };
                }
                
                return data;
            }, retryConfig.maxRetries);
            
            return response;
            
        } catch (error) {
            Debug.error('API', `[${requestId}] Request failed after retries:`, error);
            throw error;
        }
    }
    
    // Auth endpoints
    static async login(email, password) {
        return this.request('/api/auth/login', {
            method: 'POST',
            body: JSON.stringify({ email, password })
        });
    }
    
    static async register(userData) {
        return this.request('/api/auth/register', {
            method: 'POST',
            body: JSON.stringify(userData)
        });
    }
    
    // Forgot Password endpoints
    static async forgotPassword(email) {
        return this.request('/api/auth/forgot-password', {
            method: 'POST',
            body: JSON.stringify({ email })
        });
    }
    
    static async resetPassword(token, password) {
        return this.request(`/api/auth/reset-password/${token}`, {
            method: 'POST',
            body: JSON.stringify({ password })
        });
    }
    
    // Profile endpoints
    static async getProfile() {
        return this.request('/api/profile');
    }
    
    static async updateProfile(profileData) {
        return this.request('/api/profile', {
            method: 'PUT',
            body: JSON.stringify(profileData)
        });
    }
    
    static async updateBankDetails(bankData) {
        return this.request('/api/profile/bank', {
            method: 'PUT',
            body: JSON.stringify(bankData)
        });
    }
    
    // Investment endpoints
    static async getPlans() {
        return this.request('/api/plans');
    }
    
    static async getInvestments(query = {}) {
        const params = new URLSearchParams(query).toString();
        return this.request(`/api/investments${params ? `?${params}` : ''}`);
    }
    
    static async createInvestment(investmentData) {
        // Check for duplicate
        if (StateManager.checkDuplicateTransaction('INVESTMENT', investmentData.amount)) {
            const confirmed = await Utils.confirmDuplicateTransaction('Investment', investmentData.amount);
            if (!confirmed) {
                throw new Error('Duplicate investment cancelled by user');
            }
        }
        
        if (investmentData.payment_proof) {
            const formData = new FormData();
            
            Object.keys(investmentData).forEach(key => {
                if (key !== 'payment_proof') {
                    formData.append(key, investmentData[key]);
                }
            });
            
            formData.append('payment_proof', investmentData.payment_proof);
            
            const result = await this.request('/api/investments', {
                method: 'POST',
                body: formData
            });
            
            StateManager.recordTransaction('INVESTMENT', investmentData.amount, investmentData);
            return result;
        } else {
            const result = await this.request('/api/investments', {
                method: 'POST',
                body: JSON.stringify(investmentData)
            });
            
            StateManager.recordTransaction('INVESTMENT', investmentData.amount, investmentData);
            return result;
        }
    }
    
    // Deposit endpoints
    static async getDeposits(query = {}) {
        const params = new URLSearchParams(query).toString();
        return this.request(`/api/deposits${params ? `?${params}` : ''}`);
    }
    
    static async createDeposit(depositData) {
        // Check for duplicate
        if (StateManager.checkDuplicateTransaction('DEPOSIT', depositData.amount)) {
            const confirmed = await Utils.confirmDuplicateTransaction('Deposit', depositData.amount);
            if (!confirmed) {
                throw new Error('Duplicate deposit cancelled by user');
            }
        }
        
        if (depositData.payment_proof) {
            const formData = new FormData();
            
            Object.keys(depositData).forEach(key => {
                if (key !== 'payment_proof') {
                    formData.append(key, depositData[key]);
                }
            });
            
            formData.append('payment_proof', depositData.payment_proof);
            
            const result = await this.request('/api/deposits', {
                method: 'POST',
                body: formData
            });
            
            StateManager.recordTransaction('DEPOSIT', depositData.amount, depositData);
            return result;
        } else {
            const result = await this.request('/api/deposits', {
                method: 'POST',
                body: JSON.stringify(depositData)
            });
            
            StateManager.recordTransaction('DEPOSIT', depositData.amount, depositData);
            return result;
        }
    }
    
    // Withdrawal endpoints
    static async getWithdrawals(query = {}) {
        const params = new URLSearchParams(query).toString();
        return this.request(`/api/withdrawals${params ? `?${params}` : ''}`);
    }
    
    static async createWithdrawal(amount, payment_method = 'bank_transfer') {
        // Check for duplicate
        if (StateManager.checkDuplicateTransaction('WITHDRAWAL', amount)) {
            const confirmed = await Utils.confirmDuplicateTransaction('Withdrawal', amount);
            if (!confirmed) {
                throw new Error('Duplicate withdrawal cancelled by user');
            }
        }
        
        const result = await this.request('/api/withdrawals', {
            method: 'POST',
            body: JSON.stringify({ amount, payment_method })
        });
        
        StateManager.recordTransaction('WITHDRAWAL', amount, { payment_method });
        return result;
    }
    
    // Transaction endpoints
    static async getTransactions(query = {}) {
        const params = new URLSearchParams(query).toString();
        return this.request(`/api/transactions${params ? `?${params}` : ''}`);
    }
    
    // KYC endpoints
    static async getKYCStatus() {
        return this.request('/api/kyc/status');
    }
    
    static async submitKYC(kycData) {
        const formData = new FormData();
        
        Object.keys(kycData).forEach(key => {
            if (key !== 'id_front' && key !== 'id_back' && key !== 'selfie_with_id' && key !== 'address_proof') {
                formData.append(key, kycData[key]);
            }
        });
        
        if (kycData.id_front) formData.append('id_front', kycData.id_front);
        if (kycData.id_back) formData.append('id_back', kycData.id_back);
        if (kycData.selfie_with_id) formData.append('selfie_with_id', kycData.selfie_with_id);
        if (kycData.address_proof) formData.append('address_proof', kycData.address_proof);
        
        return this.request('/api/kyc', {
            method: 'POST',
            body: formData
        });
    }
    
    // Support endpoints
    static async getSupportTickets(query = {}) {
        const params = new URLSearchParams(query).toString();
        return this.request(`/api/support/tickets${params ? `?${params}` : ''}`);
    }
    
    static async createSupportTicket(ticketData, attachments = []) {
        if (attachments.length > 0) {
            const formData = new FormData();
            
            Object.keys(ticketData).forEach(key => {
                formData.append(key, ticketData[key]);
            });
            
            attachments.forEach((file, index) => {
                formData.append('attachments', file);
            });
            
            return this.request('/api/support', {
                method: 'POST',
                body: formData
            });
        } else {
            return this.request('/api/support', {
                method: 'POST',
                body: JSON.stringify(ticketData)
            });
        }
    }
    
    // Referral endpoints
    static async getReferralStats() {
        return this.request('/api/referrals/stats');
    }
    
    static async getReferrals(query = {}) {
        const params = new URLSearchParams(query).toString();
        return this.request(`/api/referrals${params ? `?${params}` : ''}`);
    }
    
    // Notification endpoints
    static async getNotifications(query = {}) {
        const params = new URLSearchParams(query).toString();
        return this.request(`/api/notifications${params ? `?${params}` : ''}`);
    }
    
    static async markNotificationAsRead(notificationId) {
        return this.request(`/api/notifications/${notificationId}/read`, {
            method: 'POST'
        });
    }
    
    static async markAllNotificationsAsRead() {
        return this.request('/api/notifications/read-all', {
            method: 'POST'
        });
    }
    
    // Upload endpoint
    static async uploadFile(file, folder = 'general') {
        const formData = new FormData();
        formData.append('file', file);
        if (folder) formData.append('folder', folder);
        
        return this.request('/api/upload', {
            method: 'POST',
            body: formData
        });
    }
    
    // Debug endpoints
    static async debugEarningsStatus(userId) {
        return this.request(`/api/debug/earnings-status/${userId}`);
    }
    
    static async fixUserEarnings(userId) {
        return this.request(`/api/debug/fix-user-earnings/${userId}`, {
            method: 'POST'
        });
    }
}

// ===== ENHANCED AUTH MANAGER WITH FORGOT PASSWORD =====
class AuthManager {
    static async login(email, password) {
        try {
            Utils.showLoader('Authenticating...');
            Debug.info('Auth', 'Login attempt:', { email });
            
            const response = await ApiService.login(email, password);
            
            if (response.success) {
                authToken = response.data.token;
                currentUser = response.data.user;
                isAdmin = currentUser.role === 'admin' || currentUser.role === 'super_admin';
                
                StateManager.set('authToken', authToken);
                StateManager.set('currentUser', currentUser);
                StateManager.set('isAdmin', isAdmin);
                StateManager.set('sessionStartTime', Date.now());
                
                SessionManager.resetSession();
                
                this.updateUI();
                
                Utils.showNotification('Login successful!', 'success');
                
                Router.navigateTo('dashboard');
                
                Debug.info('Auth', 'Login successful:', { userId: currentUser._id, email: currentUser.email });
                return true;
            } else {
                Utils.showNotification(response.message || 'Login failed', 'error');
                Debug.warn('Auth', 'Login failed:', response.message);
                return false;
            }
        } catch (error) {
            Utils.showError(error, 'Login');
            return false;
        } finally {
            Utils.hideLoader();
        }
    }
    
    static async register(userData) {
        try {
            Utils.showLoader('Creating account...');
            Debug.info('Auth', 'Registration attempt:', { email: userData.email });
            
            if (!Utils.validateEmail(userData.email)) {
                Utils.showNotification('Please enter a valid email address', 'error');
                return false;
            }
            
            const response = await ApiService.register(userData);
            
            if (response.success) {
                Utils.showNotification('Account created successfully! Welcome bonus credited.', 'success');
                Router.navigateTo('login');
                Debug.info('Auth', 'Registration successful:', { email: userData.email });
                return true;
            } else {
                Utils.showNotification(response.message || 'Registration failed', 'error');
                Debug.warn('Auth', 'Registration failed:', response.message);
                return false;
            }
        } catch (error) {
            Utils.showError(error, 'Registration');
            return false;
        } finally {
            Utils.hideLoader();
        }
    }
    
    static async forgotPassword(email) {
        try {
            Utils.showLoader('Sending reset instructions...');
            Debug.info('Auth', 'Forgot password attempt:', { email });
            
            if (!Utils.validateEmail(email)) {
                Utils.showNotification('Please enter a valid email address', 'error');
                return false;
            }
            
            const response = await ApiService.forgotPassword(email);
            
            if (response.success) {
                Utils.showNotification('Password reset instructions sent to your email', 'success');
                
                // Show success modal
                this.showForgotPasswordSuccess();
                Debug.info('Auth', 'Forgot password email sent:', { email });
                return true;
            } else {
                Utils.showNotification(response.message || 'Password reset failed', 'error');
                Debug.warn('Auth', 'Forgot password failed:', response.message);
                return false;
            }
        } catch (error) {
            Utils.showError(error, 'Forgot Password');
            return false;
        } finally {
            Utils.hideLoader();
        }
    }
    
    static async resetPassword(token, password) {
        try {
            Utils.showLoader('Resetting password...');
            Debug.info('Auth', 'Reset password attempt');
            
            if (password.length < 6) {
                Utils.showNotification('Password must be at least 6 characters', 'error');
                return false;
            }
            
            const response = await ApiService.resetPassword(token, password);
            
            if (response.success) {
                Utils.showNotification('Password reset successful! You can now login with your new password.', 'success');
                Router.navigateTo('login');
                Debug.info('Auth', 'Password reset successful');
                return true;
            } else {
                Utils.showNotification(response.message || 'Password reset failed', 'error');
                Debug.warn('Auth', 'Password reset failed:', response.message);
                return false;
            }
        } catch (error) {
            Utils.showError(error, 'Reset Password');
            return false;
        } finally {
            Utils.hideLoader();
        }
    }
    
    static showForgotPasswordSuccess() {
        const modalHTML = `
            <div class="modal active" id="forgotPasswordSuccessModal">
                <div class="modal-backdrop"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Check Your Email</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body text-center">
                        <i class="fas fa-envelope fa-3x text-primary mb-3"></i>
                        <h4 class="mb-3">Password Reset Email Sent</h4>
                        <p class="text-muted mb-4">
                            We've sent password reset instructions to your email address.
                            Please check your inbox and follow the link to reset your password.
                        </p>
                        <div class="alert alert-info text-left">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Note:</strong> The reset link will expire in 10 minutes.
                            If you don't see the email, check your spam folder.
                        </div>
                        <button class="btn btn-primary mt-3" id="closeForgotPasswordSuccess">Back to Login</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        const modal = document.getElementById('forgotPasswordSuccessModal');
        
        document.getElementById('closeForgotPasswordSuccess').addEventListener('click', () => {
            modal.remove();
            Router.navigateTo('login');
        });
        
        modal.querySelector('.modal-close').addEventListener('click', () => {
            modal.remove();
            Router.navigateTo('login');
        });
        
        modal.querySelector('.modal-backdrop').addEventListener('click', () => {
            modal.remove();
            Router.navigateTo('login');
        });
    }
    
    static showResetPasswordModal(token) {
        const modalHTML = `
            <div class="modal active" id="resetPasswordModal">
                <div class="modal-backdrop"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Reset Your Password</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="resetPasswordForm">
                            <div class="form-group">
                                <label class="form-label">New Password</label>
                                <div class="input-group">
                                    <i class="input-group-icon fas fa-lock"></i>
                                    <input type="password" class="form-control" id="newPassword" 
                                           placeholder="Enter new password" required minlength="6">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Confirm New Password</label>
                                <div class="input-group">
                                    <i class="input-group-icon fas fa-lock"></i>
                                    <input type="password" class="form-control" id="confirmNewPassword" 
                                           placeholder="Confirm new password" required minlength="6">
                                </div>
                            </div>
                            <div class="alert alert-info mb-4">
                                <i class="fas fa-info-circle mr-2"></i>
                                Password must be at least 6 characters long
                            </div>
                            <button type="submit" class="btn btn-primary btn-block btn-lg">
                                <i class="fas fa-key"></i> Reset Password
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        const modal = document.getElementById('resetPasswordModal');
        const form = document.getElementById('resetPasswordForm');
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if (newPassword !== confirmPassword) {
                Utils.showNotification('Passwords do not match', 'error');
                return;
            }
            
            await this.resetPassword(token, newPassword);
            modal.remove();
        });
        
        modal.querySelector('.modal-close').addEventListener('click', () => {
            modal.remove();
            Router.navigateTo('login');
        });
        
        modal.querySelector('.modal-backdrop').addEventListener('click', () => {
            modal.remove();
            Router.navigateTo('login');
        });
    }
    
    static logout() {
        Debug.info('Auth', 'Logout initiated');
        
        // Clear all transaction records
        StateManager.clearTransaction('INVESTMENT');
        StateManager.clearTransaction('DEPOSIT');
        StateManager.clearTransaction('WITHDRAWAL');
        
        authToken = null;
        currentUser = null;
        isAdmin = false;
        
        StateManager.remove('authToken');
        StateManager.remove('currentUser');
        StateManager.remove('isAdmin');
        StateManager.remove('sessionStartTime');
        
        appState = {
            investments: [],
            deposits: [],
            withdrawals: [],
            transactions: [],
            notifications: [],
            referrals: [],
            plans: [],
            lastUpdated: null
        };
        
        this.updateUI();
        
        Router.navigateTo('login');
        
        Utils.showNotification('Logged out successfully', 'info');
        Debug.info('Auth', 'Logout completed');
    }
    
    static async loadUserData() {
        if (!authToken) {
            Debug.warn('Auth', 'No auth token found');
            return;
        }
        
        try {
            Debug.info('Auth', 'Loading user data...');
            
            const response = await ApiService.getProfile();
            
            if (response.success) {
                currentUser = response.data.user;
                isAdmin = currentUser.role === 'admin' || currentUser.role === 'super_admin';
                
                StateManager.set('currentUser', currentUser);
                StateManager.set('isAdmin', isAdmin);
                
                if (response.data.stats) {
                    appState.dashboardStats = response.data.stats;
                    StateManager.set('appState', appState);
                }
                
                this.updateUI();
                
                if (Router.currentSection === 'dashboard') {
                    DashboardManager.loadDashboardData();
                }
                
                Debug.info('Auth', 'User data loaded successfully');
            } else {
                Debug.warn('Auth', 'Failed to load user data:', response.message);
            }
        } catch (error) {
            Debug.error('Auth', 'Failed to load user data:', error);
            
            if (error.status === 401) {
                this.logout();
            }
        }
    }
    
    static updateUI() {
        Debug.info('Auth', 'Updating UI...');
        
        document.querySelectorAll('.admin-nav').forEach(el => {
            el.classList.toggle('d-none', !isAdmin);
        });
        
        const avatarElement = document.getElementById('userAvatar');
        if (avatarElement && currentUser?.full_name) {
            const initials = currentUser.full_name
                .split(' ')
                .map(name => name[0])
                .join('')
                .toUpperCase();
            avatarElement.textContent = initials || 'U';
        }
        
        const greetingElement = document.getElementById('userGreeting');
        if (greetingElement && currentUser?.full_name) {
            const firstName = currentUser.full_name.split(' ')[0];
            greetingElement.textContent = firstName || 'User';
        }
        
        const loginSection = document.getElementById('login');
        const dashboardSection = document.getElementById('dashboard');
        
        if (authToken) {
            if (loginSection) loginSection.classList.remove('active');
            if (dashboardSection) dashboardSection.classList.add('active');
        } else {
            if (loginSection) loginSection.classList.add('active');
            if (dashboardSection) dashboardSection.classList.remove('active');
        }
    }
}

// ===== ENHANCED ROUTER WITH PASSWORD RESET HANDLING =====
class Router {
    static currentSection = 'login';
    static previousSection = null;
    
    static init() {
        Debug.info('Router', 'Initializing...');
        
        // Check for password reset token in URL
        this.checkPasswordResetToken();
        
        if (authToken) {
            AuthManager.loadUserData();
            this.navigateTo('dashboard');
        } else {
            this.navigateTo('login');
        }
        
        this.setupNavigation();
    }
    
    static checkPasswordResetToken() {
        const urlParams = new URLSearchParams(window.location.search);
        const resetToken = urlParams.get('resetToken') || urlParams.get('token');
        
        if (resetToken) {
            Debug.info('Router', 'Password reset token detected');
            AuthManager.showResetPasswordModal(resetToken);
            
            // Clean URL
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    }
    
    static setupNavigation() {
        Debug.info('Router', 'Setting up navigation listeners...');
        
        document.addEventListener('click', (e) => {
            const link = e.target.closest('a[href^="#"]');
            if (link) {
                e.preventDefault();
                const section = link.getAttribute('href').substring(1);
                this.navigateTo(section);
                
                if (window.innerWidth < 768) {
                    const sidebar = document.getElementById('sidebar');
                    const sidebarOverlay = document.getElementById('sidebarOverlay');
                    if (sidebar) sidebar.classList.remove('active');
                    if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                }
            }
        });
        
        document.addEventListener('click', (e) => {
            const button = e.target.closest('button[data-action]');
            if (button) {
                const action = button.getAttribute('data-action');
                this.handleAction(action);
            }
        });
        
        window.addEventListener('hashchange', () => {
            const section = window.location.hash.substring(1) || 'login';
            if (section !== this.currentSection) {
                this.navigateTo(section);
            }
        });
        
        Debug.info('Router', 'Navigation listeners setup complete');
    }
    
    static navigateTo(section) {
        Debug.info('Router', `Navigating to: ${section}`, { previous: this.currentSection });
        
        if (section === this.currentSection) {
            Debug.debug('Router', 'Already on section, skipping navigation');
            return;
        }
        
        window.location.hash = section;
        
        this.previousSection = this.currentSection;
        this.currentSection = section;
        
        document.querySelectorAll('.page-section').forEach(el => {
            el.classList.remove('active');
        });
        
        const targetSection = document.getElementById(section);
        if (targetSection) {
            targetSection.classList.add('active');
            
            document.querySelectorAll('.nav-link, .sidebar-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${section}`) {
                    link.classList.add('active');
                }
            });
            
            document.title = `Raw Wealthy | ${this.getPageTitle(section)}`;
            
            this.loadSectionData(section);
            
            Debug.info('Router', `Navigation complete: ${section}`);
        } else {
            Debug.error('Router', `Target section not found: ${section}`);
            Utils.showNotification('Page not found', 'error');
            this.navigateTo('dashboard');
        }
    }
    
    static getPageTitle(section) {
        const titles = {
            login: 'Login',
            register: 'Register',
            dashboard: 'Dashboard',
            investments: 'Investments',
            deposits: 'Deposits',
            withdrawals: 'Withdrawals',
            transactions: 'Transactions',
            kyc: 'KYC Verification',
            support: 'Support Center',
            referrals: 'Referral Program',
            profile: 'My Profile',
            admin: 'Admin Dashboard'
        };
        return titles[section] || 'Premium Investment Platform';
    }
    
    static async loadSectionData(section) {
        Debug.info('Router', `Loading data for section: ${section}`);
        
        const protectedSections = ['dashboard', 'investments', 'deposits', 'withdrawals', 
                                 'transactions', 'kyc', 'support', 'referrals', 'profile', 'admin'];
        
        if (!authToken && protectedSections.includes(section)) {
            Debug.warn('Router', 'Unauthorized access attempt to protected section:', section);
            Utils.showNotification('Please login to access this page', 'warning');
            this.navigateTo('login');
            return;
        }
        
        try {
            switch(section) {
                case 'dashboard':
                    await DashboardManager.loadDashboardData();
                    break;
                case 'investments':
                    await InvestmentManager.loadInvestments();
                    break;
                case 'deposits':
                    await DepositManager.loadDeposits();
                    break;
                case 'withdrawals':
                    await WithdrawalManager.loadWithdrawals();
                    break;
                case 'transactions':
                    await TransactionManager.loadTransactions();
                    break;
                case 'kyc':
                    await KYCManager.loadKYCStatus();
                    break;
                case 'support':
                    await SupportManager.loadSupportTickets();
                    break;
                case 'referrals':
                    await ReferralManager.loadReferralData();
                    break;
                case 'profile':
                    ProfileManager.updateProfilePage();
                    break;
                case 'admin':
                    if (isAdmin) {
                        await AdminManager.loadAdminDashboard();
                    } else {
                        Utils.showNotification('Admin access required', 'error');
                        this.navigateTo('dashboard');
                    }
                    break;
            }
            
            Debug.info('Router', `Section data loaded: ${section}`);
        } catch (error) {
            Debug.error('Router', `Failed to load section data for ${section}:`, error);
            Utils.showError(error, `Loading ${section}`);
        }
    }
    
    static handleAction(action) {
        Debug.info('Router', `Handling action: ${action}`);
        
        switch(action) {
            case 'make-deposit':
                this.navigateTo('deposits');
                break;
            case 'new-investment':
                this.navigateTo('investments');
                break;
            case 'request-withdrawal':
                this.navigateTo('withdrawals');
                break;
            case 'invite-friends':
                this.navigateTo('referrals');
                break;
            case 'add-bank-details':
                const bankForm = document.getElementById('bankDetailsForm');
                if (bankForm) {
                    bankForm.scrollIntoView({ behavior: 'smooth' });
                }
                break;
            default:
                Debug.warn('Router', `Unknown action: ${action}`);
        }
    }
}

// ===== ENHANCED DASHBOARD MANAGER =====
class DashboardManager {
    static chartInstance = null;
    
    static async loadDashboardData() {
        Debug.info('Dashboard', 'Loading dashboard data...');
        
        try {
            Utils.showLoader('Loading dashboard...');
            
            const profileResponse = await ApiService.getProfile();
            
            if (profileResponse.success) {
                this.updateDashboardStats(profileResponse.data);
                
                const transactionsResponse = await ApiService.getTransactions({ limit: 5 });
                if (transactionsResponse.success) {
                    this.updateRecentActivity(transactionsResponse.data.transactions || []);
                }
                
                const notificationsResponse = await ApiService.getNotifications({ limit: 5 });
                if (notificationsResponse.success) {
                    this.updateNotifications(notificationsResponse.data.notifications || []);
                }
                
                this.updateInvestmentChart();
                
                Debug.info('Dashboard', 'Dashboard data loaded successfully');
            } else {
                Debug.warn('Dashboard', 'Failed to load dashboard data:', profileResponse.message);
                this.showDashboardError('Failed to load dashboard data');
            }
        } catch (error) {
            Debug.error('Dashboard', 'Failed to load dashboard data:', error);
            this.showDashboardError('Failed to load dashboard data');
        } finally {
            Utils.hideLoader();
        }
    }
    
    static updateDashboardStats(data) {
        Debug.info('Dashboard', 'Updating dashboard stats...', data);
        
        try {
            const user = data.user || {};
            const stats = data.stats || {};
            
            const portfolioValue = (user.balance || 0) + (user.total_earnings || 0) + (user.referral_earnings || 0);
            const totalEarnings = Utils.calculateTotalEarnings(user);
            const withdrawableBalance = Utils.calculateWithdrawableBalance(user);
            
            document.getElementById('totalBalance').textContent = Utils.formatCurrency(user.balance || 0);
            document.getElementById('activeInvestments').textContent = Utils.formatCurrency(stats.active_investment_value || 0);
            document.getElementById('totalEarnings').textContent = Utils.formatCurrency(totalEarnings);
            document.getElementById('totalReferrals').textContent = user.referral_count || 0;
            document.getElementById('availableBalance').textContent = Utils.formatCurrency(withdrawableBalance);
            
            const withdrawableElement = document.getElementById('withdrawableBalance');
            if (withdrawableElement) {
                withdrawableElement.textContent = Utils.formatCurrency(withdrawableBalance);
            }
            
            Debug.info('Dashboard', 'Dashboard stats updated successfully');
        } catch (error) {
            Debug.error('Dashboard', 'Failed to update dashboard stats:', error);
        }
    }
    
    static updateRecentActivity(transactions) {
        Debug.info('Dashboard', 'Updating recent activity...');
        
        const container = document.getElementById('recentActivity');
        if (!container) return;
        
        try {
            if (!transactions || transactions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-exchange-alt fa-2x text-muted mb-3"></i>
                        <p class="text-muted">No recent activity</p>
                    </div>
                `;
                return;
            }
            
            const transactionsHTML = transactions.map(transaction => {
                const amount = parseFloat(transaction.amount) || 0;
                const isPositive = amount >= 0;
                const typeIcon = this.getTransactionTypeIcon(transaction.type);
                
                return `
                    <div class="activity-item d-flex justify-between align-center p-3 border-bottom">
                        <div class="d-flex align-center gap-3">
                            <div class="activity-icon ${isPositive ? 'bg-success' : 'bg-danger'}">
                                <i class="fas ${isPositive ? 'fa-arrow-down' : 'fa-arrow-up'}"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">${transaction.description || 'No description'}</h6>
                                <p class="text-muted small mb-0">
                                    <i class="fas ${typeIcon} mr-1"></i>
                                    ${transaction.type || 'Unknown'} â¢ ${Utils.formatDateTime(transaction.createdAt)}
                                </p>
                            </div>
                        </div>
                        <div class="${isPositive ? 'text-success' : 'text-danger'} font-weight-bold">
                            ${isPositive ? '+' : ''}${Utils.formatCurrency(amount)}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = transactionsHTML;
            Debug.info('Dashboard', `Recent activity updated with ${transactions.length} transactions`);
        } catch (error) {
            Debug.error('Dashboard', 'Failed to update recent activity:', error);
            container.innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                    <p class="text-warning">Failed to load activity</p>
                </div>
            `;
        }
    }
    
    static updateNotifications(notifications) {
        Debug.info('Dashboard', 'Updating notifications...');
        
        const container = document.getElementById('notificationsList');
        if (!container) return;
        
        try {
            if (!notifications || notifications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-bell-slash fa-2x text-muted mb-3"></i>
                        <p class="text-muted">No notifications</p>
                    </div>
                `;
                return;
            }
            
            const notificationsHTML = notifications.map(notification => {
                const typeIcon = this.getNotificationTypeIcon(notification.type);
                const typeColor = this.getNotificationTypeColor(notification.type);
                
                return `
                    <div class="notification-item d-flex align-start gap-3 p-3 border-bottom ${notification.is_read ? '' : 'bg-dark-hover'}">
                        <div class="notification-icon ${typeColor}">
                            <i class="fas ${typeIcon}"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${notification.title || 'Notification'}</h6>
                            <p class="text-muted small mb-1">${notification.message || 'No message'}</p>
                            <p class="text-muted smaller mb-0">${Utils.formatDateTime(notification.createdAt)}</p>
                        </div>
                        ${!notification.is_read ? '<span class="badge badge-primary badge-sm">New</span>' : ''}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = notificationsHTML;
            
            Debug.info('Dashboard', `Notifications updated with ${notifications.length} items`);
        } catch (error) {
            Debug.error('Dashboard', 'Failed to update notifications:', error);
            container.innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                    <p class="text-warning">Failed to load notifications</p>
                </div>
            `;
        }
    }
    
    static updateInvestmentChart() {
        Debug.info('Dashboard', 'Updating investment chart...');
        
        const canvas = document.getElementById('investmentChart');
        if (!canvas) {
            Debug.warn('Dashboard', 'Investment chart canvas not found');
            return;
        }
        
        try {
            const ctx = canvas.getContext('2d');
            
            if (this.chartInstance) {
                this.chartInstance.destroy();
            }
            
            const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'];
            const data = [10000, 15000, 22000, 30000, 45000, 65000, 85000];
            
            this.chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Investment Growth',
                        data: data,
                        borderColor: '#7C3AED',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `Value: ${Utils.formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#94A3B8',
                                callback: function(value) {
                                    return Utils.formatCurrency(value);
                                }
                            }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#94A3B8' }
                        }
                    }
                }
            });
            
            Debug.info('Dashboard', 'Investment chart updated successfully');
        } catch (error) {
            Debug.error('Dashboard', 'Failed to update investment chart:', error);
        }
    }
    
    static getTransactionTypeIcon(type) {
        const icons = {
            deposit: 'fa-money-bill-wave',
            withdrawal: 'fa-wallet',
            investment: 'fa-chart-line',
            earning: 'fa-coins',
            referral: 'fa-users',
            bonus: 'fa-gift',
            fee: 'fa-percentage'
        };
        return icons[type] || 'fa-exchange-alt';
    }
    
    static getNotificationTypeIcon(type) {
        const icons = {
            info: 'fa-info-circle',
            success: 'fa-check-circle',
            warning: 'fa-exclamation-triangle',
            error: 'fa-exclamation-circle',
            investment: 'fa-chart-line',
            withdrawal: 'fa-wallet',
            deposit: 'fa-money-bill-wave',
            kyc: 'fa-id-card',
            referral: 'fa-users',
            system: 'fa-cog'
        };
        return icons[type] || 'fa-bell';
    }
    
    static getNotificationTypeColor(type) {
        const colors = {
            info: 'bg-primary',
            success: 'bg-success',
            warning: 'bg-warning',
            error: 'bg-danger',
            investment: 'bg-primary',
            withdrawal: 'bg-danger',
            deposit: 'bg-success',
            kyc: 'bg-info',
            referral: 'bg-purple',
            system: 'bg-secondary'
        };
        return colors[type] || 'bg-secondary';
    }
    
    static showDashboardError(message) {
        const container = document.querySelector('.dashboard-content');
        if (container) {
            container.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                    <h4 class="text-warning">Failed to Load Dashboard</h4>
                    <p class="text-muted">${message}</p>
                    <button class="btn btn-primary mt-3" onclick="DashboardManager.loadDashboardData()">
                        <i class="fas fa-redo"></i> Retry
                    </button>
                </div>
            `;
        }
    }
}

// ===== ENHANCED INVESTMENT MANAGER WITH DUPLICATE PREVENTION =====
class InvestmentManager {
    static currentPlan = null;
    
    static async loadInvestments() {
        Debug.info('Investment', 'Loading investments...');
        
        try {
            Utils.showLoader('Loading investments...');
            
            const plansResponse = await ApiService.getPlans();
            if (plansResponse.success) {
                this.renderInvestmentPlans(plansResponse.data.plans || []);
            }
            
            const investmentsResponse = await ApiService.getInvestments();
            if (investmentsResponse.success) {
                this.renderInvestmentsTable(investmentsResponse.data.investments || []);
            }
            
            Debug.info('Investment', 'Investments loaded successfully');
        } catch (error) {
            Debug.error('Investment', 'Failed to load investments:', error);
            this.showInvestmentError('Failed to load investments');
        } finally {
            Utils.hideLoader();
        }
    }
    
    static renderInvestmentPlans(plans) {
        Debug.info('Investment', 'Rendering investment plans...');
        
        const container = document.getElementById('investmentPlans');
        if (!container) return;
        
        try {
            if (!plans || plans.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">No investment plans available</h4>
                        <p class="text-muted">Please check back later or contact support.</p>
                    </div>
                `;
                return;
            }
            
            const plansHTML = plans.map(plan => {
                const isPopular = plan.is_popular || false;
                const icon = this.getPlanIcon(plan.category);
                const color = this.getPlanColor(plan.category);
                const maxAmount = plan.max_amount || 'Unlimited';
                
                return `
                    <div class="plan-card">
                        ${isPopular ? '<span class="plan-badge popular">Most Popular</span>' : ''}
                        <div class="plan-header">
                            <div class="plan-icon" style="background: ${color.background}; color: ${color.color};">
                                <i class="${icon}"></i>
                            </div>
                            <h3>${plan.name || 'Unnamed Plan'}</h3>
                            <p class="text-muted">${plan.description || 'No description available'}</p>
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Minimum: ${Utils.formatCurrency(plan.min_amount || 0)}</li>
                            <li><i class="fas fa-check"></i> Maximum: ${maxAmount === 'Unlimited' ? 'Unlimited' : Utils.formatCurrency(maxAmount)}</li>
                            <li><i class="fas fa-check"></i> Daily Interest: ${plan.daily_interest || 0}%</li>
                            <li><i class="fas fa-check"></i> Total Return: ${plan.total_interest || 0}%</li>
                            <li><i class="fas fa-check"></i> Duration: ${plan.duration || 0} Days</li>
                            <li><i class="fas fa-check"></i> Raw Material: ${plan.raw_material || 'N/A'}</li>
                        </ul>
                        <div class="plan-stats">
                            <div class="plan-stat">
                                <div class="plan-stat-value">${plan.daily_interest || 0}%</div>
                                <div class="plan-stat-label">Daily ROI</div>
                            </div>
                            <div class="plan-stat">
                                <div class="plan-stat-value">${plan.total_interest || 0}%</div>
                                <div class="plan-stat-label">Total ROI</div>
                            </div>
                            <div class="plan-stat">
                                <div class="plan-stat-value">${plan.duration || 0}</div>
                                <div class="plan-stat-label">Days</div>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-block invest-btn"
                            data-plan-id="${plan._id}"
                            data-plan-name="${plan.name}"
                            data-min-amount="${plan.min_amount}"
                            data-max-amount="${plan.max_amount || ''}"
                            data-daily-interest="${plan.daily_interest}"
                            data-total-interest="${plan.total_interest}"
                            data-duration="${plan.duration}"
                            data-category="${plan.category}"
                            data-raw-material="${plan.raw_material}">
                            <i class="fas fa-chart-line"></i> Invest Now
                        </button>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = plansHTML;
            
            container.querySelectorAll('.invest-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const planData = {
                        id: btn.dataset.planId,
                        name: btn.dataset.planName,
                        minAmount: parseFloat(btn.dataset.minAmount) || 0,
                        maxAmount: btn.dataset.maxAmount ? parseFloat(btn.dataset.maxAmount) : null,
                        dailyInterest: parseFloat(btn.dataset.dailyInterest) || 0,
                        totalInterest: parseFloat(btn.dataset.totalInterest) || 0,
                        duration: parseInt(btn.dataset.duration) || 0,
                        category: btn.dataset.category,
                        rawMaterial: btn.dataset.rawMaterial
                    };
                    this.showInvestmentModal(planData);
                });
            });
            
            Debug.info('Investment', `Rendered ${plans.length} investment plans`);
        } catch (error) {
            Debug.error('Investment', 'Failed to render investment plans:', error);
            container.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                    <h4 class="text-warning">Failed to Load Plans</h4>
                    <p class="text-muted">Please try again later.</p>
                </div>
            `;
        }
    }
    
    static renderInvestmentsTable(investments) {
        Debug.info('Investment', 'Rendering investments table...');
        
        const container = document.getElementById('investmentsTable');
        if (!container) return;
        
        try {
            if (!investments || investments.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-chart-line fa-2x text-muted mb-3"></i>
                            <h4 class="text-muted">No investments yet</h4>
                            <p class="text-muted">Start your first investment today!</p>
                            <button class="btn btn-primary mt-2" data-action="new-investment">
                                <i class="fas fa-plus"></i> Start Investing
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const investmentsHTML = investments.map(investment => {
                const plan = investment.plan || {};
                const status = investment.status || 'pending';
                const statusClass = this.getStatusClass(status);
                const statusText = this.getStatusText(status);
                const endDate = investment.end_date ? new Date(investment.end_date) : null;
                const isActive = status === 'active';
                const daysRemaining = isActive && endDate ? Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24)) : 0;
                
                return `
                    <tr>
                        <td>${plan.name || 'N/A'}</td>
                        <td>${Utils.formatCurrency(investment.amount)}</td>
                        <td>${Utils.formatDate(investment.start_date)}</td>
                        <td>
                            ${endDate ? Utils.formatDate(investment.end_date) : 'N/A'}
                            ${isActive && daysRemaining > 0 ? `<br><small class="text-muted">${daysRemaining} days remaining</small>` : ''}
                        </td>
                        <td class="text-success">${Utils.formatCurrency(investment.earned_so_far || 0)}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-secondary view-investment" data-id="${investment._id}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            container.innerHTML = investmentsHTML;
            
            Debug.info('Investment', `Rendered ${investments.length} investments`);
        } catch (error) {
            Debug.error('Investment', 'Failed to render investments table:', error);
            container.innerHTML = `
                <tr>
                    <td colspan="7" class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <h4 class="text-warning">Failed to Load Investments</h4>
                        <p class="text-muted">Please try again later.</p>
                    </td>
                </tr>
            `;
        }
    }
    
    static showInvestmentModal(planData) {
        Debug.info('Investment', 'Showing investment modal for plan:', planData.name);
        
        this.currentPlan = planData;
        
        document.getElementById('modalPlanName').textContent = planData.name;
        document.getElementById('modalMinAmount').textContent = Utils.formatCurrency(planData.minAmount);
        
        if (planData.maxAmount) {
            document.getElementById('modalMinAmount').innerHTML += ` (Max: ${Utils.formatCurrency(planData.maxAmount)})`;
        }
        
        const amountInput = document.getElementById('modalInvestmentAmount');
        if (amountInput) {
            amountInput.value = planData.minAmount;
            amountInput.min = planData.minAmount;
            amountInput.max = planData.maxAmount || '';
            amountInput.placeholder = `Enter amount (Min: ${Utils.formatCurrency(planData.minAmount)}${planData.maxAmount ? `, Max: ${Utils.formatCurrency(planData.maxAmount)}` : ''})`;
            
            // Add event listener for input validation
            amountInput.addEventListener('input', (e) => {
                this.validateInvestmentAmount(e.target);
            });
        }
        
        document.getElementById('summaryPlanName').textContent = planData.name;
        document.getElementById('summaryDailyInterest').textContent = `${planData.dailyInterest}%`;
        document.getElementById('summaryDuration').textContent = `${planData.duration} days`;
        
        this.updateInvestmentSummary();
        
        const modal = document.getElementById('investmentModal');
        if (modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        this.setupInvestmentModalEvents();
    }
    
    static validateInvestmentAmount(input) {
        const value = parseFloat(input.value) || 0;
        const minAmount = this.currentPlan.minAmount;
        const maxAmount = this.currentPlan.maxAmount;
        
        // Clear any previous validation messages
        const existingError = input.parentElement.querySelector('.validation-error');
        if (existingError) {
            existingError.remove();
        }
        
        if (value < minAmount) {
            this.showValidationError(input, `Minimum investment is ${Utils.formatCurrency(minAmount)}`);
            return false;
        }
        
        if (maxAmount && value > maxAmount) {
            this.showValidationError(input, `Maximum investment is ${Utils.formatCurrency(maxAmount)}`);
            return false;
        }
        
        // Check user balance
        if (currentUser && value > currentUser.balance) {
            this.showValidationError(input, `Insufficient balance. Available: ${Utils.formatCurrency(currentUser.balance)}`);
            return false;
        }
        
        return true;
    }
    
    static showValidationError(input, message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'validation-error text-danger small mt-1';
        errorDiv.textContent = message;
        
        // Remove existing error if any
        const existingError = input.parentElement.querySelector('.validation-error');
        if (existingError) {
            existingError.remove();
        }
        
        input.parentElement.appendChild(errorDiv);
        input.classList.add('is-invalid');
    }
    
    static setupInvestmentModalEvents() {
        const form = document.getElementById('investmentModalForm');
        const amountInput = document.getElementById('modalInvestmentAmount');
        const paymentMethodSelect = document.getElementById('modalPaymentMethod');
        const paymentProofSection = document.getElementById('modalPaymentProofSection');
        
        if (!form || !amountInput || !paymentMethodSelect) {
            Debug.error('Investment', 'Modal elements not found');
            return;
        }
        
        // Clear input field when user clicks on it
        amountInput.addEventListener('focus', () => {
            if (parseFloat(amountInput.value) === this.currentPlan.minAmount) {
                amountInput.value = '';
            }
        });
        
        // Restore min amount if user leaves field empty
        amountInput.addEventListener('blur', () => {
            if (!amountInput.value || parseFloat(amountInput.value) === 0) {
                amountInput.value = this.currentPlan.minAmount;
            }
        });
        
        amountInput.addEventListener('input', () => {
            // Clear validation error
            amountInput.classList.remove('is-invalid');
            const existingError = amountInput.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
            
            this.updateInvestmentSummary();
        });
        
        paymentMethodSelect.addEventListener('change', (e) => {
            const showProof = e.target.value !== 'wallet';
            if (paymentProofSection) {
                paymentProofSection.classList.toggle('d-none', !showProof);
                
                // If wallet is selected, hide proof requirement message
                if (e.target.value === 'wallet') {
                    const proofMessage = document.getElementById('proofRequirementMessage');
                    if (proofMessage) proofMessage.remove();
                } else {
                    // Show proof requirement message
                    if (!document.getElementById('proofRequirementMessage')) {
                        const messageHTML = `
                            <div class="alert alert-info mt-3" id="proofRequirementMessage">
                                <i class="fas fa-info-circle mr-2"></i>
                                <strong>Important:</strong> Upload payment proof for admin verification. 
                                If you forgot to add proof, your investment will still be submitted to admin for review.
                            </div>
                        `;
                        paymentProofSection.insertAdjacentHTML('beforeend', messageHTML);
                    }
                }
            }
        });
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.submitInvestment();
        });
        
        const closeBtn = document.querySelector('#investmentModal .modal-close');
        const backdrop = document.querySelector('#investmentModal .modal-backdrop');
        
        const closeModal = () => {
            const modal = document.getElementById('investmentModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
                form.reset();
                
                // Reset amount to plan minimum
                if (amountInput && this.currentPlan) {
                    amountInput.value = this.currentPlan.minAmount;
                }
                
                // Clear validation errors
                amountInput.classList.remove('is-invalid');
                const existingError = amountInput.parentElement.querySelector('.validation-error');
                if (existingError) {
                    existingError.remove();
                }
            }
        };
        
        if (closeBtn) closeBtn.addEventListener('click', closeModal);
        if (backdrop) backdrop.addEventListener('click', closeModal);
    }
    
    static updateInvestmentSummary() {
        if (!this.currentPlan) return;
        
        const amountInput = document.getElementById('modalInvestmentAmount');
        if (!amountInput) return;
        
        const amount = parseFloat(amountInput.value) || 0;
        const minAmount = this.currentPlan.minAmount;
        
        // Validate amount
        if (!this.validateInvestmentAmount(amountInput)) {
            return;
        }
        
        if (amount < minAmount) {
            amountInput.value = minAmount;
            return;
        }
        
        const expectedEarnings = (amount * this.currentPlan.totalInterest) / 100;
        const dailyEarnings = (amount * this.currentPlan.dailyInterest) / 100;
        
        document.getElementById('summaryEarnings').textContent = Utils.formatCurrency(expectedEarnings);
        document.getElementById('summaryTotalReturn').textContent = Utils.formatCurrency(amount + expectedEarnings);
        
        Debug.debug('Investment', 'Investment summary updated', {
            amount,
            expectedEarnings,
            totalReturn: amount + expectedEarnings
        });
    }
    
    static async submitInvestment() {
        Debug.info('Investment', 'Submitting investment...');
        
        try {
            Utils.showLoader('Processing investment...');
            
            const amountInput = document.getElementById('modalInvestmentAmount');
            const paymentMethodSelect = document.getElementById('modalPaymentMethod');
            const autoRenewCheckbox = document.getElementById('autoRenew');
            const paymentProofInput = document.getElementById('modalPaymentProof');
            
            if (!amountInput || !paymentMethodSelect || !this.currentPlan) {
                throw new Error('Required form elements not found');
            }
            
            const amount = parseFloat(amountInput.value) || 0;
            const paymentMethod = paymentMethodSelect.value;
            const autoRenew = autoRenewCheckbox ? autoRenewCheckbox.checked : false;
            const paymentProof = paymentProofInput ? paymentProofInput.files[0] : null;
            
            // Final validation
            if (!this.validateInvestmentAmount(amountInput)) {
                Utils.hideLoader();
                return;
            }
            
            if (paymentMethod === 'wallet' && currentUser.balance < amount) {
                Utils.showNotification('Insufficient wallet balance', 'error');
                Utils.hideLoader();
                return;
            }
            
            const investmentData = {
                plan_id: this.currentPlan.id,
                amount: amount,
                payment_method: paymentMethod,
                auto_renew: autoRenew
            };
            
            // Allow investment without proof - will be submitted to admin for review
            if (paymentProof) {
                investmentData.payment_proof = paymentProof;
            }
            
            Debug.debug('Investment', 'Investment data:', investmentData);
            
            const response = await ApiService.createInvestment(investmentData);
            
            if (response.success) {
                if (paymentProof) {
                    Utils.showNotification('Investment created successfully! Awaiting admin approval.', 'success');
                } else {
                    Utils.showNotification('Investment created successfully! First interest will be added in 24 hours.', 'success');
                }
                
                if (paymentMethod === 'wallet' && currentUser) {
                    currentUser.balance -= amount;
                    StateManager.set('currentUser', currentUser);
                    AuthManager.updateUI();
                }
                
                const modal = document.getElementById('investmentModal');
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
                
                await this.loadInvestments();
                
                Debug.info('Investment', 'Investment submitted successfully');
            } else {
                Utils.showNotification(response.message || 'Investment failed', 'error');
            }
        } catch (error) {
            if (error.message === 'Duplicate investment cancelled by user') {
                Debug.info('Investment', 'User cancelled duplicate investment');
                return;
            }
            Debug.error('Investment', 'Failed to submit investment:', error);
            Utils.showError(error, 'Investment Submission');
        } finally {
            Utils.hideLoader();
        }
    }
    
    static getPlanIcon(category) {
        const icons = {
            agriculture: 'fas fa-seedling',
            mining: 'fas fa-mountain',
            energy: 'fas fa-bolt',
            metals: 'fas fa-gem',
            crypto: 'fab fa-bitcoin',
            real_estate: 'fas fa-home',
            precious_stones: 'fas fa-gem',
            livestock: 'fas fa-paw',
            timber: 'fas fa-tree',
            aquaculture: 'fas fa-fish'
        };
        return icons[category] || 'fas fa-chart-line';
    }
    
    static getPlanColor(category) {
        const colors = {
            agriculture: { background: 'rgba(16, 185, 129, 0.2)', color: '#10B981' },
            mining: { background: 'rgba(107, 114, 128, 0.2)', color: '#6B7280' },
            energy: { background: 'rgba(245, 158, 11, 0.2)', color: '#F59E0B' },
            metals: { background: 'rgba(251, 191, 36, 0.2)', color: '#FBBF24' },
            crypto: { background: 'rgba(139, 92, 246, 0.2)', color: '#8B5CF6' },
            real_estate: { background: 'rgba(59, 130, 246, 0.2)', color: '#3B82F6' },
            precious_stones: { background: 'rgba(236, 72, 153, 0.2)', color: '#EC4899' },
            livestock: { background: 'rgba(239, 68, 68, 0.2)', color: '#EF4444' },
            timber: { background: 'rgba(101, 163, 13, 0.2)', color: '#65A30D' },
            aquaculture: { background: 'rgba(6, 182, 212, 0.2)', color: '#06B6D4' }
        };
        return colors[category] || { background: 'rgba(124, 58, 237, 0.2)', color: '#7C3AED' };
    }
    
    static getStatusClass(status) {
        const classes = {
            pending: 'badge-warning',
            active: 'badge-success',
            completed: 'badge-primary',
            cancelled: 'badge-secondary',
            failed: 'badge-danger',
            rejected: 'badge-danger'
        };
        return classes[status] || 'badge-secondary';
    }
    
    static getStatusText(status) {
        const texts = {
            pending: 'Pending',
            active: 'Active',
            completed: 'Completed',
            cancelled: 'Cancelled',
            failed: 'Failed',
            rejected: 'Rejected'
        };
        return texts[status] || status;
    }
    
    static showInvestmentError(message) {
        const plansContainer = document.getElementById('investmentPlans');
        const tableContainer = document.getElementById('investmentsTable');
        
        if (plansContainer) {
            plansContainer.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                    <h4 class="text-warning">Failed to Load Plans</h4>
                    <p class="text-muted">${message}</p>
                    <button class="btn btn-primary mt-3" onclick="InvestmentManager.loadInvestments()">
                        <i class="fas fa-redo"></i> Retry
                    </button>
                </div>
            `;
        }
        
        if (tableContainer) {
            tableContainer.innerHTML = `
                <tr>
                    <td colspan="7" class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <h4 class="text-warning">Failed to Load Investments</h4>
                        <p class="text-muted">${message}</p>
                        <button class="btn btn-primary mt-3" onclick="InvestmentManager.loadInvestments()">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                    </td>
                </tr>
            `;
        }
    }
}

// ===== ENHANCED DEPOSIT MANAGER WITH DUPLICATE PREVENTION =====
class DepositManager {
    static async loadDeposits() {
        Debug.info('Deposit', 'Loading deposits...');
        
        try {
            Utils.showLoader('Loading deposits...');
            
            const response = await ApiService.getDeposits();
            
            if (response.success) {
                const deposits = response.data.deposits || [];
                this.renderDepositsTable(deposits);
                this.updateDepositStats(deposits);
                
                // Update bank details section
                this.updateBankDetailsSection();
                
                Debug.info('Deposit', `Loaded ${deposits.length} deposits`);
            } else {
                Debug.warn('Deposit', 'Failed to load deposits:', response.message);
                this.showDepositError('Failed to load deposits');
            }
        } catch (error) {
            Debug.error('Deposit', 'Failed to load deposits:', error);
            this.showDepositError('Failed to load deposits');
        } finally {
            Utils.hideLoader();
        }
    }
    
    static renderDepositsTable(deposits) {
        Debug.info('Deposit', 'Rendering deposits table...');
        
        const container = document.getElementById('depositsTable');
        if (!container) return;
        
        try {
            if (!deposits || deposits.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-5">
                            <i class="fas fa-money-bill-wave fa-2x text-muted mb-3"></i>
                            <h4 class="text-muted">No deposits yet</h4>
                            <p class="text-muted">Make your first deposit to start investing!</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const depositsHTML = deposits.map(deposit => {
                const status = deposit.status || 'pending';
                const statusClass = this.getStatusClass(status);
                const statusText = this.getStatusText(status);
                
                return `
                    <tr>
                        <td>${deposit.reference || 'N/A'}</td>
                        <td>${Utils.formatCurrency(deposit.amount)}</td>
                        <td>${this.getPaymentMethodText(deposit.payment_method)}</td>
                        <td>${Utils.formatDate(deposit.createdAt)}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td>
                            ${deposit.payment_proof_url ?
                                `<button class="btn btn-sm btn-secondary view-proof" data-url="${deposit.payment_proof_url}">
                                    <i class="fas fa-eye"></i> View
                                </button>` :
                                '<span class="text-muted">No proof</span>'
                            }
                        </td>
                    </tr>
                `;
            }).join('');
            
            container.innerHTML = depositsHTML;
            
            Debug.info('Deposit', `Rendered ${deposits.length} deposits`);
        } catch (error) {
            Debug.error('Deposit', 'Failed to render deposits table:', error);
            container.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <h4 class="text-warning">Failed to Load Deposits</h4>
                        <p class="text-muted">Please try again later.</p>
                    </td>
                </tr>
            `;
        }
    }
    
    static updateDepositStats(deposits) {
        Debug.info('Deposit', 'Updating deposit stats...');
        
        try {
            const total = deposits.reduce((sum, deposit) => sum + (deposit.amount || 0), 0);
            const pending = deposits
                .filter(d => d.status === 'pending')
                .reduce((sum, d) => sum + (d.amount || 0), 0);
            const approved = deposits
                .filter(d => d.status === 'approved')
                .reduce((sum, d) => sum + (d.amount || 0), 0);
            
            document.getElementById('totalDeposits').textContent = Utils.formatCurrency(total);
            document.getElementById('pendingDeposits').textContent = Utils.formatCurrency(pending);
            document.getElementById('approvedDeposits').textContent = Utils.formatCurrency(approved);
            
            Debug.debug('Deposit', 'Deposit stats updated', { total, pending, approved });
        } catch (error) {
            Debug.error('Deposit', 'Failed to update deposit stats:', error);
        }
    }
    
    static updateBankDetailsSection() {
        const bankDetailsInfo = document.getElementById('bankDetailsInfo');
        if (!bankDetailsInfo) return;
        
        const hasUserBankDetails = Utils.hasBankDetails(currentUser);
        
        // Clear existing content
        bankDetailsInfo.innerHTML = '';
        
        if (hasUserBankDetails) {
            bankDetailsInfo.innerHTML = `
                <div class="bank-details-card p-3 border rounded">
                    <h6 class="mb-3">Your Bank Details</h6>
                    <div class="mb-2">
                        <small class="text-muted">Bank Name</small>
                        <div>${currentUser.bank_details.bank_name || 'N/A'}</div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Account Name</small>
                        <div>${currentUser.bank_details.account_name || 'N/A'}</div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted">Account Number</small>
                        <div>${currentUser.bank_details.account_number || 'N/A'}</div>
                    </div>
                    <button class="btn btn-sm btn-outline w-100" data-action="add-bank-details">
                        <i class="fas fa-edit"></i> Update Bank Details
                    </button>
                </div>
            `;
        }
        
        const platformDetailsHTML = `
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">Platform Bank Details for Deposit</h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-3">
                        <i class="fas fa-info-circle mr-2"></i>
                        <strong>Deposit Instructions:</strong> Transfer to the account below and upload payment proof
                    </div>
                    
                    <div class="bank-details-transfer p-3 border rounded bg-dark-card">
                        <div class="bank-detail-item mb-3">
                            <div class="d-flex align-center mb-1">
                                <i class="fas fa-university text-primary mr-2"></i>
                                <small class="text-muted">Bank Name</small>
                            </div>
                            <div class="bank-value font-weight-bold">${CONFIG.PLATFORM_BANK_DETAILS.bank_name}</div>
                        </div>
                        
                        <div class="bank-detail-item mb-3">
                            <div class="d-flex align-center mb-1">
                                <i class="fas fa-user text-primary mr-2"></i>
                                <small class="text-muted">Account Name</small>
                            </div>
                            <div class="bank-value font-weight-bold">${CONFIG.PLATFORM_BANK_DETAILS.account_name}</div>
                        </div>
                        
                        <div class="bank-detail-item mb-3">
                            <div class="d-flex align-center mb-1">
                                <i class="fas fa-credit-card text-primary mr-2"></i>
                                <small class="text-muted">Account Number</small>
                            </div>
                            <div class="bank-value font-weight-bold">${CONFIG.PLATFORM_BANK_DETAILS.account_number}</div>
                        </div>
                        
                        <div class="d-flex align-center justify-between mb-3">
                            <div class="copy-bank-details">
                                <button class="btn btn-sm btn-primary" id="copyBankDetails">
                                    <i class="fas fa-copy mr-1"></i> Copy All Details
                                </button>
                            </div>
                            <div class="share-bank-details">
                                <button class="btn btn-sm btn-outline" id="shareBankDetails">
                                    <i class="fas fa-share-alt mr-1"></i> Share
                                </button>
                            </div>
                        </div>
                        
                        <div class="bank-instructions mt-3 p-3 border rounded">
                            <h6 class="mb-2"><i class="fas fa-lightbulb text-warning mr-2"></i>Important Instructions:</h6>
                            <ul class="mb-0 pl-3">
                                <li class="mb-1 small">Use your registered name as depositor name</li>
                                <li class="mb-1 small">Minimum deposit amount: ${Utils.formatCurrency(CONFIG.MIN_DEPOSIT)}</li>
                                <li class="mb-1 small">Upload clear screenshot of payment confirmation</li>
                                <li class="small">Deposits are processed within 1-24 hours</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="quick-actions mt-4">
                        <h6 class="mb-3">Quick Actions:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-sm btn-outline" data-action="save-bank-details">
                                <i class="fas fa-save mr-1"></i> Save Details
                            </button>
                            <button class="btn btn-sm btn-outline" data-action="print-bank-details">
                                <i class="fas fa-print mr-1"></i> Print
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        bankDetailsInfo.insertAdjacentHTML('beforeend', platformDetailsHTML);
        
        this.setupBankDetailsEvents();
    }
    
    static setupBankDetailsEvents() {
        const copyBtn = document.getElementById('copyBankDetails');
        if (copyBtn) {
            copyBtn.addEventListener('click', async () => {
                const bankDetails = `Bank Name: ${CONFIG.PLATFORM_BANK_DETAILS.bank_name}\nAccount Name: ${CONFIG.PLATFORM_BANK_DETAILS.account_name}\nAccount Number: ${CONFIG.PLATFORM_BANK_DETAILS.account_number}\n\n${CONFIG.PLATFORM_BANK_DETAILS.note}`;
                await Utils.copyToClipboard(bankDetails);
            });
        }
        
        const shareBtn = document.getElementById('shareBankDetails');
        if (shareBtn) {
            shareBtn.addEventListener('click', () => {
                const shareText = `Deposit to Raw Wealthy:\nBank: ${CONFIG.PLATFORM_BANK_DETAILS.bank_name}\nAccount: ${CONFIG.PLATFORM_BANK_DETAILS.account_name}\nNumber: ${CONFIG.PLATFORM_BANK_DETAILS.account_number}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Raw Wealthy Bank Details',
                        text: shareText,
                        url: window.location.href
                    }).catch(err => {
                        console.log('Error sharing:', err);
                    });
                } else {
                    Utils.copyToClipboard(shareText);
                }
            });
        }
        
        const saveBtn = document.querySelector('[data-action="save-bank-details"]');
        if (saveBtn) {
            saveBtn.addEventListener('click', () => {
                const bankDetails = {
                    bank_name: CONFIG.PLATFORM_BANK_DETAILS.bank_name,
                    account_name: CONFIG.PLATFORM_BANK_DETAILS.account_name,
                    account_number: CONFIG.PLATFORM_BANK_DETAILS.account_number,
                    note: CONFIG.PLATFORM_BANK_DETAILS.note
                };
                
                StateManager.set('platformBankDetails', bankDetails);
                Utils.showNotification('Bank details saved for quick access!', 'success');
            });
        }
        
        const printBtn = document.querySelector('[data-action="print-bank-details"]');
        if (printBtn) {
            printBtn.addEventListener('click', () => {
                const printContent = `
                    <div style="padding: 20px; font-family: Arial, sans-serif;">
                        <h2 style="color: #7C3AED; margin-bottom: 20px;">Raw Wealthy - Bank Details for Deposit</h2>
                        <div style="margin-bottom: 15px;">
                            <strong>Bank Name:</strong> ${CONFIG.PLATFORM_BANK_DETAILS.bank_name}
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Account Name:</strong> ${CONFIG.PLATFORM_BANK_DETAILS.account_name}
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Account Number:</strong> ${CONFIG.PLATFORM_BANK_DETAILS.account_number}
                        </div>
                        <div style="margin-top: 30px; padding: 15px; border: 1px solid #ccc; border-radius: 5px;">
                            <strong>Important Instructions:</strong>
                            <ul style="margin-top: 10px;">
                                <li>Use your registered name as depositor name</li>
                                <li>Minimum deposit amount: ${Utils.formatCurrency(CONFIG.MIN_DEPOSIT)}</li>
                                <li>Upload clear screenshot of payment confirmation</li>
                                <li>Deposits are processed within 1-24 hours</li>
                            </ul>
                        </div>
                        <div style="margin-top: 20px; font-size: 12px; color: #666;">
                            Printed from Raw Wealthy Platform on ${new Date().toLocaleDateString()}
                        </div>
                `;
                
                const printWindow = window.open('', '_blank');
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.print();
            });
        }
    }
    
    static async submitDeposit(e) {
        Debug.info('Deposit', 'Submitting deposit...');
        
        if (e) e.preventDefault();
        
        try {
            Utils.showLoader('Processing deposit...');
            
            const amountInput = document.getElementById('depositAmount');
            const paymentMethodRadio = document.querySelector('input[name="paymentMethod"]:checked');
            const paymentProofInput = document.getElementById('paymentProof');
            
            if (!amountInput || !paymentMethodRadio) {
                throw new Error('Required form elements not found');
            }
            
            const amount = parseFloat(amountInput.value) || 0;
            const paymentMethod = paymentMethodRadio.value;
            const paymentProof = paymentProofInput ? paymentProofInput.files[0] : null;
            
            if (amount < CONFIG.MIN_DEPOSIT) {
                Utils.showNotification(`Minimum deposit amount is ${Utils.formatCurrency(CONFIG.MIN_DEPOSIT)}`, 'error');
                return;
            }
            
            const depositData = {
                amount: amount,
                payment_method: paymentMethod
            };
            
            // Allow deposit without proof - will be submitted to admin for review
            if (paymentProof) {
                depositData.payment_proof = paymentProof;
            }
            
            Debug.debug('Deposit', 'Deposit data:', depositData);
            
            const response = await ApiService.createDeposit(depositData);
            
            if (response.success) {
                if (paymentProof) {
                    Utils.showNotification('Deposit request submitted successfully! Awaiting admin approval.', 'success');
                } else {
                    Utils.showNotification('Deposit request submitted! Please upload payment proof when available.', 'warning');
                }
                
                const form = document.getElementById('depositForm');
                if (form) form.reset();
                
                if (amountInput) amountInput.value = CONFIG.MIN_DEPOSIT;
                
                await this.loadDeposits();
                
                Debug.info('Deposit', 'Deposit submitted successfully');
            } else {
                Utils.showNotification(response.message || 'Deposit failed', 'error');
            }
        } catch (error) {
            if (error.message === 'Duplicate deposit cancelled by user') {
                Debug.info('Deposit', 'User cancelled duplicate deposit');
                return;
            }
            Debug.error('Deposit', 'Failed to submit deposit:', error);
            Utils.showError(error, 'Deposit Submission');
        } finally {
            Utils.hideLoader();
        }
    }
    
    static getStatusClass(status) {
        const classes = {
            pending: 'badge-warning',
            approved: 'badge-success',
            rejected: 'badge-danger',
            cancelled: 'badge-secondary'
        };
        return classes[status] || 'badge-secondary';
    }
    
    static getStatusText(status) {
        const texts = {
            pending: 'Pending',
            approved: 'Approved',
            rejected: 'Rejected',
            cancelled: 'Cancelled'
        };
        return texts[status] || status;
    }
    
    static getPaymentMethodText(method) {
        const texts = {
            bank_transfer: 'Bank Transfer',
            crypto: 'Cryptocurrency',
            paypal: 'PayPal',
            card: 'Card',
            flutterwave: 'Flutterwave',
            paystack: 'Paystack'
        };
        return texts[method] || method;
    }
    
    static showDepositError(message) {
        const container = document.getElementById('depositsTable');
        if (container) {
            container.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <h4 class="text-warning">Failed to Load Deposits</h4>
                        <p class="text-muted">${message}</p>
                        <button class="btn btn-primary mt-3" onclick="DepositManager.loadDeposits()">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                    </td>
                </tr>
            `;
        }
    }
}

// ===== ENHANCED WITHDRAWAL MANAGER WITH DUPLICATE PREVENTION =====
class WithdrawalManager {
    static async loadWithdrawals() {
        Debug.info('Withdrawal', 'Loading withdrawals...');
        
        try {
            Utils.showLoader('Loading withdrawals...');
            
            const response = await ApiService.getWithdrawals();
            
            if (response.success) {
                const withdrawals = response.data.withdrawals || [];
                this.renderWithdrawalsTable(withdrawals);
                this.updateWithdrawalStats(withdrawals);
                Debug.info('Withdrawal', `Loaded ${withdrawals.length} withdrawals`);
            } else {
                Debug.warn('Withdrawal', 'Failed to load withdrawals:', response.message);
                this.showWithdrawalError('Failed to load withdrawals');
            }
        } catch (error) {
            Debug.error('Withdrawal', 'Failed to load withdrawals:', error);
            this.showWithdrawalError('Failed to load withdrawals');
        } finally {
            Utils.hideLoader();
        }
    }
    
    static renderWithdrawalsTable(withdrawals) {
        Debug.info('Withdrawal', 'Rendering withdrawals table...');
        
        const container = document.getElementById('withdrawalsTable');
        if (!container) return;
        
        try {
            if (!withdrawals || withdrawals.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-5">
                            <i class="fas fa-wallet fa-2x text-muted mb-3"></i>
                            <h4 class="text-muted">No withdrawals yet</h4>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const withdrawalsHTML = withdrawals.map(withdrawal => {
                const status = withdrawal.status || 'pending';
                const statusClass = this.getStatusClass(status);
                const statusText = this.getStatusText(status);
                
                return `
                    <tr>
                        <td>${withdrawal.reference || 'N/A'}</td>
                        <td>${Utils.formatCurrency(withdrawal.amount)}</td>
                        <td>${this.getPaymentMethodText(withdrawal.payment_method)}</td>
                        <td>${Utils.formatDate(withdrawal.createdAt)}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-secondary view-withdrawal" data-id="${withdrawal._id}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            container.innerHTML = withdrawalsHTML;
            
            Debug.info('Withdrawal', `Rendered ${withdrawals.length} withdrawals`);
        } catch (error) {
            Debug.error('Withdrawal', 'Failed to render withdrawals table:', error);
            container.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <h4 class="text-warning">Failed to Load Withdrawals</h4>
                        <p class="text-muted">Please try again later.</p>
                    </td>
                </tr>
            `;
        }
    }
    
    static updateWithdrawalStats(withdrawals) {
        Debug.info('Withdrawal', 'Updating withdrawal stats...');
        
        try {
            const total = withdrawals.reduce((sum, w) => sum + (w.amount || 0), 0);
            const pending = withdrawals
                .filter(w => w.status === 'pending')
                .reduce((sum, w) => sum + (w.amount || 0), 0);
            const paid = withdrawals
                .filter(w => w.status === 'paid')
                .reduce((sum, w) => sum + (w.amount || 0), 0);
            
            document.getElementById('totalWithdrawals').textContent = Utils.formatCurrency(total);
            document.getElementById('pendingWithdrawals').textContent = Utils.formatCurrency(pending);
            document.getElementById('paidWithdrawals').textContent = Utils.formatCurrency(paid);
            
            Debug.debug('Withdrawal', 'Withdrawal stats updated', { total, pending, paid });
        } catch (error) {
            Debug.error('Withdrawal', 'Failed to update withdrawal stats:', error);
        }
    }
    
    static async submitWithdrawal(e) {
        Debug.info('Withdrawal', 'Submitting withdrawal...');
        
        if (e) e.preventDefault();
        
        try {
            Utils.showLoader('Processing withdrawal...');
            
            const amountInput = document.getElementById('withdrawalAmount');
            
            if (!amountInput) {
                throw new Error('Required form elements not found');
            }
            
            const amount = parseFloat(amountInput.value) || 0;
            
            if (amount < CONFIG.MIN_WITHDRAWAL) {
                Utils.showNotification(`Minimum withdrawal amount is ${Utils.formatCurrency(CONFIG.MIN_WITHDRAWAL)}`, 'error');
                return;
            }
            
            const withdrawableBalance = Utils.calculateWithdrawableBalance(currentUser);
            
            if (amount > withdrawableBalance) {
                Utils.showNotification(`Insufficient withdrawable balance. Available: ${Utils.formatCurrency(withdrawableBalance)}`, 'error');
                return;
            }
            
            if (!Utils.hasBankDetails(currentUser)) {
                Utils.showNotification('Please add your bank details in profile settings before making a withdrawal', 'error');
                Router.navigateTo('profile');
                return;
            }
            
            const response = await ApiService.createWithdrawal(amount, 'bank_transfer');
            
            if (response.success) {
                Utils.showNotification('Withdrawal request submitted successfully! It will be processed by admin.', 'success');
                
                const form = document.getElementById('withdrawalForm');
                if (form) form.reset();
                
                if (amountInput) amountInput.value = CONFIG.MIN_WITHDRAWAL;
                
                await this.loadWithdrawals();
                
                Debug.info('Withdrawal', 'Withdrawal submitted successfully');
            } else {
                Utils.showNotification(response.message || 'Withdrawal failed', 'error');
            }
        } catch (error) {
            if (error.message === 'Duplicate withdrawal cancelled by user') {
                Debug.info('Withdrawal', 'User cancelled duplicate withdrawal');
                return;
            }
            Debug.error('Withdrawal', 'Failed to submit withdrawal:', error);
            Utils.showError(error, 'Withdrawal Submission');
        } finally {
            Utils.hideLoader();
        }
    }
    
    static updateWithdrawalForm() {
        const withdrawalForm = document.getElementById('withdrawalForm');
        if (!withdrawalForm) return;
        
        const withdrawableBalance = Utils.calculateWithdrawableBalance(currentUser);
        const hasBankDetails = Utils.hasBankDetails(currentUser);
        
        const availableBalanceElement = document.getElementById('availableBalance');
        if (availableBalanceElement) {
            availableBalanceElement.textContent = Utils.formatCurrency(withdrawableBalance);
        }
        
        const withdrawalDetails = document.getElementById('withdrawalDetails');
        if (withdrawalDetails) {
            if (hasBankDetails) {
                withdrawalDetails.innerHTML = `
                    <div class="alert alert-success">
                        <div class="d-flex align-start">
                            <i class="fas fa-check-circle mt-1 mr-2"></i>
                            <div>
                                <h6 class="mb-2">Bank Details Verified</h6>
                                <p class="small mb-1">Your withdrawal will be sent to your registered bank account:</p>
                                <div class="bg-light p-2 rounded small">
                                    <div><strong>Bank:</strong> ${currentUser.bank_details.bank_name}</div>
                                    <div><strong>Account:</strong> ${currentUser.bank_details.account_name}</div>
                                    <div><strong>Number:</strong> ${currentUser.bank_details.account_number}</div>
                                </div>
                                <p class="small mt-2 mb-0">To update bank details, go to <a href="#profile" class="text-primary">Profile Settings</a></p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                withdrawalDetails.innerHTML = `
                    <div class="alert alert-warning">
                        <div class="d-flex align-start">
                            <i class="fas fa-exclamation-triangle mt-1 mr-2"></i>
                            <div>
                                <h6 class="mb-2">Bank Details Required</h6>
                                <p class="small mb-2">Please add your bank details to make withdrawals.</p>
                                <a href="#profile" class="btn btn-sm btn-primary">
                                    <i class="fas fa-university"></i> Add Bank Details
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        const amountInput = document.getElementById('withdrawalAmount');
        if (amountInput) {
            amountInput.max = withdrawableBalance;
        }
        
        this.calculateWithdrawalFees();
    }
    
    static calculateWithdrawalFees() {
        const amountInput = document.getElementById('withdrawalAmount');
        if (!amountInput) return;
        
        const amount = parseFloat(amountInput.value) || 0;
        const platformFee = amount * (CONFIG.PLATFORM_FEE_PERCENT / 100);
        const netAmount = amount - platformFee;
        
        const platformFeeElement = document.getElementById('platformFee');
        const netAmountElement = document.getElementById('netAmount');
        
        if (platformFeeElement) {
            platformFeeElement.textContent = Utils.formatCurrency(platformFee);
        }
        
        if (netAmountElement) {
            netAmountElement.textContent = Utils.formatCurrency(netAmount);
        }
    }
    
    static getStatusClass(status) {
        const classes = {
            pending: 'badge-warning',
            approved: 'badge-info',
            paid: 'badge-success',
            rejected: 'badge-danger',
            processing: 'badge-primary'
        };
        return classes[status] || 'badge-secondary';
    }
    
    static getStatusText(status) {
        const texts = {
            pending: 'Pending',
            approved: 'Approved',
            paid: 'Paid',
            rejected: 'Rejected',
            processing: 'Processing'
        };
        return texts[status] || status;
    }
    
    static getPaymentMethodText(method) {
        const texts = {
            bank_transfer: 'Bank Transfer',
            crypto: 'Cryptocurrency',
            paypal: 'PayPal'
        };
        return texts[method] || method;
    }
    
    static showWithdrawalError(message) {
        const container = document.getElementById('withdrawalsTable');
        if (container) {
            container.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <h4 class="text-warning">Failed to Load Withdrawals</h4>
                        <p class="text-muted">${message}</p>
                        <button class="btn btn-primary mt-3" onclick="WithdrawalManager.loadWithdrawals()">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                    </td>
                </tr>
            `;
        }
    }
}

// ===== ENHANCED EVENT HANDLERS WITH FORGOT PASSWORD =====
class EventHandlers {
    static init() {
        Debug.info('EventHandlers', 'Initializing event handlers...');
        
        this.setupMobileMenu();
        this.setupThemeToggle();
        this.setupLogout();
        this.setupForms();
        this.setupRefreshButtons();
        this.setupFilePreviews();
        this.setupWithdrawalCalculation();
        this.setupReferralActions();
        this.setupForgotPassword();
        
        Debug.info('EventHandlers', 'Event handlers initialized successfully');
    }
    
    static setupMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const sidebarClose = document.getElementById('sidebarClose');
        
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                if (sidebar) sidebar.classList.add('active');
                if (sidebarOverlay) sidebarOverlay.classList.add('active');
                Debug.debug('UI', 'Mobile menu opened');
            });
        }
        
        if (sidebarClose) {
            sidebarClose.addEventListener('click', () => {
                if (sidebar) sidebar.classList.remove('active');
                if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                Debug.debug('UI', 'Mobile menu closed');
            });
        }
        
        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', () => {
                if (sidebar) sidebar.classList.remove('active');
                if (sidebarOverlay) sidebarOverlay.classList.remove('active');
                Debug.debug('UI', 'Mobile menu closed via overlay');
            });
        }
    }
    
    static setupThemeToggle() {
        const themeToggle = document.getElementById('themeToggle');
        if (!themeToggle) return;
        
        const savedTheme = StateManager.get('theme', 'dark');
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        const icon = themeToggle.querySelector('i');
        if (icon) {
            icon.className = savedTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
        }
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            StateManager.set('theme', newTheme);
            
            if (icon) {
                icon.className = newTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
            }
            
            Utils.showNotification(`Switched to ${newTheme} theme`, 'info');
            Debug.debug('UI', `Theme changed to ${newTheme}`);
        });
    }
    
    static setupLogout() {
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                AuthManager.logout();
            });
        }
    }
    
    static setupForgotPassword() {
        const forgotPasswordLink = document.querySelector('a[href="#forgot-password"]');
        if (forgotPasswordLink) {
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                this.showForgotPasswordModal();
            });
        }
    }
    
    static showForgotPasswordModal() {
        const modalHTML = `
            <div class="modal active" id="forgotPasswordModal">
                <div class="modal-backdrop"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Reset Your Password</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="forgotPasswordForm">
                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <div class="input-group">
                                    <i class="input-group-icon fas fa-envelope"></i>
                                    <input type="email" class="form-control" id="forgotPasswordEmail" 
                                           placeholder="Enter your email address" required>
                                </div>
                            </div>
                            <div class="alert alert-info mb-4">
                                <i class="fas fa-info-circle mr-2"></i>
                                We'll send a password reset link to your email address.
                            </div>
                            <button type="submit" class="btn btn-primary btn-block btn-lg">
                                <i class="fas fa-paper-plane"></i> Send Reset Link
                            </button>
                            <div class="text-center mt-3">
                                <a href="#login" class="text-primary">Back to Login</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        const modal = document.getElementById('forgotPasswordModal');
        const form = document.getElementById('forgotPasswordForm');
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('forgotPasswordEmail').value;
            
            if (!Utils.validateEmail(email)) {
                Utils.showNotification('Please enter a valid email address', 'error');
                return;
            }
            
            await AuthManager.forgotPassword(email);
            modal.remove();
        });
        
        modal.querySelector('.modal-close').addEventListener('click', () => {
            modal.remove();
        });
        
        modal.querySelector('.modal-backdrop').addEventListener('click', () => {
            modal.remove();
        });
    }
    
    static setupForms() {
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail')?.value;
                const password = document.getElementById('loginPassword')?.value;
                
                if (!email || !password) {
                    Utils.showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                await AuthManager.login(email, password);
            });
        }
        
        const registerForm = document.getElementById('registerForm');
        if (registerForm) {
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const name = document.getElementById('registerName')?.value;
                const email = document.getElementById('registerEmail')?.value;
                const phone = document.getElementById('registerPhone')?.value;
                const password = document.getElementById('registerPassword')?.value;
                const confirmPassword = document.getElementById('registerConfirmPassword')?.value;
                const referralCode = document.getElementById('registerReferral')?.value;
                
                if (!name || !email || !phone || !password || !confirmPassword) {
                    Utils.showNotification('Please fill in all required fields', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    Utils.showNotification('Passwords do not match', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    Utils.showNotification('Password must be at least 6 characters', 'error');
                    return;
                }
                
                if (!Utils.validateEmail(email)) {
                    Utils.showNotification('Please enter a valid email address', 'error');
                    return;
                }
                
                const userData = {
                    full_name: name,
                    email,
                    phone,
                    password,
                    referral_code: referralCode || undefined
                };
                
                await AuthManager.register(userData);
            });
        }
        
        const depositForm = document.getElementById('depositForm');
        if (depositForm) {
            depositForm.addEventListener('submit', (e) => {
                DepositManager.submitDeposit(e);
            });
        }
        
        const withdrawalForm = document.getElementById('withdrawalForm');
        if (withdrawalForm) {
            withdrawalForm.addEventListener('submit', (e) => {
                WithdrawalManager.submitWithdrawal(e);
            });
        }
        
        const profileForm = document.getElementById('profileForm');
        if (profileForm) {
            profileForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                try {
                    Utils.showLoader('Updating profile...');
                    
                    const profileData = {
                        full_name: document.getElementById('fullName')?.value || '',
                        email: document.getElementById('profileEmailInput')?.value || '',
                        phone: document.getElementById('profilePhone')?.value || '',
                        country: document.getElementById('countrySelect')?.value || '',
                        risk_tolerance: document.getElementById('riskTolerance')?.value || 'medium',
                        investment_strategy: document.getElementById('investmentStrategy')?.value || 'balanced',
                        email_notifications: document.getElementById('emailNotifications')?.checked || false,
                        sms_notifications: document.getElementById('smsNotifications')?.checked || false
                    };
                    
                    Debug.debug('Profile', 'Profile update data:', profileData);
                    
                    const response = await ApiService.updateProfile(profileData);
                    
                    if (response.success) {
                        Utils.showNotification('Profile updated successfully!', 'success');
                        await AuthManager.loadUserData();
                    } else {
                        Utils.showNotification(response.message || 'Profile update failed', 'error');
                    }
                } catch (error) {
                    Debug.error('Profile', 'Failed to update profile:', error);
                    Utils.showError(error, 'Profile Update');
                } finally {
                    Utils.hideLoader();
                }
            });
        }
        
        const bankDetailsForm = document.getElementById('bankDetailsForm');
        if (bankDetailsForm) {
            bankDetailsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                try {
                    Utils.showLoader('Updating bank details...');
                    
                    const bankData = {
                        bank_name: document.getElementById('bankName')?.value || '',
                        account_name: document.getElementById('accountName')?.value || '',
                        account_number: document.getElementById('accountNumber')?.value || '',
                        bank_code: document.getElementById('bankCode')?.value || ''
                    };
                    
                    const response = await ApiService.updateBankDetails(bankData);
                    
                    if (response.success) {
                        Utils.showNotification('Bank details updated successfully! Withdrawals will use these details.', 'success');
                        await AuthManager.loadUserData();
                        
                        if (Router.currentSection === 'withdrawals') {
                            WithdrawalManager.updateWithdrawalForm();
                        }
                        
                        if (Router.currentSection === 'deposits') {
                            DepositManager.updateBankDetailsSection();
                        }
                    } else {
                        Utils.showNotification(response.message || 'Bank details update failed', 'error');
                    }
                } catch (error) {
                    Debug.error('Profile', 'Failed to update bank details:', error);
                    Utils.showError(error, 'Bank Details Update');
                } finally {
                    Utils.hideLoader();
                }
            });
        }
        
        const kycForm = document.getElementById('kycForm');
        if (kycForm) {
            kycForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                try {
                    Utils.showLoader('Submitting KYC documents...');
                    
                    const idType = document.getElementById('idType')?.value;
                    const idNumber = document.getElementById('idNumber')?.value;
                    const idFront = document.getElementById('idFront')?.files[0];
                    const idBack = document.getElementById('idBack')?.files[0];
                    const selfieWithId = document.getElementById('selfieWithId')?.files[0];
                    const addressProof = document.getElementById('addressProof')?.files[0];
                    
                    if (!idType || !idNumber || !idFront || !selfieWithId) {
                        Utils.showNotification('Please fill all required fields', 'error');
                        return;
                    }
                    
                    const kycData = {
                        id_type: idType,
                        id_number: idNumber,
                        id_front: idFront,
                        selfie_with_id: selfieWithId
                    };
                    
                    if (idBack) kycData.id_back = idBack;
                    if (addressProof) kycData.address_proof = addressProof;
                    
                    const response = await ApiService.submitKYC(kycData);
                    
                    if (response.success) {
                        Utils.showNotification('KYC documents submitted successfully! They will be reviewed within 24-48 hours.', 'success');
                        await KYCManager.loadKYCStatus();
                    } else {
                        Utils.showNotification(response.message || 'KYC submission failed', 'error');
                    }
                } catch (error) {
                    Debug.error('KYC', 'Failed to submit KYC:', error);
                    Utils.showError(error, 'KYC Submission');
                } finally {
                    Utils.hideLoader();
                }
            });
        }
        
        const supportForm = document.getElementById('supportForm');
        if (supportForm) {
            supportForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                try {
                    Utils.showLoader('Submitting support ticket...');
                    
                    const ticketData = {
                        category: document.getElementById('ticketCategory')?.value || '',
                        priority: document.getElementById('ticketPriority')?.value || 'medium',
                        subject: document.getElementById('ticketSubject')?.value || '',
                        message: document.getElementById('ticketMessage')?.value || ''
                    };
                    
                    const attachmentsInput = document.getElementById('ticketAttachments');
                    const attachments = attachmentsInput ? Array.from(attachmentsInput.files) : [];
                    
                    const response = await ApiService.createSupportTicket(ticketData, attachments);
                    
                    if (response.success) {
                        Utils.showNotification('Support ticket created successfully! We will respond within 24 hours.', 'success');
                        supportForm.reset();
                        await SupportManager.loadSupportTickets();
                    } else {
                        Utils.showNotification(response.message || 'Ticket creation failed', 'error');
                    }
                } catch (error) {
                    Debug.error('Support', 'Failed to create support ticket:', error);
                    Utils.showError(error, 'Support Ticket');
                } finally {
                    Utils.hideLoader();
                }
            });
        }
    }
    
    static setupRefreshButtons() {
        const refreshInvestments = document.getElementById('refreshInvestments');
        if (refreshInvestments) {
            refreshInvestments.addEventListener('click', () => {
                InvestmentManager.loadInvestments();
            });
        }
        
        const refreshDeposits = document.getElementById('refreshDeposits');
        if (refreshDeposits) {
            refreshDeposits.addEventListener('click', () => {
                DepositManager.loadDeposits();
            });
        }
        
        const refreshWithdrawals = document.getElementById('refreshWithdrawals');
        if (refreshWithdrawals) {
            refreshWithdrawals.addEventListener('click', () => {
                WithdrawalManager.loadWithdrawals();
            });
        }
        
        const refreshTransactions = document.getElementById('refreshTransactions');
        if (refreshTransactions) {
            refreshTransactions.addEventListener('click', () => {
                TransactionManager.loadTransactions();
            });
        }
        
        const refreshReferrals = document.getElementById('refreshReferrals');
        if (refreshReferrals) {
            refreshReferrals.addEventListener('click', () => {
                ReferralManager.loadReferralData();
            });
        }
        
        const refreshTickets = document.getElementById('refreshTickets');
        if (refreshTickets) {
            refreshTickets.addEventListener('click', () => {
                SupportManager.loadSupportTickets();
            });
        }
        
        const markAllRead = document.getElementById('markAllRead');
        if (markAllRead) {
            markAllRead.addEventListener('click', async () => {
                try {
                    await ApiService.markAllNotificationsAsRead();
                    Utils.showNotification('All notifications marked as read', 'success');
                    DashboardManager.loadDashboardData();
                } catch (error) {
                    Debug.error('Notifications', 'Failed to mark all as read:', error);
                    Utils.showError(error, 'Mark All Read');
                }
            });
        }
    }
    
    static setupFilePreviews() {
        this.setupFilePreview('paymentProof', 'paymentPreview');
        this.setupFilePreview('modalPaymentProof', 'modalPaymentProofPreview');
        this.setupFilePreview('idFront', 'idFrontPreview');
        this.setupFilePreview('idBack', 'idBackPreview');
        this.setupFilePreview('selfieWithId', 'selfiePreview');
        this.setupFilePreview('addressProof', 'addressProofPreview');
    }
    
    static setupFilePreview(inputId, previewId) {
        const input = document.getElementById(inputId);
        if (!input) return;
        
        input.addEventListener('change', (e) => {
            const preview = document.getElementById(previewId);
            if (!preview) return;
            
            preview.innerHTML = '';
            preview.classList.remove('d-none');
            
            const files = e.target.files;
            if (files.length === 0) {
                preview.classList.add('d-none');
                return;
            }
            
            this.createFilePreview(files[0], preview);
        });
    }
    
    static createFilePreview(file, container) {
        const preview = document.createElement('div');
        preview.className = 'file-preview d-flex align-center justify-between p-2 mb-2 border rounded';
        
        const fileInfo = document.createElement('div');
        fileInfo.className = 'd-flex align-center gap-2';
        
        const icon = document.createElement('i');
        
        if (file.type.startsWith('image/')) {
            icon.className = 'fas fa-image text-primary';
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const imgPreview = document.createElement('div');
                imgPreview.className = 'image-preview mt-2';
                imgPreview.innerHTML = `
                    <img src="${e.target.result}"
                         alt="Preview"
                         style="max-width: 200px; max-height: 150px; border-radius: 5px;">
                `;
                preview.appendChild(imgPreview);
            };
            reader.readAsDataURL(file);
        } else if (file.type.includes('pdf')) {
            icon.className = 'fas fa-file-pdf text-danger';
        } else {
            icon.className = 'fas fa-file text-secondary';
        }
        
        const fileDetails = document.createElement('div');
        fileDetails.innerHTML = `
            <div class="font-weight-bold">${file.name}</div>
            <div class="text-muted small">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
        `;
        
        fileInfo.appendChild(icon);
        fileInfo.appendChild(fileDetails);
        
        const removeBtn = document.createElement('button');
        removeBtn.className = 'btn btn-sm btn-danger';
        removeBtn.innerHTML = '<i class="fas fa-times"></i>';
        removeBtn.onclick = () => {
            preview.remove();
            const input = container.previousElementSibling?.querySelector('input[type="file"]');
            if (input) input.value = '';
            if (container.children.length === 0) {
                container.classList.add('d-none');
            }
        };
        
        preview.appendChild(fileInfo);
        preview.appendChild(removeBtn);
        container.appendChild(preview);
    }
    
    static setupWithdrawalCalculation() {
        const withdrawalAmount = document.getElementById('withdrawalAmount');
        if (withdrawalAmount) {
            withdrawalAmount.addEventListener('input', () => {
                WithdrawalManager.calculateWithdrawalFees();
            });
        }
    }
    
    static setupReferralActions() {
        const copyReferralCode = document.getElementById('copyReferralCode');
        if (copyReferralCode) {
            copyReferralCode.addEventListener('click', async () => {
                const code = document.getElementById('referralCode')?.value;
                if (code) {
                    await Utils.copyToClipboard(code);
                }
            });
        }
        
        const copyReferralLink = document.getElementById('copyReferralLink');
        if (copyReferralLink) {
            copyReferralLink.addEventListener('click', async () => {
                const link = document.getElementById('referralLink')?.value;
                if (link) {
                    await Utils.copyToClipboard(link);
                }
            });
        }
        
        document.querySelectorAll('[data-share]').forEach(btn => {
            btn.addEventListener('click', () => {
                const platform = btn.getAttribute('data-share');
                this.shareReferralLink(platform);
            });
        });
    }
    
    static shareReferralLink(platform) {
        const referralLink = document.getElementById('referralLink')?.value;
        const referralCode = document.getElementById('referralCode')?.value;
        
        if (!referralLink || !referralCode) {
            Utils.showNotification('Referral link not available', 'error');
            return;
        }
        
        const shareText = `Join Raw Wealthy Investment Platform using my referral code ${referralCode} and start earning! ${referralLink}`;
        
        switch(platform) {
            case 'whatsapp':
                window.open(`https://wa.me/?text=${encodeURIComponent(shareText)}`, '_blank');
                break;
            case 'telegram':
                window.open(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(shareText)}`, '_blank');
                break;
            case 'facebook':
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralLink)}`, '_blank');
                break;
            case 'twitter':
                window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`, '_blank');
                break;
            case 'email':
                window.location.href = `mailto:?subject=Join Raw Wealthy&body=${encodeURIComponent(shareText)}`;
                break;
        }
        
        Utils.showNotification(`Shared on ${platform}`, 'success');
    }
}

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', () => {
    Debug.info('App', 'Initializing Raw Wealthy v50.3 - Production Ready...');
    console.log('ð Raw Wealthy Premium v50.3 - Production Ready');
    console.log('ð Debug Mode:', CONFIG.DEBUG_MODE);
    console.log('ð Auth Status:', authToken ? 'Logged In' : 'Logged Out');
    console.log('ð¤ Current User:', currentUser?.email || 'None');
    console.log('ð API Base URL:', CONFIG.API_BASE_URL);
    console.log('ð¦ Platform Bank:', CONFIG.PLATFORM_BANK_DETAILS.account_number);
    console.log('ð Session Timeout:', CONFIG.SESSION_TIMEOUT / 60000, 'minutes');
    console.log('ð Duplicate Prevention:', CONFIG.DUPLICATE_PREVENTION_DELAY / 1000, 'seconds');
    console.log('============================================');
    
    // Initialize session manager
    SessionManager.init();
    
    Router.init();
    EventHandlers.init();
    
    if (authToken) {
        Debug.info('App', 'User already logged in, loading user data...');
        AuthManager.loadUserData();
    } else {
        Debug.info('App', 'No user logged in, showing login page');
    }
    
    window.addEventListener('online', () => {
        Utils.showNotification('You are back online', 'success');
        Debug.info('Network', 'Connection restored');
        
        if (authToken) {
            DashboardManager.loadDashboardData();
        }
    });
    
    window.addEventListener('offline', () => {
        Utils.showNotification('You are offline. Some features may not work.', 'warning');
        Debug.warn('Network', 'Connection lost');
    });
    
    Debug.info('App', 'â Raw Wealthy v50.3 Initialization Complete');
});

// ===== GLOBAL ERROR HANDLING =====
window.addEventListener('error', (event) => {
    Debug.error('Global', 'Uncaught error:', event.error);
    Utils.showNotification('An unexpected error occurred. Please try again.', 'error');
});

window.addEventListener('unhandledrejection', (event) => {
    Debug.error('Global', 'Unhandled promise rejection:', event.reason);
    Utils.showNotification('An unexpected error occurred.', 'error');
});

// ===== GLOBAL EXPORTS =====
window.RawWealthy = {
    Debug,
    Utils,
    StateManager,
    ApiService,
    AuthManager,
    Router,
    DashboardManager,
    InvestmentManager,
    DepositManager,
    WithdrawalManager,
    KYCManager,
    SupportManager,
    ReferralManager,
    ProfileManager,
    AdminManager,
    
    login: AuthManager.login,
    logout: AuthManager.logout,
    forgotPassword: AuthManager.forgotPassword,
    resetPassword: AuthManager.resetPassword,
    navigateTo: Router.navigateTo,
    showNotification: Utils.showNotification,
    formatCurrency: Utils.formatCurrency,
    calculateTotalEarnings: Utils.calculateTotalEarnings,
    calculateWithdrawableBalance: Utils.calculateWithdrawableBalance,
    hasBankDetails: Utils.hasBankDetails,
    
    getCurrentUser: () => currentUser,
    getAuthToken: () => authToken,
    isAdmin: () => isAdmin,
    
    refreshDashboard: () => DashboardManager.loadDashboardData(),
    refreshInvestments: () => InvestmentManager.loadInvestments(),
    refreshDeposits: () => DepositManager.loadDeposits(),
    refreshWithdrawals: () => WithdrawalManager.loadWithdrawals(),
    refreshTransactions: () => TransactionManager.loadTransactions(),
    refreshKYC: () => KYCManager.loadKYCStatus(),
    refreshReferrals: () => ReferralManager.loadReferralData()
};
</script>
</body>
</html>
