<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw Wealthy - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
        --primary: #0f172a;
        --secondary: #1e293b;
        --accent-gold: #f59e0b;
        --accent-emerald: #10b981;
        --accent-blue: #3b82f6;
        --accent-purple: #8b5cf6;
        --text-light: #f8fafc;
        --text-muted: #94a3b8;
        --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --radius: 12px;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        --info: #3b82f6;
        --gradient-primary: linear-gradient(135deg, #f59e0b, #d97706);
        --gradient-secondary: linear-gradient(135deg, #10b981, #059669);
        --gradient-blue: linear-gradient(135deg, #3b82f6, #2563eb);
        --gradient-purple: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        /* ====== MOBILE FIRST BASE STYLES ====== */
        * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Inter', sans-serif;
        -webkit-tap-highlight-color: transparent;
        }
        
        html {
        font-size: 14px;
        scroll-behavior: smooth;
        overflow-x: hidden;
        }
        
        body {
        background-color: var(--primary);
        color: var(--text-light);
        line-height: 1.6;
        overflow-x: hidden;
        transition: var(--transition);
        min-height: 100vh;
        position: relative;
        font-size: 0.9rem;
        }
        
        body.light-mode {
        --primary: #f8fafc;
        --secondary: #e2e8f0;
        --text-light: #0f172a;
        --text-muted: #64748b;
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        /* ====== MOBILE FIRST TYPOGRAPHY ====== */
        h1 { font-size: 1.8rem; line-height: 1.2; }
        h2 { font-size: 1.5rem; line-height: 1.3; }
        h3 { font-size: 1.25rem; line-height: 1.4; }
        h4 { font-size: 1.1rem; line-height: 1.4; }
        p { font-size: 0.9rem; margin-bottom: 1rem; }
        
        /* ====== UTILITY CLASSES ====== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .mobile-only { display: block; }
        .desktop-only { display: none; }
        .hidden { display: none; }
        .visible { display: block; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .m-2 { margin: 0.5rem; }
        .m-4 { margin: 1rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .rounded { border-radius: var(--radius); }
        .rounded-full { border-radius: 9999px; }
        .shadow { box-shadow: var(--shadow); }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        }
        
        /* ====== LOADING SPINNER ====== */
        .loading-spinner {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.95);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        backdrop-filter: blur(5px);
        }
        
        .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(251, 191, 36, 0.3);
        border-radius: 50%;
        border-top-color: var(--accent-gold);
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
        }
        
        @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
        }
        
        /* ====== TOAST NOTIFICATIONS ====== */
        .toast-container {
        position: fixed;
        top: 80px;
        left: 0;
        right: 0;
        z-index: 9998;
        padding: 0 1rem;
        pointer-events: none;
        }
        
        .toast {
        padding: 0.875rem 1rem;
        margin-bottom: 0.75rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        animation: slideInDown 0.3s, slideOutUp 0.5s 2.5s;
        animation-fill-mode: forwards;
        opacity: 0;
        transform: translateY(-100%);
        pointer-events: auto;
        font-size: 0.875rem;
        backdrop-filter: blur(10px);
        }
        
        .toast.success {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.95), rgba(5, 150, 105, 0.95));
        color: white;
        border-left: 4px solid var(--success);
        }
        
        .toast.error {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
        color: white;
        border-left: 4px solid var(--error);
        }
        
        .toast.warning {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.95), rgba(217, 119, 6, 0.95));
        color: white;
        border-left: 4px solid var(--warning);
        }
        
        .toast.info {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.95), rgba(37, 99, 235, 0.95));
        color: white;
        border-left: 4px solid var(--info);
        }
        
        .toast i {
        margin-right: 0.75rem;
        font-size: 1rem;
        }
        
        @keyframes slideInDown {
        from {
        opacity: 0;
        transform: translateY(-100%);
        }
        to {
        opacity: 1;
        transform: translateY(0);
        }
        }
        
        @keyframes slideOutUp {
        from {
        opacity: 1;
        transform: translateY(0);
        }
        to {
        opacity: 0;
        transform: translateY(-100%);
        }
        }
        
        /* ====== MOBILE-FIRST NAVBAR ====== */
        .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
        background: rgba(15, 23, 42, 0.98);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        height: 60px;
        }
        
        .light-mode .navbar {
        background: rgba(248, 250, 252, 0.98);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .navbar.scrolled {
        padding: 0.5rem 1rem;
        height: 55px;
        }
        
        .logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--accent-gold);
        }
        
        .logo i {
        color: var(--accent-emerald);
        font-size: 1.5rem;
        }
        
        .nav-links {
        display: none;
        }
        
        .nav-buttons {
        display: none;
        }
        
        .theme-toggle {
        background: transparent;
        border: none;
        color: var(--text-light);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        }
        
        .theme-toggle:hover {
        background: rgba(255, 255, 255, 0.1);
        }
        
        .light-mode .theme-toggle {
        color: var(--text-light);
        }
        
        .hamburger {
        display: block;
        cursor: pointer;
        font-size: 1.5rem;
        color: var(--text-light);
        padding: 0.5rem;
        transition: var(--transition);
        }
        
        /* ====== MOBILE MENU ====== */
        .mobile-menu-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 999;
        display: none;
        backdrop-filter: blur(5px);
        }
        
        .mobile-menu-overlay.active {
        display: block;
        animation: fadeIn 0.3s ease;
        }
        
        .mobile-menu {
        position: fixed;
        top: 0;
        right: -100%;
        width: 85%;
        max-width: 320px;
        height: 100vh;
        background: var(--primary);
        z-index: 1000;
        padding: 1.5rem 1rem;
        transition: var(--transition);
        box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        }
        
        .light-mode .mobile-menu {
        background: var(--primary);
        }
        
        .mobile-menu.active {
        right: 0;
        }
        
        .mobile-menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mobile-menu-links {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-bottom: 2rem;
        }
        
        .mobile-menu-links a {
        color: var(--text-light);
        text-decoration: none;
        font-size: 1rem;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        }
        
        .light-mode .mobile-menu-links a {
        color: var(--text-light);
        }
        
        .mobile-menu-links a:hover,
        .mobile-menu-links a.active {
        background: rgba(251, 191, 36, 0.1);
        color: var(--accent-gold);
        transform: translateX(5px);
        }
        
        .mobile-menu-links i {
        width: 20px;
        text-align: center;
        }
        
        .mobile-menu-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-top: auto;
        padding-top: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ====== HERO SECTION - MOBILE FIRST ====== */
        .hero {
        min-height: 100vh;
        display: flex;
        align-items: center;
        padding: 5rem 1rem 2rem;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.9)), 
        url('https://images.unsplash.com/photo-1642790553125-43a195c07ed7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        position: relative;
        overflow: hidden;
        }
        
        .light-mode .hero {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.95), rgba(226, 232, 240, 0.9)), 
        url('https://images.unsplash.com/photo-1642790553125-43a195c07ed7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');
        }
        
        .hero-content {
        width: 100%;
        z-index: 1;
        text-align: center;
        }
        
        .hero h1 {
        font-size: 2rem;
        margin-bottom: 1rem;
        line-height: 1.2;
        background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        }
        
        .hero p {
        font-size: 0.95rem;
        margin-bottom: 1.5rem;
        color: var(--text-muted);
        max-width: 100%;
        margin-left: auto;
        margin-right: auto;
        }
        
        .hero-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-bottom: 2rem;
        }
        
        .btn {
        padding: 0.875rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        border: none;
        outline: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 0.95rem;
        width: 100%;
        }
        
        .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        }
        
        .btn-outline {
        background: transparent;
        border: 2px solid var(--accent-emerald);
        color: var(--accent-emerald);
        }
        
        .btn-outline:hover:not(:disabled) {
        background: var(--accent-emerald);
        color: var(--primary);
        }
        
        .btn-primary {
        background: linear-gradient(135deg, var(--accent-gold), #f59e0b);
        color: var(--primary);
        font-weight: 600;
        }
        
        .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(251, 191, 36, 0.3);
        }
        
        .hero-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-top: 2rem;
        }
        
        .stat {
        background: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 10px;
        text-align: center;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent-gold);
        display: block;
        margin-bottom: 0.25rem;
        }
        
        .stat-label {
        font-size: 0.8rem;
        color: var(--text-muted);
        }
        
        /* ====== SECTIONS - MOBILE FIRST ====== */
        .section {
        padding: 3rem 1rem;
        }
        
        .section-title {
        text-align: center;
        margin-bottom: 2rem;
        }
        
        .section-title h2 {
        font-size: 1.75rem;
        margin-bottom: 0.75rem;
        position: relative;
        display: inline-block;
        }
        
        .section-title h2::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: var(--accent-gold);
        border-radius: 2px;
        }
        
        .section-title p {
        color: var(--text-muted);
        max-width: 100%;
        margin: 0 auto;
        font-size: 0.9rem;
        }
        
        /* ====== ABOUT SECTION ====== */
        .about-content {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        }
        
        .about-text h3 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: var(--accent-gold);
        }
        
        .about-features {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-top: 1.5rem;
        }
        
        .feature {
        background: var(--secondary);
        padding: 1rem;
        border-radius: 10px;
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        transition: var(--transition);
        border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .feature:hover {
        transform: translateY(-3px);
        border-color: var(--accent-gold);
        box-shadow: var(--shadow);
        }
        
        .feature-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        font-size: 1.1rem;
        flex-shrink: 0;
        }
        
        .feature-content h4 {
        margin-bottom: 0.25rem;
        font-size: 1rem;
        }
        
        .feature-content p {
        color: var(--text-muted);
        font-size: 0.85rem;
        }
        
        .about-image {
        position: relative;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        margin-top: 1rem;
        }
        
        .about-image img {
        width: 100%;
        height: auto;
        display: block;
        }
        
        /* ====== PLANS SECTION - MOBILE FIRST ====== */
        .plans {
        background-color: var(--secondary);
        }
        
        .plans-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-top: 2rem;
        overflow-x: auto;
        padding-bottom: 1rem;
        }
        
        .plans-container::-webkit-scrollbar {
        height: 4px;
        }
        
        .plans-container::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        }
        
        .plans-container::-webkit-scrollbar-thumb {
        background: var(--accent-gold);
        border-radius: 2px;
        }
        
        .plan-card {
        background: var(--primary);
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(251, 191, 36, 0.1);
        min-width: 280px;
        }
        
        .plan-card:hover {
        transform: translateY(-5px);
        border-color: var(--accent-gold);
        }
        
        .plan-badge {
        position: absolute;
        top: 15px;
        right: -30px;
        background: var(--accent-emerald);
        color: var(--primary);
        padding: 4px 30px;
        transform: rotate(45deg);
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        }
        
        .plan-header {
        text-align: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .plan-name {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: var(--accent-gold);
        }
        
        .plan-price {
        font-size: 2rem;
        font-weight: 700;
        color: var(--accent-gold);
        margin: 0.5rem 0;
        }
        
        .plan-period {
        color: var(--text-muted);
        font-size: 0.85rem;
        }
        
        .plan-features {
        margin-bottom: 1.5rem;
        }
        
        .plan-feature {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
        font-size: 0.9rem;
        }
        
        .plan-feature i {
        color: var(--accent-emerald);
        font-size: 0.9rem;
        }
        
        .plan-button {
        width: 100%;
        padding: 0.875rem;
        font-size: 0.95rem;
        }
        
        /* ====== HOW IT WORKS - MOBILE FIRST ====== */
        .steps {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        margin-top: 2rem;
        position: relative;
        }
        
        .steps::before {
        content: '';
        position: absolute;
        top: 40px;
        left: 50%;
        height: calc(100% - 80px);
        width: 2px;
        background: var(--accent-emerald);
        z-index: 0;
        transform: translateX(-50%);
        }
        
        .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        position: relative;
        z-index: 1;
        background: var(--secondary);
        padding: 1.5rem;
        border-radius: var(--radius);
        transition: var(--transition);
        }
        
        .step:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow);
        }
        
        .step-number {
        width: 50px;
        height: 50px;
        background: var(--accent-gold);
        color: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 1rem;
        border: 3px solid var(--primary);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .step-title {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: var(--accent-gold);
        }
        
        .step-description {
        color: var(--text-muted);
        font-size: 0.9rem;
        }
        
        /* ====== TESTIMONIALS - MOBILE FIRST ====== */
        .testimonials {
        background-color: var(--secondary);
        }
        
        .testimonials-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-top: 2rem;
        overflow-x: auto;
        padding-bottom: 1rem;
        }
        
        .testimonial-card {
        background: var(--primary);
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        transition: var(--transition);
        min-width: 280px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .testimonial-card:hover {
        transform: translateY(-3px);
        }
        
        .testimonial-content {
        margin-bottom: 1.5rem;
        font-style: italic;
        position: relative;
        font-size: 0.95rem;
        line-height: 1.6;
        }
        
        .testimonial-content::before {
        content: '"';
        font-size: 3rem;
        color: var(--accent-gold);
        position: absolute;
        top: -15px;
        left: -5px;
        opacity: 0.3;
        line-height: 1;
        }
        
        .testimonial-author {
        display: flex;
        align-items: center;
        gap: 1rem;
        }
        
        .author-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid var(--accent-gold);
        flex-shrink: 0;
        }
        
        .author-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        }
        
        .author-info h4 {
        margin-bottom: 0.25rem;
        font-size: 0.95rem;
        }
        
        .author-info p {
        color: var(--text-muted);
        font-size: 0.85rem;
        }
        
        /* ====== FOOTER - MOBILE FIRST ====== */
        footer {
        background-color: #0a0f1c;
        padding: 2rem 1rem 1rem;
        }
        
        .light-mode footer {
        background-color: #e2e8f0;
        }
        
        .footer-content {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
        }
        
        .footer-column h3 {
        font-size: 1.1rem;
        margin-bottom: 1rem;
        position: relative;
        padding-bottom: 0.5rem;
        color: var(--accent-gold);
        }
        
        .footer-column h3::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 35px;
        height: 2px;
        background: var(--accent-gold);
        }
        
        .footer-links {
        list-style: none;
        }
        
        .footer-links li {
        margin-bottom: 0.75rem;
        }
        
        .footer-links a {
        color: var(--text-muted);
        text-decoration: none;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        }
        
        .footer-links a:hover {
        color: var(--accent-gold);
        padding-left: 5px;
        }
        
        .social-links {
        display: flex;
        gap: 0.75rem;
        margin-top: 1rem;
        }
        
        .social-links a {
        width: 38px;
        height: 38px;
        background: var(--secondary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-light);
        transition: var(--transition);
        font-size: 1rem;
        }
        
        .social-links a:hover {
        background: var(--accent-gold);
        color: var(--primary);
        transform: translateY(-3px);
        }
        
        .footer-bottom {
        text-align: center;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-muted);
        font-size: 0.8rem;
        }
        
        /* ====== REGISTRATION/LOGIN PAGES - MOBILE FIRST ====== */
        .registration-page,
        .login-page,
        .dashboard-page,
        .investment-plans-page,
        .profile-page,
        .kyc-page,
        .investment-history-page,
        .transaction-history-page,
        .referral-page,
        .support-page,
        .admin-page {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4rem 1rem 2rem;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.95)), 
        url('https://images.unsplash.com/photo-1642790553125-43a195c07ed7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        }
        
        .registration-container,
        .login-container {
        width: 100%;
        max-width: 480px;
        background: var(--primary);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        }
        
        .registration-info,
        .login-info {
        padding: 2rem 1.5rem;
        background: linear-gradient(135deg, var(--accent-emerald), var(--accent-gold));
        color: var(--primary);
        text-align: center;
        }
        
        .registration-info h2,
        .login-info h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        }
        
        .registration-info p,
        .login-info p {
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
        }
        
        .info-features {
        list-style: none;
        text-align: left;
        margin-top: 1.5rem;
        }
        
        .info-features li {
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.9rem;
        }
        
        .info-features i {
        font-size: 1rem;
        flex-shrink: 0;
        }
        
        .registration-form,
        .login-form {
        padding: 2rem 1.5rem;
        }
        
        .form-header,
        .login-form-header {
        text-align: center;
        margin-bottom: 1.5rem;
        }
        
        .form-header h2,
        .login-form-header h2 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        }
        
        .form-header p,
        .login-form-header p {
        color: var(--text-muted);
        font-size: 0.9rem;
        }
        
        .form-group {
        margin-bottom: 1.25rem;
        position: relative;
        }
        
        .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        font-size: 0.9rem;
        }
        
        .form-control {
        width: 100%;
        padding: 0.875rem 1rem;
        background: var(--secondary);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: var(--text-light);
        font-size: 0.95rem;
        transition: var(--transition);
        }
        
        .form-control:focus {
        border-color: var(--accent-emerald);
        outline: none;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }
        
        .password-strength {
        height: 3px;
        margin-top: 0.5rem;
        border-radius: 2px;
        transition: var(--transition);
        }
        
        .password-strength.weak {
        background: var(--error);
        width: 25%;
        }
        
        .password-strength.medium {
        background: var(--warning);
        width: 50%;
        }
        
        .password-strength.strong {
        background: var(--success);
        width: 100%;
        }
        
        .password-toggle {
        position: absolute;
        right: 12px;
        top: 42px;
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        font-size: 1rem;
        padding: 0.25rem;
        }
        
        .form-footer,
        .login-form-footer {
        margin-top: 1.5rem;
        text-align: center;
        font-size: 0.9rem;
        }
        
        .forgot-password {
        display: block;
        text-align: right;
        margin-top: 0.5rem;
        color: var(--accent-emerald);
        text-decoration: none;
        font-size: 0.85rem;
        }
        
        /* ====== DASHBOARD - MOBILE FIRST ====== */
        .dashboard-container {
        width: 100%;
        max-width: 1200px;
        background: var(--primary);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        margin-top: 1rem;
        }
        
        .dashboard-header {
        padding: 1.25rem 1rem;
        background: var(--secondary);
        display: flex;
        flex-direction: column;
        gap: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dashboard-header h1 {
        font-size: 1.5rem;
        color: var(--accent-gold);
        text-align: center;
        }
        
        .user-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        }
        
        .user-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent-emerald), var(--accent-gold));
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        font-weight: 700;
        border: 2px solid var(--accent-gold);
        font-size: 1rem;
        }
        
        .dashboard-content {
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        }
        
        .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        }
        
        .stat-card {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
        border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .stat-card:hover {
        transform: translateY(-2px);
        border-color: var(--accent-gold);
        }
        
        .stat-card h3 {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
        }
        
        .stat-card .value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent-gold);
        }
        
        .chart-container {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        height: 280px;
        }
        
        .chart-container h3 {
        margin-bottom: 1rem;
        font-size: 1.1rem;
        }
        
        .investments-list,
        .transactions-list {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .investments-list h3,
        .transactions-list h3 {
        margin-bottom: 1rem;
        font-size: 1.1rem;
        }
        
        .investment-item,
        .transaction-item {
        display: flex;
        justify-content: space-between;
        padding: 0.875rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: var(--transition);
        font-size: 0.9rem;
        }
        
        .investment-item:hover,
        .transaction-item:hover {
        background: rgba(255, 255, 255, 0.05);
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        border-radius: 5px;
        }
        
        .investment-item:last-child,
        .transaction-item:last-child {
        border-bottom: none;
        }
        
        .investment-name,
        .transaction-type {
        font-weight: 500;
        }
        
        .investment-amount,
        .transaction-amount {
        color: var(--accent-gold);
        font-weight: 600;
        font-size: 0.95rem;
        }
        
        .investment-status,
        .transaction-date {
        color: var(--text-muted);
        font-size: 0.8rem;
        }
        
        .quick-actions {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        }
        
        .action-card {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: var(--transition);
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .action-card:hover {
        transform: translateY(-3px);
        border-color: var(--accent-gold);
        }
        
        .action-card i {
        font-size: 1.5rem;
        margin-bottom: 0.75rem;
        color: var(--accent-emerald);
        }
        
        .action-card h3 {
        font-size: 0.95rem;
        margin-bottom: 0.5rem;
        }
        
        .action-card p {
        color: var(--text-muted);
        font-size: 0.85rem;
        }
        
        /* ====== PROFILE PAGE - MOBILE FIRST ====== */
        .profile-container {
        width: 100%;
        max-width: 1000px;
        background: var(--primary);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        }
        
        .profile-header {
        padding: 1.25rem 1rem;
        background: var(--secondary);
        display: flex;
        flex-direction: column;
        gap: 1rem;
        align-items: center;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .profile-header h1 {
        font-size: 1.5rem;
        color: var(--accent-gold);
        }
        
        .profile-content {
        display: flex;
        flex-direction: column;
        padding: 1rem;
        gap: 1.5rem;
        }
        
        .profile-sidebar {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        order: 2;
        }
        
        .profile-nav {
        list-style: none;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
        }
        
        .profile-nav li {
        flex: 1;
        min-width: 120px;
        }
        
        .profile-nav a {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem;
        color: var(--text-light);
        text-decoration: none;
        border-radius: 8px;
        transition: var(--transition);
        font-size: 0.85rem;
        text-align: center;
        white-space: nowrap;
        }
        
        .profile-nav a:hover,
        .profile-nav a.active {
        background: rgba(251, 191, 36, 0.1);
        color: var(--accent-gold);
        }
        
        .profile-main {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        order: 1;
        }
        
        .profile-section {
        margin-bottom: 2rem;
        }
        
        .profile-section h2 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--accent-gold);
        }
        
        .two-factor-setup {
        background: rgba(16, 185, 129, 0.1);
        padding: 1.25rem;
        border-radius: 10px;
        margin-top: 1rem;
        border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .two-factor-code {
        display: flex;
        gap: 0.75rem;
        margin: 1rem 0;
        justify-content: center;
        }
        
        .two-factor-code input {
        width: 45px;
        height: 45px;
        text-align: center;
        font-size: 1.25rem;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        background: var(--primary);
        color: var(--text-light);
        font-weight: 600;
        }
        
        /* ====== REFERRAL PAGE - MOBILE FIRST ====== */
        .referral-container {
        width: 100%;
        max-width: 1000px;
        background: var(--primary);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        }
        
        .referral-header {
        padding: 1.5rem 1rem;
        background: var(--secondary);
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .referral-header h1 {
        font-size: 1.5rem;
        color: var(--accent-gold);
        margin-bottom: 0.5rem;
        }
        
        .referral-content {
        padding: 1.5rem 1rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        }
        
        .referral-stats,
        .referral-links {
        background: var(--secondary);
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .referral-stats h2,
        .referral-links h2 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
        color: var(--accent-gold);
        }
        
        .referral-stat {
        display: flex;
        justify-content: space-between;
        padding: 0.875rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.95rem;
        }
        
        .referral-stat:last-child {
        border-bottom: none;
        }
        
        .referral-stat span:last-child {
        font-weight: 600;
        color: var(--accent-gold);
        }
        
        /* ====== SUPPORT PAGE - MOBILE FIRST ====== */
        .support-container {
        width: 100%;
        max-width: 1000px;
        background: var(--primary);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        }
        
        .support-header {
        padding: 1.5rem 1rem;
        background: var(--secondary);
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .support-header h1 {
        font-size: 1.5rem;
        color: var(--accent-gold);
        margin-bottom: 0.5rem;
        }
        
        .support-content {
        padding: 1.5rem 1rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        }
        
        .support-categories {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.5rem;
        }
        
        .support-category {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        flex: 1;
        min-width: 120px;
        text-align: center;
        font-size: 0.9rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .support-category:hover,
        .support-category.active {
        background: rgba(251, 191, 36, 0.1);
        color: var(--accent-gold);
        border-color: var(--accent-gold);
        }
        
        .support-category i {
        margin-right: 0.5rem;
        }
        
        .support-main {
        background: var(--secondary);
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .faq-item {
        margin-bottom: 1.25rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 1.25rem;
        }
        
        .faq-item:last-child {
        margin-bottom: 0;
        border-bottom: none;
        }
        
        .faq-question {
        font-weight: 600;
        margin-bottom: 0.5rem;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.95rem;
        padding-right: 1rem;
        }
        
        .faq-question i {
        transition: var(--transition);
        }
        
        .faq-item.active .faq-question i {
        transform: rotate(180deg);
        }
        
        .faq-answer {
        color: var(--text-muted);
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        font-size: 0.9rem;
        line-height: 1.6;
        }
        
        .faq-item.active .faq-answer {
        max-height: 500px;
        margin-top: 0.75rem;
        }
        
        /* ====== ADMIN PAGE - MOBILE FIRST ====== */
        .admin-container {
        width: 100%;
        max-width: 1400px;
        background: var(--primary);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        }
        
        .admin-header {
        padding: 1.25rem 1rem;
        background: var(--secondary);
        display: flex;
        flex-direction: column;
        gap: 1rem;
        align-items: center;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-header h1 {
        font-size: 1.5rem;
        color: var(--accent-gold);
        }
        
        .admin-content {
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        }
        
        .admin-sidebar {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        order: 2;
        }
        
        .admin-nav {
        list-style: none;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
        }
        
        .admin-nav li {
        flex: 1;
        min-width: 120px;
        }
        
        .admin-nav a {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem;
        color: var(--text-light);
        text-decoration: none;
        border-radius: 8px;
        transition: var(--transition);
        font-size: 0.85rem;
        text-align: center;
        white-space: nowrap;
        }
        
        .admin-nav a:hover,
        .admin-nav a.active {
        background: rgba(251, 191, 36, 0.1);
        color: var(--accent-gold);
        }
        
        .admin-main {
        background: var(--secondary);
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        order: 1;
        }
        
        .admin-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
        }
        
        .admin-stat {
        background: var(--primary);
        padding: 1.25rem;
        border-radius: 10px;
        text-align: center;
        transition: var(--transition);
        border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .admin-stat:hover {
        transform: translateY(-2px);
        border-color: var(--accent-gold);
        }
        
        .admin-stat .value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent-gold);
        display: block;
        margin-bottom: 0.25rem;
        }
        
        .admin-stat .label {
        color: var(--text-muted);
        font-size: 0.85rem;
        }
        
        .admin-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        }
        
        .admin-table th,
        .admin-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        min-width: 100px;
        }
        
        .admin-table th {
        color: var(--text-muted);
        font-weight: 600;
        font-size: 0.85rem;
        background: rgba(0, 0, 0, 0.1);
        }
        
        /* ====== MODALS - MOBILE FIRST ====== */
        .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        align-items: flex-start;
        justify-content: center;
        padding: 1rem;
        overflow-y: auto;
        backdrop-filter: blur(5px);
        }
        
        .modal-content {
        background: var(--primary);
        padding: 1.5rem;
        border-radius: 15px;
        width: 100%;
        max-width: 500px;
        box-shadow: var(--shadow);
        margin-top: 2rem;
        margin-bottom: 2rem;
        animation: modalAppear 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.25rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-header h2 {
        font-size: 1.35rem;
        color: var(--accent-gold);
        }
        
        .close-modal {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.5rem;
        cursor: pointer;
        transition: var(--transition);
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        }
        
        .close-modal:hover {
        color: var(--accent-gold);
        background: rgba(255, 255, 255, 0.1);
        }
        
        @keyframes modalAppear {
        from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
        }
        to {
        opacity: 1;
        transform: translateY(0) scale(1);
        }
        }
        
        /* ====== FILE UPLOAD STYLES ====== */
        .file-upload-container {
        border: 2px dashed rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        padding: 2rem 1rem;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        margin-bottom: 1rem;
        }
        
        .file-upload-container:hover {
        border-color: var(--accent-emerald);
        background: rgba(16, 185, 129, 0.05);
        }
        
        .file-upload-container i {
        font-size: 2.5rem;
        color: var(--accent-emerald);
        margin-bottom: 1rem;
        }
        
        .file-upload-container p {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-bottom: 0;
        }
        
        .file-preview {
        max-width: 100%;
        max-height: 200px;
        margin-top: 1rem;
        border-radius: 8px;
        display: none;
        border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ====== STATUS BADGES ====== */
        .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        display: inline-block;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        }
        
        .status-badge.pending {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
        border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .status-badge.approved {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success);
        border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-badge.rejected {
        background: rgba(239, 68, 68, 0.2);
        color: var(--error);
        border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-badge.active {
        background: rgba(59, 130, 246, 0.2);
        color: var(--info);
        border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* ====== BACK TO TOP BUTTON ====== */
        .back-to-top {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        width: 45px;
        height: 45px;
        background: var(--accent-gold);
        color: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        opacity: 0;
        visibility: hidden;
        z-index: 999;
        box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
        border: none;
        }
        
        .back-to-top.visible {
        opacity: 1;
        visibility: visible;
        }
        
        .back-to-top:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 20px rgba(251, 191, 36, 0.6);
        }
        
        /* ====== MEDIA QUERIES FOR TABLETS (768px and up) ====== */
        @media (min-width: 768px) {
        html {
        font-size: 15px;
        }
        
        body {
        font-size: 0.95rem;
        }
        
        h1 { font-size: 2.25rem; }
        h2 { font-size: 1.75rem; }
        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.25rem; }
        
        .mobile-only { display: none; }
        .desktop-only { display: block; }
        
        /* Navbar */
        .navbar {
        padding: 0.75rem 2rem;
        }
        
        .nav-links {
        display: flex;
        gap: 1.5rem;
        margin-left: 2rem;
        }
        
        .nav-links a {
        color: var(--text-light);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.95rem;
        padding: 0.5rem 0;
        position: relative;
        }
        
        .nav-links a::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--accent-gold);
        transition: var(--transition);
        }
        
        .nav-links a:hover::after {
        width: 100%;
        }
        
        .nav-buttons {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        }
        
        .hamburger {
        display: none;
        }
        
        /* Hero Section */
        .hero {
        padding: 6rem 2rem 3rem;
        }
        
        .hero h1 {
        font-size: 2.5rem;
        }
        
        .hero-buttons {
        flex-direction: row;
        justify-content: center;
        gap: 1rem;
        }
        
        .btn {
        width: auto;
        min-width: 160px;
        }
        
        .hero-stats {
        grid-template-columns: repeat(3, 1fr);
        }
        
        /* Sections */
        .section {
        padding: 4rem 2rem;
        }
        
        /* About Section */
        .about-content {
        flex-direction: row;
        align-items: center;
        gap: 3rem;
        }
        
        .about-text,
        .about-image {
        flex: 1;
        }
        
        .about-features {
        grid-template-columns: repeat(2, 1fr);
        }
        
        /* Plans Section */
        .plans-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        overflow-x: visible;
        }
        
        .plan-card {
        min-width: auto;
        }
        
        /* How It Works */
        .steps {
        flex-direction: row;
        justify-content: space-between;
        }
        
        .steps::before {
        top: 40px;
        left: 0;
        right: 0;
        height: 2px;
        width: 100%;
        transform: none;
        }
        
        .step {
        width: 30%;
        }
        
        /* Testimonials */
        .testimonials-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        overflow-x: visible;
        }
        
        .testimonial-card {
        min-width: auto;
        }
        
        /* Footer */
        .footer-content {
        grid-template-columns: repeat(2, 1fr);
        }
        
        /* Dashboard */
        .dashboard-header {
        flex-direction: row;
        justify-content: space-between;
        padding: 1.5rem 2rem;
        }
        
        .dashboard-header h1 {
        text-align: left;
        }
        
        .dashboard-content {
        padding: 1.5rem;
        flex-direction: row;
        }
        
        .dashboard-main {
        flex: 2;
        }
        
        .dashboard-sidebar {
        flex: 1;
        }
        
        .quick-actions {
        grid-template-columns: 1fr;
        }
        
        /* Profile Page */
        .profile-content {
        flex-direction: row;
        }
        
        .profile-sidebar {
        flex: 0 0 250px;
        order: 1;
        }
        
        .profile-main {
        flex: 1;
        order: 2;
        }
        
        .profile-nav {
        flex-direction: column;
        }
        
        /* Referral Page */
        .referral-content {
        flex-direction: row;
        }
        
        .referral-stats,
        .referral-links {
        flex: 1;
        }
        
        /* Support Page */
        .support-content {
        flex-direction: row;
        }
        
        .support-categories {
        flex: 0 0 200px;
        flex-direction: column;
        }
        
        .support-category {
        min-width: auto;
        }
        
        .support-main {
        flex: 1;
        }
        
        /* Admin Page */
        .admin-content {
        flex-direction: row;
        }
        
        .admin-sidebar {
        flex: 0 0 200px;
        order: 1;
        }
        
        .admin-main {
        flex: 1;
        order: 2;
        }
        
        .admin-nav {
        flex-direction: column;
        }
        
        .admin-stats {
        grid-template-columns: repeat(3, 1fr);
        }
        
        .admin-table {
        display: table;
        overflow-x: auto;
        }
        
        /* Modal */
        .modal-content {
        margin-top: 3rem;
        }
        }
        
        /* ====== MEDIA QUERIES FOR DESKTOP (992px and up) ====== */
        @media (min-width: 992px) {
        html {
        font-size: 16px;
        }
        
        body {
        font-size: 1rem;
        }
        
        h1 { font-size: 3rem; }
        h2 { font-size: 2.25rem; }
        h3 { font-size: 1.75rem; }
        h4 { font-size: 1.5rem; }
        
        /* Hero Section */
        .hero {
        padding: 8rem 5% 4rem;
        }
        
        .hero h1 {
        font-size: 3.25rem;
        }
        
        .hero-content {
        max-width: 600px;
        text-align: left;
        }
        
        .hero-buttons {
        justify-content: flex-start;
        }
        
        .hero-stats {
        justify-content: flex-start;
        grid-template-columns: repeat(3, auto);
        display: flex;
        gap: 3rem;
        }
        
        .stat {
        background: transparent;
        border: none;
        padding: 0;
        text-align: left;
        }
        
        /* Sections */
        .section {
        padding: 6rem 5%;
        }
        
        .section-title p {
        max-width: 600px;
        }
        
        /* Plans Section */
        .plans-container {
        grid-template-columns: repeat(3, 1fr);
        }
        
        /* Testimonials */
        .testimonials-container {
        grid-template-columns: repeat(3, 1fr);
        }
        
        /* Footer */
        .footer-content {
        grid-template-columns: repeat(4, 1fr);
        }
        
        /* Dashboard */
        .dashboard-container {
        margin-top: 2rem;
        }
        
        .stats-grid {
        grid-template-columns: repeat(4, 1fr);
        }
        
        .chart-container {
        height: 350px;
        }
        
        /* Admin */
        .admin-stats {
        grid-template-columns: repeat(4, 1fr);
        }
        
        /* Toast */
        .toast-container {
        top: 90px;
        left: auto;
        right: 20px;
        padding: 0;
        width: auto;
        max-width: 350px;
        }
        
        .toast {
        animation: slideInRight 0.3s, slideOutRight 0.5s 2.5s;
        transform: translateX(100%);
        }
        
        @keyframes slideInRight {
        from {
        opacity: 0;
        transform: translateX(100%);
        }
        to {
        opacity: 1;
        transform: translateX(0);
        }
        }
        
        @keyframes slideOutRight {
        from {
        opacity: 1;
        transform: translateX(0);
        }
        to {
        opacity: 0;
        transform: translateX(100%);
        }
        }
        }
        
        /* ====== MEDIA QUERIES FOR LARGE DESKTOP (1200px and up) ====== */
        @media (min-width: 1200px) {
        .hero {
        padding: 10rem 5% 6rem;
        }
        
        .hero h1 {
        font-size: 3.5rem;
        }
        
        .dashboard-container,
        .profile-container,
        .referral-container,
        .support-container,
        .admin-container {
        max-width: 95%;
        margin-left: auto;
        margin-right: auto;
        }
        
        .admin-stats {
        grid-template-columns: repeat(6, 1fr);
        }
        }
        
        /* ====== DARK/LIGHT MODE ADJUSTMENTS ====== */
        .light-mode .btn-outline:hover:not(:disabled) {
        color: var(--text-light);
        }
        
        .light-mode .form-control {
        background: rgba(30, 41, 59, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.1);
        color: var(--text-light);
        }
        
        .light-mode .stat-card,
        .light-mode .investment-item:hover,
        .light-mode .transaction-item:hover,
        .light-mode .action-card,
        .light-mode .plan-card,
        .light-mode .testimonial-card,
        .light-mode .feature,
        .light-mode .step,
        .light-mode .profile-sidebar,
        .light-mode .profile-main,
        .light-mode .support-categories,
        .light-mode .support-main,
        .light-mode .referral-stats,
        .light-mode .referral-links,
        .light-mode .admin-sidebar,
        .light-mode .admin-main,
        .light-mode .admin-stat,
        .light-mode .modal-content,
        .light-mode .two-factor-code input {
        background: white;
        border-color: rgba(0, 0, 0, 0.1);
        }
        
        .light-mode .investment-item,
        .light-mode .transaction-item {
        border-bottom-color: rgba(0, 0, 0, 0.1);
        }
        
        .light-mode .stat-card:hover,
        .light-mode .action-card:hover,
        .light-mode .plan-card:hover,
        .light-mode .testimonial-card:hover,
        .light-mode .feature:hover,
        .light-mode .step:hover,
        .light-mode .admin-stat:hover {
        border-color: var(--accent-gold);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* ====== ACCESSIBILITY & TOUCH OPTIMIZATIONS ====== */
        @media (hover: none) and (pointer: coarse) {
        .btn,
        .action-card,
        .plan-card,
        .feature,
        .step,
        .testimonial-card {
        transition: none;
        }
        
        .btn:active,
        .action-card:active,
        .plan-card:active {
        transform: scale(0.98);
        }
        
        .btn:hover:not(:disabled),
        .action-card:hover,
        .plan-card:hover,
        .feature:hover,
        .step:hover,
        .testimonial-card:hover {
        transform: none;
        }
        
        input,
        select,
        textarea {
        font-size: 16px; /* Prevents iOS zoom on focus */
        }
        }
        
        /* ====== PRINT STYLES ====== */
        @media print {
        .navbar,
        .mobile-menu,
        .mobile-menu-overlay,
        .hero-visual,
        .theme-toggle,
        .hamburger,
        .back-to-top,
        .modal,
        .toast-container,
        .loading-spinner {
        display: none !important;
        }
        
        body {
        background: white !important;
        color: black !important;
        font-size: 12pt;
        }
        
        .hero,
        .section {
        padding: 0 !important;
        background: none !important;
        }
        
        a {
        color: black !important;
        text-decoration: underline;
        }
        
        .btn {
        border: 1px solid black !important;
        background: none !important;
        color: black !important;
        }
        }
        
        /* ====== SAFARI SPECIFIC FIXES ====== */
        @supports (-webkit-touch-callout: none) {
        .hero {
        background-attachment: scroll;
        }
        
        .modal-content {
        margin-top: env(safe-area-inset-top);
        }
        
        .back-to-top {
        bottom: calc(1.5rem + env(safe-area-inset-bottom));
        }
        }
        
        /* ====== ANIMATIONS ====== */
        @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
        }
        
        @keyframes float {
        0% { transform: translateY(0px) rotate(10deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
        100% { transform: translateY(0px) rotate(10deg); }
        }
        
        .hero-visual {
        display: none;
        }
        
        @media (min-width: 992px) {
        .hero-visual {
        display: block;
        position: absolute;
        right: 5%;
        bottom: 10%;
        width: 500px;
        height: 400px;
        background: linear-gradient(135deg, var(--accent-emerald), var(--accent-gold));
        border-radius: 20px;
        opacity: 0.1;
        transform: rotate(10deg);
        animation: float 6s ease-in-out infinite;
        }
        }
        
        /* ====== SCROLLBAR STYLING ====== */
        ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
        }
        
        ::-webkit-scrollbar-track {
        background: var(--secondary);
        border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
        background: var(--accent-gold);
        border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
        background: #d97706;
        }
        
        /* ====== SELECTION STYLING ====== */
        ::selection {
        background: rgba(245, 158, 11, 0.3);
        color: var(--text-light);
        }
        
        /* ====== PLACEHOLDER STYLING ====== */
        ::placeholder {
        color: var(--text-muted);
        opacity: 0.7;
        }
        
        /* ====== FOCUS VISIBLE ====== */
        :focus-visible {
        outline: 2px solid var(--accent-emerald);
        outline-offset: 2px;
        }
        
        /* ====== SMOOTH SCROLLING FOR ANCHOR LINKS ====== */
        @media (prefers-reduced-motion: no-preference) {
        html {
        scroll-behavior: smooth;
        }
        }
        
        /* ====== REDUCED MOTION ====== */
        @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
        }
        }/* [YOUR EXISTING 3000+ LINES OF CSS CODE REMAINS EXACTLY THE SAME] */
        /* I'm preserving your entire CSS structure */
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loading-spinner">
        <div class="spinner"></div>
        <p>Processing your request...</p>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-header">
            <div class="logo">
                <i class="fas fa-gem"></i>
                <span>Raw Wealthy</span>
            </div>
            <button class="close-modal" id="close-mobile-menu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mobile-menu-links">
            <a href="#" onclick="app.showPage('home'); app.closeMobileMenu();">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="#" onclick="app.showPage('home'); app.closeMobileMenu();">
                <i class="fas fa-info-circle"></i> About
            </a>
            <a href="#" onclick="app.showPage('investment-plans'); app.closeMobileMenu();">
                <i class="fas fa-chart-line"></i> Raw Materials
            </a>
            <a href="#" onclick="app.showPage('home'); app.closeMobileMenu();">
                <i class="fas fa-cogs"></i> How It Works
            </a>
            <a href="#" onclick="app.showPage('home'); app.closeMobileMenu();">
                <i class="fas fa-comments"></i> Testimonials
            </a>
        </div>
        <div class="mobile-menu-buttons">
            <button class="btn btn-outline" onclick="app.showPage('login'); app.closeMobileMenu();">Login</button>
            <button class="btn btn-primary" onclick="app.showPage('register'); app.closeMobileMenu();">Register</button>
        </div>
    </div>

    <!-- Home Page -->
    <div id="home-page">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-gem"></i>
                <span>Raw Wealthy</span>
            </div>
            <div class="nav-links">
                <a href="#" onclick="app.showPage('home')">Home</a>
                <a href="#" onclick="app.showPage('home')">About</a>
                <a href="#" onclick="app.showPage('investment-plans')">Raw Materials</a>
                <a href="#" onclick="app.showPage('home')">How It Works</a>
                <a href="#" onclick="app.showPage('home')">Testimonials</a>
            </div>
            <div class="nav-buttons">
                <button class="theme-toggle" id="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn btn-outline" onclick="app.showPage('login')">Login</button>
                <button class="btn btn-primary" onclick="app.showPage('register')">Register</button>
            </div>
            <div class="hamburger" id="hamburger">
                <i class="fas fa-bars"></i>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero" id="home">
            <div class="hero-content">
                <h1>Invest in Raw Materials. <span class="gradient-text">Earn Daily.</span></h1>
                <p>Join thousands of investors who are growing their wealth with our secure raw materials investment platform. Start with as little as 3,500 and watch your money grow.</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" onclick="app.showPage('register')">Get Started</button>
                    <button class="btn btn-outline" onclick="app.showPage('investment-plans')">Investment Plans</button>
                </div>
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-value" id="total-invested-stat">2.5B+</span>
                        <span class="stat-label">Total Invested</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="active-investors-stat">15,240+</span>
                        <span class="stat-label">Active Investors</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="user-rating-stat">4.9/5</span>
                        <span class="stat-label">User Rating</span>
                    </div>
                </div>
            </div>
            <div class="hero-visual"></div>
        </section>

        <!-- About Section -->
        <section class="section" id="about">
            <div class="section-title">
                <h2>Why Choose Raw Wealthy?</h2>
                <p>We provide a secure and transparent platform for investing in raw materials with industry-leading returns.</p>
            </div>
            <div class="about-content">
                <div class="about-text">
                    <h3>Your Trusted Partner in Raw Materials Investment</h3>
                    <p>With over 7 years of experience in the raw materials industry, we've helped thousands of clients achieve their financial goals through carefully curated investment plans.</p>
                    <p>Our platform uses advanced security measures and follows strict compliance protocols to ensure your investments are safe and secure.</p>
                    <div class="about-features">
                        <div class="feature">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="feature-content">
                                <h4>Secure Investments</h4>
                                <p>Bank-level security for all transactions</p>
                            </div>
                        </div>
                        <div class="feature">
                            <div class="feature-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="feature-content">
                                <h4>High Returns</h4>
                                <p>Industry-leading ROI on all plans</p>
                            </div>
                        </div>
                        <div class="feature">
                            <div class="feature-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="feature-content">
                                <h4>24/7 Support</h4>
                                <p>Round-the-clock customer service</p>
                            </div>
                        </div>
                        <div class="feature">
                            <div class="feature-icon">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="feature-content">
                                <h4>Verified Platform</h4>
                                <p>Fully licensed and regulated</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="about-image">
                    <img src="https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" alt="Investment Growth">
                </div>
            </div>
        </section>

        <!-- Raw Materials Plans Section -->
        <section class="section plans" id="plans">
            <div class="section-title">
                <h2>Raw Materials Investment Plans</h2>
                <p>Choose from our carefully curated raw materials investment plans designed to maximize your returns.</p>
            </div>
            <div class="plans-container" id="plans-container">
                <!-- Plans will be dynamically loaded here -->
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="section" id="how-it-works">
            <div class="section-title">
                <h2>How It Works</h2>
                <p>Getting started with Raw Wealthy is simple and straightforward.</p>
            </div>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Register</h3>
                    <p class="step-description">Create your account in less than 2 minutes with our simple registration process.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Invest</h3>
                    <p class="step-description">Choose a raw material investment plan that suits your goals and make your first deposit.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Earn</h3>
                    <p class="step-description">Watch your investment grow with daily returns that you can withdraw or reinvest.</p>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="section testimonials" id="testimonials">
            <div class="section-title">
                <h2>What Our Investors Say</h2>
                <p>Hear from our satisfied investors who have achieved financial success with our platform.</p>
            </div>
            <div class="testimonials-container">
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        "I've been investing with Raw Wealthy for over a year now, and the returns have been consistently impressive. The platform is easy to use, and their customer support is excellent."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Michael Johnson">
                        </div>
                        <div class="author-info">
                            <h4>Michael Johnson</h4>
                            <p>Gold Investor</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        "As a beginner in investing, I was hesitant at first. But Raw Wealthy made the process so simple. I started with the Cocoa plan and have already upgraded to Gold. Highly recommended!"
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Sarah Williams">
                        </div>
                        <div class="author-info">
                            <h4>Sarah Williams</h4>
                            <p>Silver Investor</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        "The transparency and regular updates on my investments give me peace of mind. I've tried other platforms, but Raw Wealthy stands out with their professionalism and high returns."
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <img src="https://randomuser.me/api/portraits/men/67.jpg" alt="Robert Chen">
                        </div>
                        <div class="author-info">
                            <h4>Robert Chen</h4>
                            <p>Bronze Investor</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Raw Wealthy</h3>
                    <p>Your trusted partner for secure and high-yield raw materials investment opportunities. Start growing your wealth today.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="app.showPage('home')"><i class="fas fa-chevron-right"></i> Home</a></li>
                        <li><a href="#about"><i class="fas fa-chevron-right"></i> About Us</a></li>
                        <li><a href="#" onclick="app.showPage('investment-plans')"><i class="fas fa-chevron-right"></i> Investment Plans</a></li>
                        <li><a href="#how-it-works"><i class="fas fa-chevron-right"></i> How It Works</a></li>
                        <li><a href="#testimonials"><i class="fas fa-chevron-right"></i> Testimonials</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Legal</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Privacy Policy</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Terms of Service</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Cookie Policy</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Disclaimer</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <ul class="footer-links">
                        <li><i class="fas fa-envelope"></i> rawwealthy0@gmail.com</li>
                        <li><i class="fas fa-phone"></i> +234 (0) 902 802 2559</li>
                        <li><i class="fas fa-map-marker-alt"></i> 123 Investment St, Lagos, Nigeria</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Raw Wealthy Investment Platform. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Registration Page -->
    <div id="registration-page" class="registration-page" style="display: none;">
        <div class="registration-container">
            <div class="registration-info">
                <h2>Join Thousands of Successful Investors</h2>
                <p>Create your account today and start your journey to financial freedom with our secure and high-yield raw materials investment plans.</p>
                <ul class="info-features">
                    <li><i class="fas fa-check-circle"></i> Secure and encrypted platform</li>
                    <li><i class="fas fa-check-circle"></i> Daily returns on your investments</li>
                    <li><i class="fas fa-check-circle"></i> 24/7 customer support</li>
                    <li><i class="fas fa-check-circle"></i> Multiple withdrawal options</li>
                    <li><i class="fas fa-check-circle"></i> Referral bonus program</li>
                </ul>
            </div>
            <div class="registration-form">
                <div class="form-header">
                    <h2>Create Account</h2>
                    <p>Fill in your details to get started</p>
                </div>
                <form id="registration-form">
                    <div class="form-group">
                        <label for="fullname">Full Name</label>
                        <input type="text" id="fullname" class="form-control" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" class="form-control" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" class="form-control" placeholder="Enter your phone number" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Create a password" required>
                        <button type="button" class="password-toggle" id="password-toggle">
                            <i class="fas fa-eye"></i>
                        </button>
                        <div class="password-strength" id="password-strength"></div>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password</label>
                        <input type="password" id="confirm-password" class="form-control" placeholder="Confirm your password" required>
                        <button type="button" class="password-toggle" id="confirm-password-toggle">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="referral">Referral Code (Optional)</label>
                        <input type="text" id="referral" class="form-control" placeholder="Enter referral code if any">
                    </div>
                    <div class="form-group">
                        <label for="risk-tolerance">Risk Tolerance</label>
                        <select id="risk-tolerance" class="form-control" required>
                            <option value="low">Low (Conservative)</option>
                            <option value="medium" selected>Medium (Balanced)</option>
                            <option value="high">High (Aggressive)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="investment-strategy">Investment Strategy</label>
                        <select id="investment-strategy" class="form-control" required>
                            <option value="conservative">Conservative</option>
                            <option value="balanced" selected>Balanced</option>
                            <option value="aggressive">Aggressive</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="register-btn">
                        <span class="btn-text">Create Account</span>
                        <div class="btn-loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </button>
                </form>
                <div class="form-footer">
                    <p>Already have an account? <a href="#" onclick="app.showPage('login')">Login here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="login-page" style="display: none;">
        <div class="login-container">
            <div class="login-info">
                <h2>Welcome Back!</h2>
                <p>Access your investment dashboard to track your portfolio, view earnings, and manage your investments.</p>
                <ul class="info-features">
                    <li><i class="fas fa-check-circle"></i> Track your investment performance</li>
                    <li><i class="fas fa-check-circle"></i> View real-time earnings</li>
                    <li><i class="fas fa-check-circle"></i> Manage your portfolio</li>
                    <li><i class="fas fa-check-circle"></i> Withdraw your earnings</li>
                    <li><i class="fas fa-check-circle"></i> Access exclusive features</li>
                </ul>
            </div>
            <div class="login-form">
                <div class="login-form-header">
                    <h2>Login to Your Account</h2>
                    <p>Enter your credentials to access your dashboard</p>
                </div>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email Address</label>
                        <input type="email" id="login-email" class="form-control" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control" placeholder="Enter your password" required>
                        <button type="button" class="password-toggle" id="login-password-toggle">
                            <i class="fas fa-eye"></i>
                        </button>
                        <a href="#" class="forgot-password" onclick="app.openModal('password-reset-modal'); return false;">Forgot Password?</a>
                    </div>
                    <div id="two-factor-section" style="display: none;">
                        <div class="form-group">
                            <label for="two-factor-code">Two-Factor Authentication Code</label>
                            <input type="text" id="two-factor-code" class="form-control" placeholder="Enter 6-digit code">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="login-btn">
                        <span class="btn-text">Login</span>
                        <div class="btn-loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </button>
                </form>
                <div class="login-form-footer">
                    <p>Don't have an account? <a href="#" onclick="app.showPage('register')">Register here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="dashboard-page" style="display: none;">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h1>Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">JD</div>
                    <div>
                        <div id="user-name">John Doe</div>
                        <div style="color: var(--text-muted); font-size: 0.9rem;" id="user-tier">Standard Investor</div>
                    </div>
                    <button class="btn btn-outline" onclick="app.logout()">Logout</button>
                </div>
            </div>
            <div class="dashboard-content">
                <div class="dashboard-main">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Balance</h3>
                            <div class="value" id="total-balance">0.00</div>
                        </div>
                        <div class="stat-card">
                            <h3>Active Investments</h3>
                            <div class="value" id="active-investments">0.00</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Earnings</h3>
                            <div class="value" id="total-earnings">0.00</div>
                        </div>
                        <div class="stat-card">
                            <h3>Referral Earnings</h3>
                            <div class="value" id="referral-earnings">0.00</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>Earnings Overview</h3>
                        <canvas id="earnings-chart"></canvas>
                    </div>
                    <div class="investments-list">
                        <h3>Active Investments</h3>
                        <div id="active-investments-list">
                            <!-- Active investments will be dynamically loaded here -->
                        </div>
                    </div>
                    <div class="transactions-list">
                        <h3>Recent Transactions</h3>
                        <div id="recent-transactions-list">
                            <!-- Recent transactions will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
                <div class="dashboard-sidebar">
                    <div class="quick-actions">
                        <div class="action-card" onclick="app.openModal('invest-modal')">
                            <i class="fas fa-plus-circle"></i>
                            <h3>New Investment</h3>
                            <p>Start a new investment plan</p>
                        </div>
                        <div class="action-card" onclick="app.openModal('deposit-modal')">
                            <i class="fas fa-wallet"></i>
                            <h3>Deposit Funds</h3>
                            <p>Add funds to your account</p>
                        </div>
                        <div class="action-card" onclick="app.openModal('withdraw-modal')">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3>Withdraw Funds</h3>
                            <p>Transfer to your bank account</p>
                        </div>
                        <div class="action-card" onclick="app.showPage('referral')">
                            <i class="fas fa-user-friends"></i>
                            <h3>Refer Friends</h3>
                            <p>Earn 15% referral bonus</p>
                        </div>
                        <div class="action-card" onclick="app.showPage('support')">
                            <i class="fas fa-headset"></i>
                            <h3>Support</h3>
                            <p>24/7 customer service</p>
                        </div>
                        <div class="action-card" onclick="app.showPage('profile')">
                            <i class="fas fa-user-cog"></i>
                            <h3>Profile</h3>
                            <p>Manage your account</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Investment Plans Page -->
    <div id="investment-plans-page" class="investment-plans-page" style="display: none;">
        <div class="investment-plans-container">
            <div class="investment-plans-header">
                <h1>Raw Materials Investment Plans</h1>
                <p>Choose the plan that best fits your financial goals</p>
            </div>
            <div class="investment-plans-content">
                <div class="plans-container" id="investment-plans-list">
                    <!-- Investment plans will be dynamically loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div id="profile-page" class="profile-page" style="display: none;">
        <div class="profile-container">
            <div class="profile-header">
                <h1>Profile Settings</h1>
                <button class="btn btn-primary" onclick="app.showPage('dashboard')">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            <div class="profile-content">
                <div class="profile-sidebar">
                    <ul class="profile-nav">
                        <li><a href="#" class="active" onclick="app.switchProfileTab('personal')">
                            <i class="fas fa-user"></i> Personal Information
                        </a></li>
                        <li><a href="#" onclick="app.switchProfileTab('security')">
                            <i class="fas fa-shield-alt"></i> Security
                        </a></li>
                        <li><a href="#" onclick="app.switchProfileTab('bank')">
                            <i class="fas fa-university"></i> Bank Details
                        </a></li>
                        <li><a href="#" onclick="app.switchProfileTab('preferences')">
                            <i class="fas fa-cog"></i> Preferences
                        </a></li>
                        <li><a href="#" onclick="app.switchProfileTab('kyc')">
                            <i class="fas fa-id-card"></i> KYC Verification
                        </a></li>
                    </ul>
                </div>
                <div class="profile-main">
                    <!-- Personal Information Tab -->
                    <div class="profile-section" id="personal-tab">
                        <h2>Personal Information</h2>
                        <form id="personal-form">
                            <div class="form-group">
                                <label for="profile-fullname">Full Name</label>
                                <input type="text" id="profile-fullname" class="form-control" value="John Doe">
                            </div>
                            <div class="form-group">
                                <label for="profile-email">Email Address</label>
                                <input type="email" id="profile-email" class="form-control" value="john.doe@example.com" readonly>
                            </div>
                            <div class="form-group">
                                <label for="profile-phone">Phone Number</label>
                                <input type="tel" id="profile-phone" class="form-control" value="+234 (0) 812 345 6789">
                            </div>
                            <div class="form-group">
                                <label for="profile-country">Country</label>
                                <select id="profile-country" class="form-control">
                                    <option value="ng">Nigeria</option>
                                    <option value="gh">Ghana</option>
                                    <option value="sa">South Africa</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </form>
                    </div>

                    <!-- Security Tab -->
                    <div class="profile-section" id="security-tab" style="display: none;">
                        <h2>Security Settings</h2>
                        <div class="form-group">
                            <label>Two-Factor Authentication</label>
                            <div class="two-factor-setup">
                                <p>Enhance your account security with two-factor authentication.</p>
                                <div id="two-factor-status">
                                    <p>Status: <span id="2fa-status-text">Disabled</span></p>
                                </div>
                                <button class="btn btn-outline" id="enable-2fa-btn" onclick="app.enable2FA()">Enable 2FA</button>
                                <button class="btn btn-outline" id="disable-2fa-btn" style="display: none;" onclick="app.disable2FA()">Disable 2FA</button>
                            </div>
                        </div>
                        <form id="password-change-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" class="form-control" placeholder="Enter current password">
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" class="form-control" placeholder="Enter new password">
                            </div>
                            <div class="form-group">
                                <label for="confirm-new-password">Confirm New Password</label>
                                <input type="password" id="confirm-new-password" class="form-control" placeholder="Confirm new password">
                            </div>
                            <button type="submit" class="btn btn-primary">Change Password</button>
                        </form>
                    </div>

                    <!-- Bank Details Tab -->
                    <div class="profile-section" id="bank-tab" style="display: none;">
                        <h2>Bank Account Details</h2>
                        <form id="bank-form">
                            <div class="form-group">
                                <label for="bank-name">Bank Name</label>
                                <input type="text" id="bank-name" class="form-control" placeholder="Enter your bank name">
                            </div>
                            <div class="form-group">
                                <label for="account-name">Account Name</label>
                                <input type="text" id="account-name" class="form-control" placeholder="Enter account name">
                            </div>
                            <div class="form-group">
                                <label for="account-number">Account Number</label>
                                <input type="text" id="account-number" class="form-control" placeholder="Enter account number">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Bank Details</button>
                        </form>
                    </div>

                    <!-- Preferences Tab -->
                    <div class="profile-section" id="preferences-tab" style="display: none;">
                        <h2>Account Preferences</h2>
                        <form id="preferences-form">
                            <div class="form-group">
                                <label for="currency">Default Currency</label>
                                <select id="currency" class="form-control">
                                    <option value="ngn">NGN ()</option>
                                    <option value="usd">USD ($)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="language">Language</label>
                                <select id="language" class="form-control">
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="timezone">Timezone</label>
                                <select id="timezone" class="form-control">
                                    <option value="wast">West Africa Standard Time (WAT)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="risk-tolerance-pref">Risk Tolerance</label>
                                <select id="risk-tolerance-pref" class="form-control">
                                    <option value="low">Low (Conservative)</option>
                                    <option value="medium">Medium (Balanced)</option>
                                    <option value="high">High (Aggressive)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="investment-strategy-pref">Investment Strategy</label>
                                <select id="investment-strategy-pref" class="form-control">
                                    <option value="conservative">Conservative</option>
                                    <option value="balanced">Balanced</option>
                                    <option value="aggressive">Aggressive</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Preferences</button>
                        </form>
                    </div>

                    <!-- KYC Verification Tab -->
                    <div class="profile-section" id="kyc-tab" style="display: none;">
                        <h2>KYC Verification</h2>
                        <div id="kyc-status">
                            <p>Status: <span id="kyc-status-text" class="status-badge pending">Pending</span></p>
                        </div>
                        <form id="kyc-form">
                            <div class="form-group">
                                <label for="id-type">ID Type</label>
                                <select id="id-type" class="form-control" required>
                                    <option value="">Select ID Type</option>
                                    <option value="national_id">National ID</option>
                                    <option value="passport">Passport</option>
                                    <option value="driver_license">Driver's License</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="id-number">ID Number</label>
                                <input type="text" id="id-number" class="form-control" placeholder="Enter ID Number" required>
                            </div>
                            <div class="form-group">
                                <label>Upload ID Front</label>
                                <div class="file-upload-container" onclick="document.getElementById('id-front').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload ID front image</p>
                                    <input type="file" id="id-front" accept="image/*" style="display: none;" required>
                                </div>
                                <img id="id-front-preview" class="file-preview" src="" alt="ID front preview">
                            </div>
                            <div class="form-group">
                                <label>Upload ID Back</label>
                                <div class="file-upload-container" onclick="document.getElementById('id-back').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload ID back image</p>
                                    <input type="file" id="id-back" accept="image/*" style="display: none;" required>
                                </div>
                                <img id="id-back-preview" class="file-preview" src="" alt="ID back preview">
                            </div>
                            <div class="form-group">
                                <label>Upload Selfie with ID</label>
                                <div class="file-upload-container" onclick="document.getElementById('selfie-with-id').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload selfie with ID</p>
                                    <input type="file" id="selfie-with-id" accept="image/*" style="display: none;" required>
                                </div>
                                <img id="selfie-with-id-preview" class="file-preview" src="" alt="Selfie with ID preview">
                            </div>
                            <button type="submit" class="btn btn-primary" id="kyc-submit-btn">Submit KYC Application</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Referral Page -->
    <div id="referral-page" class="referral-page" style="display: none;">
        <div class="referral-container">
            <div class="referral-header">
                <h1>Referral Program</h1>
                <p>Earn more by inviting friends to join Raw Wealthy</p>
            </div>
            <div class="referral-content">
                <div class="referral-stats">
                    <h2>Your Referral Stats</h2>
                    <div class="referral-stat">
                        <span>Total Referrals</span>
                        <span id="total-referrals">0</span>
                    </div>
                    <div class="referral-stat">
                        <span>Active Referrals</span>
                        <span id="active-referrals">0</span>
                    </div>
                    <div class="referral-stat">
                        <span>Referral Earnings</span>
                        <span style="color: var(--accent-gold);" id="referral-earnings-amount">0.00</span>
                    </div>
                    <div class="referral-stat">
                        <span>Commission Rate</span>
                        <span style="color: var(--warning);" id="commission-rate">15%</span>
                    </div>
                </div>
                <div class="referral-links">
                    <h2>Your Referral Link</h2>
                    <div class="form-group">
                        <label>Share this link with friends</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="referral-link" class="form-control" value="" readonly>
                            <button class="btn btn-primary" onclick="app.copyReferralLink()">Copy</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Your Referral Code</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="referral-code" class="form-control" value="" readonly>
                            <button class="btn btn-primary" onclick="app.copyReferralCode()">Copy</button>
                        </div>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <h3>How it works:</h3>
                        <ul style="padding-left: 1.2rem; margin-top: 0.5rem;">
                            <li>Share your referral link with friends</li>
                            <li>When they sign up and invest, you earn 15% of their first investment</li>
                            <li>No limit on how much you can earn</li>
                            <li>Earnings are credited after their investment is approved</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Support Page -->
    <div id="support-page" class="support-page" style="display: none;">
        <div class="support-container">
            <div class="support-header">
                <h1>Help & Support</h1>
                <p>We're here to help you with any questions or issues</p>
            </div>
            <div class="support-content">
                <div class="support-categories">
                    <div class="support-category active" onclick="app.switchSupportCategory('faq')">
                        <i class="fas fa-question-circle"></i> FAQ
                    </div>
                    <div class="support-category" onclick="app.switchSupportCategory('contact')">
                        <i class="fas fa-envelope"></i> Contact Us
                    </div>
                </div>
                <div class="support-main">
                    <!-- FAQ Category -->
                    <div id="faq-category">
                        <h2>Frequently Asked Questions</h2>
                        <div class="faq-item active">
                            <div class="faq-question" onclick="app.toggleFaq(this)">
                                How do I start investing? <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                <p>To start investing, simply register for an account, verify your identity, choose an investment plan that suits your goals, and make your first deposit. The process takes less than 10 minutes.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="app.toggleFaq(this)">
                                When will I receive my returns? <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                <p>Returns are calculated daily and credited to your account at the end of each business day. You can withdraw your earnings or reinvest them for compound growth.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="app.toggleFaq(this)">
                                What is the minimum investment? <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                <p>The minimum investment is 3,500 for most of our plans. We offer tiered plans to accommodate different investment levels and goals.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="app.toggleFaq(this)">
                                How secure is my investment? <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                <p>We employ bank-level security measures including SSL encryption, two-factor authentication, and segregated client accounts. Your investments are protected by our comprehensive security protocols.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-question" onclick="app.toggleFaq(this)">
                                Are there any withdrawal fees? <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="faq-answer">
                                <p>Yes, we charge a 5% platform fee on all withdrawals to cover transaction costs and platform maintenance. This fee is automatically deducted from your withdrawal amount.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Category -->
                    <div id="contact-category" style="display: none;">
                        <h2>Contact Our Support Team</h2>
                        <form id="support-form">
                            <div class="form-group">
                                <label for="support-subject">Subject</label>
                                <input type="text" id="support-subject" class="form-control" placeholder="Enter subject" required>
                            </div>
                            <div class="form-group">
                                <label for="support-category">Category</label>
                                <select id="support-category" class="form-control" required>
                                    <option value="general">General Inquiry</option>
                                    <option value="technical">Technical Issue</option>
                                    <option value="investment">Investment Related</option>
                                    <option value="withdrawal">Withdrawal Issue</option>
                                    <option value="deposit">Deposit Issue</option>
                                    <option value="kyc">KYC Verification</option>
                                    <option value="account">Account Issue</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="support-message">Message</label>
                                <textarea id="support-message" class="form-control" rows="5" placeholder="Describe your issue" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Send Message</button>
                        </form>
                        <div style="margin-top: 1.5rem; text-align: center;">
                            <p>Or contact us directly:</p>
                            <p><i class="fas fa-envelope"></i> rawwealthy@gmail.com</p>
                            <p><i class="fas fa-phone"></i> +234 (0) 902 802 2559</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Page -->
    <div id="admin-page" class="admin-page" style="display: none;">
        <div class="admin-container">
            <div class="admin-header">
                <h1>Admin Dashboard</h1>
                <button class="btn btn-outline" onclick="app.logout()">Logout</button>
            </div>
            <div class="admin-content">
                <div class="admin-sidebar">
                    <ul class="admin-nav">
                        <li><a href="#" class="active" onclick="app.switchAdminTab('overview')">
                            <i class="fas fa-tachometer-alt"></i> Overview
                        </a></li>
                        <li><a href="#" onclick="app.switchAdminTab('users')">
                            <i class="fas fa-users"></i> Users
                        </a></li>
                        <li><a href="#" onclick="app.switchAdminTab('investments')">
                            <i class="fas fa-chart-line"></i> Investments
                        </a></li>
                        <li><a href="#" onclick="app.switchAdminTab('deposits')">
                            <i class="fas fa-wallet"></i> Deposits
                        </a></li>
                        <li><a href="#" onclick="app.switchAdminTab('withdrawals')">
                            <i class="fas fa-money-bill-wave"></i> Withdrawals
                        </a></li>
                        <li><a href="#" onclick="app.switchAdminTab('kyc-admin')">
                            <i class="fas fa-id-card"></i> KYC
                        </a></li>
                    </ul>
                </div>
                <div class="admin-main">
                    <!-- Overview Tab -->
                    <div id="overview-tab">
                        <h2>Platform Overview</h2>
                        <div class="admin-stats">
                            <div class="admin-stat">
                                <span class="value" id="admin-total-users">0</span>
                                <span class="label">Total Users</span>
                            </div>
                            <div class="admin-stat">
                                <span class="value" id="admin-total-invested">0</span>
                                <span class="label">Total Invested</span>
                            </div>
                            <div class="admin-stat">
                                <span class="value" id="admin-total-withdrawn">0</span>
                                <span class="label">Total Withdrawn</span>
                            </div>
                            <div class="admin-stat">
                                <span class="value" id="admin-pending-requests">0</span>
                                <span class="label">Pending Requests</span>
                            </div>
                            <div class="admin-stat">
                                <span class="value" id="admin-platform-earnings">0</span>
                                <span class="label">Platform Earnings</span>
                            </div>
                            <div class="admin-stat">
                                <span class="value" id="admin-referral-earnings">0</span>
                                <span class="label">Referral Earnings</span>
                            </div>
                        </div>

                        <div class="chart-container">
                            <h3>Platform Growth</h3>
                            <canvas id="platform-growth-chart"></canvas>
                        </div>
                    </div>

                    <!-- Users Tab -->
                    <div id="users-tab" style="display: none;">
                        <h2>User Management</h2>
                        <div style="margin-bottom: 1rem;">
                            <input type="text" class="form-control" placeholder="Search users..." id="user-search" style="width: 300px;">
                        </div>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Joined</th>
                                    <th>Role</th>
                                    <th>Balance</th>
                                    <th>Status</th>
                                    <th>KYC</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-users-table">
                                <!-- Users will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Investments Tab -->
                    <div id="investments-tab" style="display: none;">
                        <h2>Investment Requests</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Plan</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-investments-table">
                                <!-- Investment requests will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Deposits Tab -->
                    <div id="deposits-tab" style="display: none;">
                        <h2>Deposit Requests</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-deposits-table">
                                <!-- Deposit requests will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Withdrawals Tab -->
                    <div id="withdrawals-tab" style="display: none;">
                        <h2>Withdrawal Requests</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Amount</th>
                                    <th>Fee</th>
                                    <th>Net Amount</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-withdrawals-table">
                                <!-- Withdrawal requests will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- KYC Admin Tab -->
                    <div id="kyc-admin-tab" style="display: none;">
                        <h2>KYC Verification Requests</h2>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>ID Type</th>
                                    <th>ID Number</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-kyc-table">
                                <!-- KYC requests will be dynamically loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Investment Modal -->
    <div id="invest-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Make Investment</h2>
                <button class="close-modal" onclick="app.closeModal('invest-modal')">&times;</button>
            </div>
            <form id="invest-form">
                <div class="form-group">
                    <label for="investment-plan">Select Raw Material</label>
                    <select id="investment-plan" class="form-control" required>
                        <option value="">Choose a raw material</option>
                        <!-- Options will be dynamically loaded -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="investment-amount">Investment Amount ()</label>
                    <input type="number" id="investment-amount" class="form-control" placeholder="Enter amount" min="3500" required>
                </div>
                <div class="form-group">
                    <label>Auto Renew Investment</label>
                    <div style="margin-top: 10px;">
                        <input type="checkbox" id="auto-renew" style="margin-right: 8px;">
                        <label for="auto-renew">Automatically reinvest earnings when investment completes</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Upload Payment Proof (Required)</label>
                    <div class="file-upload-container" onclick="document.getElementById('investment-proof').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload payment screenshot</p>
                        <input type="file" id="investment-proof" accept="image/*" style="display: none;" required>
                    </div>
                    <img id="investment-preview" class="file-preview" src="" alt="Payment proof preview">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="invest-btn">
                    <span class="btn-text">Submit Investment Request</span>
                    <div class="btn-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </button>
            </form>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div id="deposit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Deposit Funds</h2>
                <button class="close-modal" onclick="app.closeModal('deposit-modal')">&times;</button>
            </div>
            <form id="deposit-form">
                <div class="form-group">
                    <label for="deposit-amount">Amount ()</label>
                    <input type="number" id="deposit-amount" class="form-control" placeholder="Enter amount" min="500" required>
                </div>
                <div class="form-group">
                    <label for="deposit-method">Payment Method</label>
                    <select id="deposit-method" class="form-control" required>
                        <option value="">Select payment method</option>
                        <option value="bank_transfer">Bank Transfer</option>
                        <option value="crypto">Cryptocurrency</option>
                        <option value="paypal">PayPal</option>
                        <option value="card">Credit/Debit Card</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Upload Payment Proof (Required)</label>
                    <div class="file-upload-container" onclick="document.getElementById('deposit-proof').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload payment screenshot</p>
                        <input type="file" id="deposit-proof" accept="image/*" style="display: none;" required>
                    </div>
                    <img id="deposit-preview" class="file-preview" src="" alt="Payment proof preview">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="deposit-btn">
                    <span class="btn-text">Submit Deposit Request</span>
                    <div class="btn-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </button>
            </form>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdraw-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Withdraw Funds</h2>
                <button class="close-modal" onclick="app.closeModal('withdraw-modal')">&times;</button>
            </div>
            <form id="withdraw-form">
                <div class="withdrawal-fee-notice">
                    <i class="fas fa-info-circle"></i>
                    <span>5% platform fee will be deducted from your withdrawal amount</span>
                </div>
                <div class="form-group">
                    <label for="withdraw-amount">Amount ()</label>
                    <input type="number" id="withdraw-amount" class="form-control" placeholder="Enter amount" min="1000" required>
                    <small style="color: var(--text-muted);">Available balance: <span id="available-balance">0.00</span></small>
                    <small style="color: var(--warning); display: block; margin-top: 0.5rem;" id="withdrawal-fee-notice">Platform fee: 0.00</small>
                </div>
                <div class="form-group">
                    <label for="withdraw-method">Withdrawal Method</label>
                    <select id="withdraw-method" class="form-control" required>
                        <option value="">Select withdrawal method</option>
                        <option value="bank_transfer">Bank Transfer</option>
                        <option value="crypto">Cryptocurrency</option>
                        <option value="paypal">PayPal</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="withdraw-btn">
                    <span class="btn-text">Request Withdrawal</span>
                    <div class="btn-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </button>
            </form>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div id="password-reset-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reset Your Password</h2>
                <button class="close-modal" onclick="app.closeModal('password-reset-modal')">&times;</button>
            </div>
            <form id="password-reset-form">
                <div class="form-group">
                    <label for="reset-email">Email Address</label>
                    <input type="email" id="reset-email" class="form-control" placeholder="Enter your email" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Send Reset Code</button>
            </form>
            <div class="form-footer" style="margin-top: 1rem;">
                <p>Remember your password? <a href="#" onclick="app.closeModal('password-reset-modal'); app.showPage('login');">Login here</a></p>
            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <div class="back-to-top" id="back-to-top">
        <i class="fas fa-chevron-up"></i>
    </div>

    <script>// ==================== RAW WEALTHY FRONTEND v55.0 - ADVANCED EDITION ====================
const app = {
    // ==================== ENHANCED CONFIGURATION ====================
    config: {
        API_BASE_URL: (() => {
            // Dynamic API URL detection
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:10000';
            }
            if (window.location.hostname.includes('vercel.app')) {
                return 'https://real-wealthy-1.onrender.com';
            }
            if (window.location.hostname.includes('github.io') || window.location.hostname.includes('netlify.app')) {
                return 'https://raw-wealthy-backend.herokuapp.com';
            }
            return window.location.origin;
        })(),
        VERSION: '55.0.0',
        ENVIRONMENT: window.location.hostname === 'localhost' ? 'development' : 'production',
        MIN_INVESTMENT: 3500,
        MIN_DEPOSIT: 3500,
        MIN_WITHDRAWAL: 3500,
        PLATFORM_FEE_PERCENT: 10,
        REFERRAL_COMMISSION_PERCENT: 10,
        WELCOME_BONUS: 100,
        AUTO_REFRESH_INTERVAL: 300000, // 5 minutes
        TOKEN_REFRESH_INTERVAL: 86400000, // 24 hours
        DAILY_INTEREST_TIME: '00:00', // Midnight UTC
        WHATSAPP_ADMIN_NUMBER: '2349028022559'
    },

    // ==================== ENHANCED APPLICATION STATE ====================
    state: {
        currentUser: null,
        token: localStorage.getItem('raw_wealthy_token'),
        investmentPlans: [],
        notifications: [],
        isAdmin: false,
        isAuthenticated: false,
        lastDataUpdate: null,
        autoRefreshInterval: null,
        tokenRefreshInterval: null,
        dailyInterestInterval: null,
        charts: {},
        userStats: {
            balance: 0,
            activeInvestments: 0,
            dailyEarnings: 0,
            totalEarnings: 0,
            referralEarnings: 0,
            portfolioValue: 0,
            totalDeposits: 0,
            totalWithdrawals: 0,
            totalInvestments: 0
        },
        adminData: {
            users: [],
            investments: [],
            deposits: [],
            withdrawals: [],
            kycSubmissions: []
        },
        sessionStartTime: null,
        activityTracker: {
            lastAction: null,
            pageViews: {},
            idleTimer: null
        }
    },

    // ==================== INITIALIZATION ====================
    init() {
        console.log(' Raw Wealthy Frontend v55.0 - Advanced Edition Initializing...');
        console.log(` Backend URL: ${this.config.API_BASE_URL}`);
        console.log(` Environment: ${this.config.ENVIRONMENT}`);
        
        // Setup all event listeners first
        this.setupEventListeners();
        
        // Initialize theme
        this.initTheme();
        
        // Check authentication status
        this.checkAuthentication();
        
        // Load initial data
        this.loadInitialData();
        
        // Initialize advanced features
        this.initAdvancedFeatures();
        
        // Start background services
        this.startBackgroundServices();
        
        console.log(' Application initialized successfully');
    },

    // ==================== ADVANCED FEATURES INITIALIZATION ====================
    initAdvancedFeatures() {
        // Initialize session tracking
        this.state.sessionStartTime = new Date();
        this.state.activityTracker.lastAction = new Date();
        
        // Initialize page views tracker
        this.state.activityTracker.pageViews = {
            home: 0,
            dashboard: 0,
            investments: 0,
            profile: 0,
            referrals: 0
        };
        
        // Setup idle detection
        this.setupIdleDetection();
        
        // Setup connection monitoring
        this.setupConnectionMonitoring();
        
        // Setup performance monitoring
        this.setupPerformanceMonitoring();
        
        console.log(' Advanced features initialized');
    },

    setupIdleDetection() {
        // Reset idle timer on user activity
        const events = ['mousemove', 'keypress', 'scroll', 'click', 'touchstart'];
        events.forEach(event => {
            document.addEventListener(event, () => {
                this.state.activityTracker.lastAction = new Date();
                clearTimeout(this.state.activityTracker.idleTimer);
                
                // Set idle timeout for 30 minutes
                this.state.activityTracker.idleTimer = setTimeout(() => {
                    this.handleIdleTimeout();
                }, 30 * 60 * 1000);
            }, { passive: true });
        });
    },

    setupConnectionMonitoring() {
        // Monitor online/offline status
        window.addEventListener('online', () => {
            this.showToast(' Connection restored', 'success');
            this.syncPendingData();
        });

        window.addEventListener('offline', () => {
            this.showToast(' You are offline. Some features may be limited.', 'warning');
        });
    },

    setupPerformanceMonitoring() {
        // Track page load performance
        if ('PerformanceObserver' in window) {
            const observer = new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (entry.entryType === 'navigation') {
                        console.log(` Page load time: ${entry.loadEventEnd - entry.startTime}ms`);
                    }
                }
            });
            observer.observe({ entryTypes: ['navigation'] });
        }
    },

    // ==================== BACKGROUND SERVICES ====================
    startBackgroundServices() {
        // Auto-refresh data every 5 minutes
        this.state.autoRefreshInterval = setInterval(() => {
            this.backgroundDataRefresh();
        }, this.config.AUTO_REFRESH_INTERVAL);

        // Token refresh (keeps user logged in forever)
        this.state.tokenRefreshInterval = setInterval(() => {
            this.refreshTokenSilently();
        }, this.config.TOKEN_REFRESH_INTERVAL);

        // Daily interest notification
        this.setupDailyInterestNotification();

        console.log(' Background services started');
    },

    async backgroundDataRefresh() {
        if (!this.state.isAuthenticated) return;

        try {
            console.log(' Background data refresh...');
            
            // Only refresh if user is on dashboard or investment pages
            const currentPage = this.getCurrentPage();
            const shouldRefresh = ['dashboard', 'investments', 'profile', 'referrals'].includes(currentPage);
            
            if (shouldRefresh) {
                await this.updateDashboard();
                await this.loadNotifications();
                
                // Update last refresh time
                this.state.lastDataUpdate = new Date();
                
                // Show subtle notification (only if user is active)
                const now = new Date();
                const timeSinceLastAction = now - this.state.activityTracker.lastAction;
                
                if (timeSinceLastAction < 60000) { // User active in last minute
                    this.showSubtleNotification(' Data refreshed', 'info', 2000);
                }
            }
        } catch (error) {
            console.log('Background refresh error:', error.message);
        }
    },

    async refreshTokenSilently() {
        if (!this.state.token) return;

        try {
            console.log(' Silently refreshing token...');
            
            // Try to refresh token by calling a protected endpoint
            const response = await fetch(`${this.config.API_BASE_URL}/api/profile`, {
                headers: {
                    'Authorization': `Bearer ${this.state.token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                console.log(' Token is still valid');
                // Update last activity timestamp
                localStorage.setItem('last_activity', Date.now());
            } else if (response.status === 401) {
                console.log(' Token expired, attempting silent refresh...');
                await this.attemptSilentRefresh();
            }
        } catch (error) {
            console.log('Token refresh error:', error.message);
        }
    },

    async attemptSilentRefresh() {
        try {
            // Try to get a new token using refresh token logic
            // This would require implementing refresh tokens on backend
            console.log('Attempting silent refresh...');
            
            // For now, we'll just redirect to login if token is invalid
            // In a production app, you would implement refresh tokens
            this.showToast('Your session has expired. Please login again.', 'warning');
            setTimeout(() => {
                this.logout();
            }, 3000);
        } catch (error) {
            console.error('Silent refresh failed:', error);
            this.logout();
        }
    },

    setupDailyInterestNotification() {
        // Check if it's time for daily interest (midnight UTC)
        const now = new Date();
        const utcHours = now.getUTCHours();
        const utcMinutes = now.getUTCMinutes();
        
        // Convert config time to UTC
        const [configHour, configMinute] = this.config.DAILY_INTEREST_TIME.split(':').map(Number);
        
        // Calculate time until next daily interest
        const hoursUntil = (configHour - utcHours + 24) % 24;
        const minutesUntil = configMinute - utcMinutes;
        const totalMinutesUntil = hoursUntil * 60 + minutesUntil;
        
        if (totalMinutesUntil < 0) {
            // Already passed today, schedule for tomorrow
            const tomorrow = new Date(now);
            tomorrow.setUTCDate(tomorrow.getUTCDate() + 1);
            tomorrow.setUTCHours(configHour, configMinute, 0, 0);
            
            const delay = tomorrow.getTime() - now.getTime();
            
            setTimeout(() => {
                this.checkAndShowDailyInterest();
                // Set up recurring check
                this.state.dailyInterestInterval = setInterval(() => {
                    this.checkAndShowDailyInterest();
                }, 24 * 60 * 60 * 1000); // 24 hours
            }, delay);
        } else {
            // Schedule for today
            const targetTime = new Date(now);
            targetTime.setUTCHours(configHour, configMinute, 0, 0);
            
            const delay = targetTime.getTime() - now.getTime();
            
            setTimeout(() => {
                this.checkAndShowDailyInterest();
                // Set up recurring check
                this.state.dailyInterestInterval = setInterval(() => {
                    this.checkAndShowDailyInterest();
                }, 24 * 60 * 60 * 1000); // 24 hours
            }, delay);
        }
    },

    async checkAndShowDailyInterest() {
        if (!this.state.isAuthenticated) return;

        try {
            console.log(' Checking for daily interest...');
            
            // Get user's active investments
            const response = await this.apiRequest('/api/investments?status=active');
            
            if (response.success && response.data && response.data.investments) {
                const investments = response.data.investments;
                
                if (investments.length > 0) {
                    // Calculate total daily interest
                    let totalDailyInterest = 0;
                    let breakdown = [];
                    
                    investments.forEach(inv => {
                        if (inv.plan && inv.plan.daily_interest) {
                            const dailyInterest = (inv.amount * inv.plan.daily_interest) / 100;
                            totalDailyInterest += dailyInterest;
                            breakdown.push({
                                plan: inv.plan.name,
                                amount: inv.amount,
                                rate: inv.plan.daily_interest,
                                interest: dailyInterest
                            });
                        }
                    });
                    
                    if (totalDailyInterest > 0) {
                        // Show advanced notification
                        this.showDailyInterestNotification(totalDailyInterest, breakdown);
                        
                        // Update dashboard to reflect new earnings
                        setTimeout(() => {
                            this.updateDashboard();
                        }, 5000); // Wait 5 seconds for backend to process
                    }
                }
            }
        } catch (error) {
            console.error(' Error checking daily interest:', error);
        }
    },

    showDailyInterestNotification(totalInterest, breakdown) {
        // Create custom notification
        const notificationHTML = `
            <div class="daily-interest-notification">
                <div class="notification-header">
                    <i class="fas fa-coins"></i>
                    <h3>Daily Interest Credited!</h3>
                </div>
                <div class="notification-body">
                    <div class="total-interest">
                        <span>Total Added:</span>
                        <strong>${totalInterest.toLocaleString()}</strong>
                    </div>
                    ${breakdown.length > 0 ? `
                    <div class="breakdown">
                        <h4>Breakdown:</h4>
                        ${breakdown.map(item => `
                            <div class="breakdown-item">
                                <span>${item.plan}:</span>
                                <span>${item.interest.toLocaleString()} (${item.rate}% of ${item.amount.toLocaleString()})</span>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    <div class="notification-footer">
                        <small>Updated at ${new Date().toLocaleTimeString()}</small>
                    </div>
                </div>
            </div>
        `;

        // Add custom CSS for notification
        const style = document.createElement('style');
        style.textContent = `
            .daily-interest-notification {
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 1.5rem;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
                margin-bottom: 1rem;
                animation: slideInRight 0.5s ease;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }
            .notification-header {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                margin-bottom: 1rem;
            }
            .notification-header i {
                font-size: 1.5rem;
                background: rgba(255, 255, 255, 0.2);
                padding: 0.5rem;
                border-radius: 50%;
            }
            .notification-header h3 {
                margin: 0;
                font-size: 1.25rem;
            }
            .total-interest {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: rgba(255, 255, 255, 0.1);
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 1rem;
                font-size: 1.1rem;
            }
            .total-interest strong {
                font-size: 1.5rem;
                color: #fbbf24;
            }
            .breakdown {
                background: rgba(0, 0, 0, 0.2);
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 1rem;
            }
            .breakdown h4 {
                margin: 0 0 0.75rem 0;
                font-size: 1rem;
                opacity: 0.9;
            }
            .breakdown-item {
                display: flex;
                justify-content: space-between;
                padding: 0.5rem 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                font-size: 0.9rem;
            }
            .breakdown-item:last-child {
                border-bottom: none;
            }
            .notification-footer {
                text-align: center;
                opacity: 0.8;
                font-size: 0.8rem;
                margin-top: 1rem;
            }
        `;
        document.head.appendChild(style);

        // Show notification
        this.showToast(notificationHTML, 'success', 10000); // Show for 10 seconds
    },

    // ==================== AUTHENTICATION SYSTEM ====================
    checkAuthentication() {
        const token = localStorage.getItem('raw_wealthy_token');
        const lastActivity = localStorage.getItem('last_activity');
        const now = Date.now();

        if (token) {
            // Check if session is still valid (30 days max)
            if (lastActivity && (now - parseInt(lastActivity) < 30 * 24 * 60 * 60 * 1000)) {
                console.log(' Token found, verifying...');
                this.state.token = token;
                this.verifyToken();
            } else {
                console.log(' Session expired, clearing token');
                this.clearSessionData();
                this.showPage('home');
            }
        } else {
            console.log(' No token found, showing home page');
            this.showPage('home');
        }
    },

    async verifyToken() {
        try {
            console.log(' Verifying authentication token...');
            
            // Try to get user profile to verify token
            const response = await this.apiRequest('/api/profile');
            
            if (response.success && response.data && response.data.user) {
                console.log(' Token verification successful');
                
                this.state.currentUser = response.data.user;
                this.state.isAdmin = this.state.currentUser.role === 'admin' || this.state.currentUser.role === 'super_admin';
                this.state.isAuthenticated = true;

                // Update user display
                this.updateUserDisplay();

                // Update last activity
                localStorage.setItem('last_activity', Date.now());

                // Redirect based on role
                if (this.state.isAdmin) {
                    this.showPage('admin');
                    this.loadAdminData();
                } else {
                    this.showPage('dashboard');
                    this.updateDashboard();
                }
                
                // Update navigation
                this.updateNavigation();
                
                // Start session tracking
                this.startSessionTracking();
                
            } else {
                console.error(' Token verification failed');
                this.clearSessionData();
                this.showPage('home');
            }
        } catch (error) {
            console.error(' Token verification error:', error);
            
            // If it's a network error, try to use cached data
            if (error.message.includes('Network') || error.message.includes('Failed to fetch')) {
                this.showToast(' Connection issue. Using cached data.', 'warning');
                this.useCachedData();
            } else {
                this.clearSessionData();
                this.showPage('home');
            }
        }
    },

    useCachedData() {
        // Try to use cached user data
        const cachedUser = localStorage.getItem('cached_user');
        if (cachedUser) {
            try {
                this.state.currentUser = JSON.parse(cachedUser);
                this.state.isAuthenticated = true;
                this.state.isAdmin = this.state.currentUser.role === 'admin';
                
                this.updateUserDisplay();
                this.showPage('dashboard');
                this.showToast('Using cached data. Some features may be limited.', 'warning');
            } catch (e) {
                this.clearSessionData();
                this.showPage('home');
            }
        } else {
            this.clearSessionData();
            this.showPage('home');
        }
    },

    clearSessionData() {
        // Clear all authentication data
        localStorage.removeItem('raw_wealthy_token');
        localStorage.removeItem('last_activity');
        localStorage.removeItem('cached_user');
        
        this.state.currentUser = null;
        this.state.token = null;
        this.state.isAdmin = false;
        this.state.isAuthenticated = false;
        
        // Clear intervals
        if (this.state.autoRefreshInterval) {
            clearInterval(this.state.autoRefreshInterval);
        }
        if (this.state.tokenRefreshInterval) {
            clearInterval(this.state.tokenRefreshInterval);
        }
        if (this.state.dailyInterestInterval) {
            clearInterval(this.state.dailyInterestInterval);
        }
        
        console.log(' Session data cleared');
    },

    startSessionTracking() {
        // Track session duration
        const sessionStart = new Date();
        
        // Log session start
        console.log(` Session started at: ${sessionStart.toISOString()}`);
        
        // Before page unload, log session duration
        window.addEventListener('beforeunload', () => {
            const sessionEnd = new Date();
            const duration = Math.round((sessionEnd - sessionStart) / 1000);
            console.log(` Session ended. Duration: ${duration} seconds`);
            
            // Save session data
            this.saveSessionData(duration);
        });
    },

    saveSessionData(duration) {
        // Save session statistics
        const sessionData = {
            userId: this.state.currentUser?._id,
            email: this.state.currentUser?.email,
            startTime: this.state.sessionStartTime,
            duration: duration,
            pageViews: this.state.activityTracker.pageViews,
            lastAction: this.state.activityTracker.lastAction
        };
        
        // Store in localStorage for analytics
        const analytics = JSON.parse(localStorage.getItem('user_analytics') || '[]');
        analytics.push(sessionData);
        localStorage.setItem('user_analytics', JSON.stringify(analytics.slice(-100))); // Keep last 100 sessions
    },

    // ==================== ENHANCED REGISTRATION ====================
    async handleRegistration(e) {
        e.preventDefault();

        const formData = {
            full_name: document.getElementById('fullname').value.trim(),
            email: document.getElementById('email').value.trim().toLowerCase(),
            phone: document.getElementById('phone').value.trim(),
            password: document.getElementById('password').value,
            referral_code: document.getElementById('referral').value.trim().toUpperCase() || undefined,
            risk_tolerance: document.getElementById('risk-tolerance').value,
            investment_strategy: document.getElementById('investment-strategy').value,
            country: 'NG' // Default country
        };

        // Advanced validation
        if (!this.validateRegistration(formData)) {
            return;
        }

        // Show loading with progress indicator
        this.showLoadingWithProgress('register-btn', 'Creating Account...');

        try {
            console.log(' Registration attempt for:', formData.email);
            
            // Step 1: Create account
            this.updateLoadingProgress('register-btn', 25, 'Creating account...');
            
            const response = await this.apiRequest('/api/auth/register', {
                method: 'POST',
                body: formData
            });

            console.log(' Registration response:', response);

            if (response.success && response.data && response.data.token) {
                // Step 2: Account created successfully
                this.updateLoadingProgress('register-btn', 75, 'Setting up your account...');
                
                this.state.token = response.data.token;
                this.state.currentUser = response.data.user;
                localStorage.setItem('raw_wealthy_token', response.data.token);
                localStorage.setItem('last_activity', Date.now());
                localStorage.setItem('cached_user', JSON.stringify(response.data.user));

                // Cache user data for offline use
                this.cacheUserData(response.data.user);

                // Step 3: Complete setup
                this.updateLoadingProgress('register-btn', 100, 'Finalizing...');

                // Show success animation
                this.showSuccessAnimation(' Registration successful! Welcome to Raw Wealthy.', () => {
                    // Update navigation
                    this.updateNavigation();

                    // Auto-login and redirect
                    setTimeout(() => {
                        this.showPage('dashboard');
                        this.updateDashboard();
                    }, 1500);
                });

                // Track registration in analytics
                this.trackRegistration(formData.email);

            } else {
                this.showToast(response.message || 'Registration failed', 'error');
                this.resetLoadingButton('register-btn');
            }
        } catch (error) {
            console.error(' Registration error:', error);
            
            if (error.message.includes('already exists')) {
                this.showToast('An account with this email already exists. Please login instead.', 'error');
            } else if (error.message.includes('Network')) {
                this.showToast('Network error. Please check your connection and try again.', 'error');
            } else {
                this.showToast('Registration failed. Please try again.', 'error');
            }
            
            this.resetLoadingButton('register-btn');
        }
    },

    validateRegistration(data) {
        const errors = [];

        if (data.full_name.length < 2) {
            errors.push('Full name must be at least 2 characters');
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(data.email)) {
            errors.push('Please enter a valid email address');
        }

        if (data.phone.length < 10) {
            errors.push('Please enter a valid phone number');
        }

        if (data.password.length < 6) {
            errors.push('Password must be at least 6 characters');
        }

        if (data.password !== document.getElementById('confirm-password').value) {
            errors.push('Passwords do not match!');
        }

        if (errors.length > 0) {
            this.showValidationErrors(errors);
            return false;
        }

        return true;
    },

    showValidationErrors(errors) {
        const errorHTML = `
            <div class="validation-errors">
                <h4>Please fix the following errors:</h4>
                <ul>
                    ${errors.map(error => `<li>${error}</li>`).join('')}
                </ul>
            </div>
        `;
        
        this.showToast(errorHTML, 'error', 5000);
    },

    trackRegistration(email) {
        // Track registration for analytics
        const registrations = JSON.parse(localStorage.getItem('registrations_track') || '[]');
        registrations.push({
            email: email,
            timestamp: new Date().toISOString(),
            source: window.location.href
        });
        localStorage.setItem('registrations_track', JSON.stringify(registrations.slice(-1000)));
    },

    // ==================== ENHANCED LOGIN ====================
    async handleLogin(e) {
        e.preventDefault();

        const formData = {
            email: document.getElementById('login-email').value.trim().toLowerCase(),
            password: document.getElementById('login-password').value
        };

        // Validation
        if (!formData.email || !formData.password) {
            this.showToast('Please enter both email and password', 'error');
            return;
        }

        this.showLoadingWithProgress('login-btn', 'Logging in...');

        try {
            console.log(' Login attempt for:', formData.email);
            
            // Step 1: Attempt login
            this.updateLoadingProgress('login-btn', 33, 'Authenticating...');
            
            const response = await this.apiRequest('/api/auth/login', {
                method: 'POST',
                body: formData
            });

            console.log(' Login response:', response);

            if (response.success && response.data && response.data.token) {
                // Step 2: Login successful
                this.updateLoadingProgress('login-btn', 66, 'Loading your data...');
                
                this.state.token = response.data.token;
                this.state.currentUser = response.data.user;
                this.state.isAdmin = this.state.currentUser.role === 'admin' || this.state.currentUser.role === 'super_admin';
                
                localStorage.setItem('raw_wealthy_token', response.data.token);
                localStorage.setItem('last_activity', Date.now());
                localStorage.setItem('cached_user', JSON.stringify(response.data.user));

                // Cache user data
                this.cacheUserData(response.data.user);

                // Step 3: Check for 2FA
                this.updateLoadingProgress('login-btn', 100, 'Finalizing...');

                if (this.state.currentUser.two_factor_enabled) {
                    this.showTwoFactorPrompt();
                } else {
                    this.showSuccessAnimation(' Login successful!', () => {
                        this.updateNavigation();
                        
                        setTimeout(() => {
                            if (this.state.isAdmin) {
                                this.showPage('admin');
                            } else {
                                this.showPage('dashboard');
                            }
                        }, 1000);
                    });
                }
            } else {
                this.showToast(response.message || 'Login failed', 'error');
                this.resetLoadingButton('login-btn');
            }
        } catch (error) {
            console.error(' Login error:', error);
            
            if (error.message.includes('Invalid credentials') || error.message.includes('401')) {
                this.showToast('Invalid email or password', 'error');
            } else if (error.message.includes('Network')) {
                this.showToast('Network error. Please check your connection.', 'error');
            } else {
                this.showToast('Login failed. Please try again.', 'error');
            }
            
            this.resetLoadingButton('login-btn');
        }
    },

    // ==================== ULTIMATE DASHBOARD SYSTEM ====================
    async updateDashboard() {
        if (!this.state.currentUser) {
            console.error(' No current user for dashboard');
            return;
        }

        try {
            console.log(' Updating dashboard with advanced data collection...');
            
            // Show loading animation
            this.showDashboardLoading(true);

            // Make parallel API calls for faster data loading
            const [profileResponse, investmentsResponse, transactionsResponse] = await Promise.all([
                this.apiRequest('/api/profile'),
                this.apiRequest('/api/investments?status=active&limit=10'),
                this.apiRequest('/api/transactions?limit=10')
            ]);

            console.log(' Dashboard data loaded:', {
                profile: profileResponse.success,
                investments: investmentsResponse.success,
                transactions: transactionsResponse.success
            });

            if (profileResponse.success && profileResponse.data) {
                const user = profileResponse.data.user;
                const stats = profileResponse.data.stats || {};

                // Calculate ALL financial metrics
                const financialData = this.calculateFinancialMetrics(user, stats);
                
                // Update dashboard with REAL data
                this.updateDashboardDisplay(financialData);
                
                // Update state with detailed stats
                this.state.userStats = financialData;

                // Cache the data for offline use
                this.cacheDashboardData({
                    user: user,
                    stats: stats,
                    financialData: financialData,
                    timestamp: new Date().toISOString()
                });

                // Create advanced charts
                this.createAdvancedCharts(stats);

                // Show data freshness indicator
                this.showDataFreshnessIndicator();
            }

            // Load investment data
            if (investmentsResponse.success && investmentsResponse.data) {
                this.updateInvestmentsDisplay(investmentsResponse.data.investments);
            }

            // Load transaction data
            if (transactionsResponse.success && transactionsResponse.data) {
                this.updateTransactionsDisplay(transactionsResponse.data.transactions);
            }

            // Calculate and show projected earnings
            await this.showProjectedEarnings();

            // Update notification badges
            this.updateNotificationBadges();

            console.log(' Dashboard updated with advanced metrics');
        } catch (error) {
            console.error(' Failed to update dashboard:', error);
            
            // Try to use cached data
            const cachedData = this.getCachedDashboardData();
            if (cachedData) {
                this.showToast(' Using cached data. Some features may be limited.', 'warning');
                this.updateDashboardDisplay(cachedData.financialData);
            } else {
                this.showToast('Error loading dashboard data', 'error');
            }
        } finally {
            this.showDashboardLoading(false);
        }
    },

    calculateFinancialMetrics(user, stats) {
        // Calculate comprehensive financial metrics
        const balance = user.balance || 0;
        const totalEarnings = user.total_earnings || 0;
        const referralEarnings = user.referral_earnings || 0;
        const totalDeposits = user.total_deposits || 0;
        const totalWithdrawals = user.total_withdrawals || 0;
        const totalInvestments = user.total_investments || 0;
        
        // Calculate portfolio value (multiple methods for accuracy)
        const portfolioValue = user.portfolio_value || 
                             (balance + totalEarnings + referralEarnings);
        
        // Calculate active investment value
        const activeInvestmentValue = stats.active_investment_value || 0;
        
        // Calculate daily earnings from active investments
        const dailyEarnings = stats.daily_interest || 0;
        
        // Calculate total returns percentage
        const totalReturns = totalInvestments > 0 ? 
                           ((totalEarnings + referralEarnings) / totalInvestments * 100) : 0;
        
        // Calculate net worth (portfolio + pending withdrawals)
        const netWorth = portfolioValue;
        
        // Calculate available for withdrawal (balance + earnings)
        const availableForWithdrawal = balance + totalEarnings + referralEarnings;
        
        // Calculate growth metrics
        const weeklyGrowth = this.calculateGrowthRate(stats.weekly_earnings || 0);
        const monthlyGrowth = this.calculateGrowthRate(stats.monthly_earnings || 0);

        return {
            balance: balance,
            totalEarnings: totalEarnings,
            referralEarnings: referralEarnings,
            portfolioValue: portfolioValue,
            totalDeposits: totalDeposits,
            totalWithdrawals: totalWithdrawals,
            totalInvestments: totalInvestments,
            activeInvestmentValue: activeInvestmentValue,
            dailyEarnings: dailyEarnings,
            totalReturns: totalReturns,
            netWorth: netWorth,
            availableForWithdrawal: availableForWithdrawal,
            weeklyGrowth: weeklyGrowth,
            monthlyGrowth: monthlyGrowth,
            lastUpdated: new Date().toISOString()
        };
    },

    calculateGrowthRate(currentEarnings) {
        // Simple growth calculation
        return currentEarnings > 0 ? '' : currentEarnings < 0 ? '' : '';
    },

    updateDashboardDisplay(financialData) {
        console.log(' Updating dashboard display with:', financialData);

        // Format all values with proper localization
        const formatCurrency = (value) => {
            if (value === undefined || value === null || isNaN(value)) return '0';
            return `${Math.round(value).toLocaleString()}`;
        };

        const formatPercentage = (value) => {
            if (value === undefined || value === null || isNaN(value)) return '0%';
            return `${value.toFixed(2)}%`;
        };

        // Update all dashboard elements with REAL data
        const updates = {
            // Main stats
            'total-balance': formatCurrency(financialData.balance),
            'active-investments': formatCurrency(financialData.activeInvestmentValue),
            'total-earnings': formatCurrency(financialData.totalEarnings),
            'referral-earnings': formatCurrency(financialData.referralEarnings),
            'portfolio-value': formatCurrency(financialData.portfolioValue),
            'daily-earnings': formatCurrency(financialData.dailyEarnings),
            
            // Additional stats (add these elements to your HTML)
            'total-deposits': formatCurrency(financialData.totalDeposits),
            'total-withdrawals': formatCurrency(financialData.totalWithdrawals),
            'total-invested': formatCurrency(financialData.totalInvestments),
            'returns-percentage': formatPercentage(financialData.totalReturns),
            'net-worth': formatCurrency(financialData.netWorth),
            'available-withdrawal': formatCurrency(financialData.availableForWithdrawal)
        };

        // Apply updates to DOM
        Object.entries(updates).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) {
                // Remove any placeholder text
                element.innerHTML = '';
                element.textContent = value;
                
                // Add animation for value changes
                if (element.dataset.previousValue && element.dataset.previousValue !== value) {
                    element.classList.add('value-updated');
                    setTimeout(() => element.classList.remove('value-updated'), 1000);
                }
                element.dataset.previousValue = value;
            }
        });

        // Update user info
        this.updateUserInfoDisplay();

        // Update growth indicators
        this.updateGrowthIndicators(financialData);
    },

    updateUserInfoDisplay() {
        if (!this.state.currentUser) return;

        const user = this.state.currentUser;
        
        // Update avatar with initials
        const avatar = document.getElementById('user-avatar');
        if (avatar) {
            const initials = user.full_name
                .split(' ')
                .map(n => n[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);
            avatar.textContent = initials;
            
            // Add status indicator based on KYC
            avatar.className = 'user-avatar';
            if (user.kyc_verified) {
                avatar.classList.add('kyc-verified');
                avatar.title = 'KYC Verified';
            }
        }

        // Update user name
        const userName = document.getElementById('user-name');
        if (userName) {
            userName.textContent = user.full_name;
        }

        // Update user tier/role
        const userTier = document.getElementById('user-tier');
        if (userTier) {
            if (user.role === 'admin' || user.role === 'super_admin') {
                userTier.textContent = ' Admin Investor';
                userTier.style.color = '#fbbf24';
            } else {
                userTier.textContent = ' Standard Investor';
                userTier.style.color = '#3b82f6';
            }
        }
    },

    updateGrowthIndicators(financialData) {
        // Update growth indicators in the UI
        const indicators = {
            'weekly-growth': financialData.weeklyGrowth,
            'monthly-growth': financialData.monthlyGrowth
        };

        Object.entries(indicators).forEach(([id, indicator]) => {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = indicator;
                
                // Add color coding
                if (indicator.includes('')) {
                    element.style.color = '#10b981';
                } else if (indicator.includes('')) {
                    element.style.color = '#ef4444';
                } else {
                    element.style.color = '#6b7280';
                }
            }
        });
    },

    async showProjectedEarnings() {
        try {
            // Get active investments
            const response = await this.apiRequest('/api/investments?status=active');
            
            if (response.success && response.data && response.data.investments) {
                const investments = response.data.investments;
                
                let totalProjected = 0;
                let projectedBreakdown = [];
                
                investments.forEach(inv => {
                    if (inv.plan && inv.plan.daily_interest && inv.end_date) {
                        const daysRemaining = Math.ceil((new Date(inv.end_date) - new Date()) / (1000 * 60 * 60 * 24));
                        if (daysRemaining > 0) {
                            const dailyEarning = (inv.amount * inv.plan.daily_interest) / 100;
                            const projectedEarnings = dailyEarning * daysRemaining;
                            totalProjected += projectedEarnings;
                            
                            projectedBreakdown.push({
                                plan: inv.plan.name,
                                daily: dailyEarning,
                                remainingDays: daysRemaining,
                                projected: projectedEarnings
                            });
                        }
                    }
                });
                
                // Update projected earnings display
                this.updateProjectedEarningsDisplay(totalProjected, projectedBreakdown);
            }
        } catch (error) {
            console.error('Error calculating projected earnings:', error);
        }
    },

    updateProjectedEarningsDisplay(totalProjected, breakdown) {
        const container = document.getElementById('projected-earnings');
        if (!container) return;

        if (totalProjected > 0) {
            container.innerHTML = `
                <div class="projected-earnings-card">
                    <div class="projected-header">
                        <i class="fas fa-chart-line"></i>
                        <h4>Projected Earnings</h4>
                    </div>
                    <div class="projected-total">
                        <span>Total Projected:</span>
                        <strong>${totalProjected.toLocaleString()}</strong>
                    </div>
                    ${breakdown.length > 0 ? `
                    <div class="projected-breakdown">
                        ${breakdown.map(item => `
                            <div class="breakdown-item">
                                <span>${item.plan} (${item.remainingDays} days):</span>
                                <span>${item.projected.toLocaleString()}</span>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                </div>
            `;
            container.style.display = 'block';
        } else {
            container.style.display = 'none';
        }
    },

    // ==================== ADVANCED INVESTMENT SYSTEM ====================
    async handleInvestment(e) {
        e.preventDefault();

        if (!this.state.currentUser) {
            this.showToast('Please login to make an investment', 'error');
            this.showPage('login');
            return;
        }

        const planId = document.getElementById('investment-plan').value;
        const amount = parseFloat(document.getElementById('investment-amount').value);
        const autoRenew = document.getElementById('auto-renew')?.checked || false;
        const proofFile = document.getElementById('investment-proof').files[0];

        // Find plan
        const plan = this.state.investmentPlans.find(p => p._id === planId);
        if (!plan) {
            this.showToast('Invalid investment plan selected', 'error');
            return;
        }

        // Advanced validation
        if (amount < (plan.min_amount || this.config.MIN_INVESTMENT)) {
            this.showToast(`Minimum investment for ${plan.name} is ${(plan.min_amount || this.config.MIN_INVESTMENT).toLocaleString()}`, 'error');
            return;
        }

        if (plan.max_amount && amount > plan.max_amount) {
            this.showToast(`Maximum investment for ${plan.name} is ${plan.max_amount.toLocaleString()}`, 'error');
            return;
        }

        // Get current balance
        const userResponse = await this.apiRequest('/api/profile');
        const userBalance = userResponse.success ? userResponse.data.user.balance : 0;
        
        if (amount > userBalance) {
            this.showToast('Insufficient balance for this investment', 'error');
            return;
        }

        if (!proofFile) {
            this.showToast('Please upload payment proof', 'error');
            return;
        }

        // File validation
        if (proofFile.size > 10 * 1024 * 1024) { // 10MB
            this.showToast('File size exceeds 10MB limit', 'error');
            return;
        }

        // Show investment confirmation with details
        const confirmed = await this.showInvestmentConfirmation(plan, amount, autoRenew);
        if (!confirmed) return;

        this.showLoadingWithProgress('invest-btn', 'Processing Investment...');

        try {
            // Step 1: Prepare investment data
            this.updateLoadingProgress('invest-btn', 25, 'Preparing investment...');
            
            const formData = new FormData();
            formData.append('plan_id', planId);
            formData.append('amount', amount);
            formData.append('auto_renew', autoRenew);
            formData.append('payment_proof', proofFile);

            // Step 2: Submit investment
            this.updateLoadingProgress('invest-btn', 50, 'Submitting investment request...');
            
            const response = await this.apiRequest('/api/investments', {
                method: 'POST',
                body: formData
            });

            console.log(' Investment response:', response);

            if (response.success) {
                // Step 3: Process referral bonus
                this.updateLoadingProgress('invest-btn', 75, 'Processing referral bonus...');
                
                // Auto-process referral bonus
                await this.processReferralBonus(this.state.currentUser._id, amount);
                
                // Step 4: Complete
                this.updateLoadingProgress('invest-btn', 100, 'Finalizing...');

                this.showSuccessAnimation(' Investment submitted successfully!', () => {
                    this.closeModal('invest-modal');
                    
                    // Clear form
                    e.target.reset();
                    const preview = document.getElementById('investment-preview');
                    if (preview) {
                        preview.style.display = 'none';
                        preview.src = '';
                    }

                    // Update dashboard and referral data
                    setTimeout(() => {
                        this.updateDashboard();
                        this.loadReferralData();
                    }, 2000);

                    // Track investment in analytics
                    this.trackInvestment(planId, amount, plan.name);
                });

            } else {
                this.showToast(response.message || 'Investment failed', 'error');
                this.resetLoadingButton('invest-btn');
            }
        } catch (error) {
            console.error(' Investment error:', error);
            
            if (error.message.includes('Network')) {
                this.showToast('Network error. Please check your connection.', 'error');
            } else {
                this.showToast('Error submitting investment: ' + error.message, 'error');
            }
            
            this.resetLoadingButton('invest-btn');
        }
    },

    async showInvestmentConfirmation(plan, amount, autoRenew) {
        return new Promise((resolve) => {
            // Calculate expected returns
            const dailyReturn = (amount * plan.daily_interest) / 100;
            const totalReturn = (amount * plan.total_interest) / 100;
            const netProfit = totalReturn - amount;
            
            const confirmationHTML = `
                <div class="investment-confirmation">
                    <div class="confirmation-header">
                        <i class="fas fa-check-circle"></i>
                        <h3>Confirm Investment</h3>
                    </div>
                    <div class="confirmation-body">
                        <div class="investment-summary">
                            <div class="summary-item">
                                <span>Plan:</span>
                                <strong>${plan.name}</strong>
                            </div>
                            <div class="summary-item">
                                <span>Amount:</span>
                                <strong>${amount.toLocaleString()}</strong>
                            </div>
                            <div class="summary-item">
                                <span>Daily Return:</span>
                                <strong>${plan.daily_interest}% (${dailyReturn.toLocaleString()})</strong>
                            </div>
                            <div class="summary-item">
                                <span>Duration:</span>
                                <strong>${plan.duration} days</strong>
                            </div>
                            <div class="summary-item">
                                <span>Total Return:</span>
                                <strong>${totalReturn.toLocaleString()}</strong>
                            </div>
                            <div class="summary-item">
                                <span>Net Profit:</span>
                                <strong class="profit">${netProfit.toLocaleString()}</strong>
                            </div>
                            ${autoRenew ? `
                            <div class="summary-item warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Auto-renew enabled</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    <div class="confirmation-footer">
                        <button class="btn btn-outline" id="confirm-cancel">Cancel</button>
                        <button class="btn btn-primary" id="confirm-invest">Confirm & Invest</button>
                    </div>
                </div>
            `;

            // Create modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'investment-confirm-modal';
            modal.innerHTML = confirmationHTML;
            document.body.appendChild(modal);

            // Show modal
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // Add event listeners
            document.getElementById('confirm-cancel').addEventListener('click', () => {
                document.body.removeChild(modal);
                resolve(false);
            });

            document.getElementById('confirm-invest').addEventListener('click', () => {
                document.body.removeChild(modal);
                resolve(true);
            });

            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                    resolve(false);
                }
            });
        });
    },

    trackInvestment(planId, amount, planName) {
        const investments = JSON.parse(localStorage.getItem('investment_history') || '[]');
        investments.push({
            planId: planId,
            planName: planName,
            amount: amount,
            timestamp: new Date().toISOString(),
            userId: this.state.currentUser?._id
        });
        localStorage.setItem('investment_history', JSON.stringify(investments.slice(-1000)));
    },

    // ==================== ADVANCED WITHDRAWAL SYSTEM ====================
    async handleWithdrawal(e) {
        e.preventDefault();

        if (!this.state.currentUser) {
            this.showToast('Please login to make a withdrawal', 'error');
            this.showPage('login');
            return;
        }

        const amount = parseFloat(document.getElementById('withdraw-amount').value);
        const paymentMethod = document.getElementById('withdraw-method').value;

        // Validation
        if (amount < this.config.MIN_WITHDRAWAL) {
            this.showToast(`Minimum withdrawal is ${this.config.MIN_WITHDRAWAL.toLocaleString()}`, 'error');
            return;
        }

        // Get current financial data
        const userResponse = await this.apiRequest('/api/profile');
        if (!userResponse.success) {
            this.showToast('Unable to verify account balance', 'error');
            return;
        }

        const user = userResponse.data.user;
        
        // Calculate total available (balance + earnings + referral earnings)
        const totalAvailable = (user.balance || 0) + 
                             (user.total_earnings || 0) + 
                             (user.referral_earnings || 0);
        
        if (amount > totalAvailable) {
            this.showToast(`Insufficient funds. Available: ${totalAvailable.toLocaleString()}`, 'error');
            return;
        }

        if (!paymentMethod) {
            this.showToast('Please select a withdrawal method', 'error');
            return;
        }

        // Check payment method requirements
        if (paymentMethod === 'bank_transfer') {
            if (!user.bank_details || !user.bank_details.account_number || user.bank_details.account_number.trim() === '') {
                this.showToast('Please update your bank details in profile settings', 'error');
                this.closeModal('withdraw-modal');
                this.showPage('profile');
                return;
            }
        }

        // Calculate fees and net amount
        const fee = amount * (this.config.PLATFORM_FEE_PERCENT / 100);
        const netAmount = amount - fee;

        // Show enhanced confirmation
        const confirmed = await this.showWithdrawalConfirmation(amount, fee, netAmount, paymentMethod);
        if (!confirmed) return;

        this.showLoadingWithProgress('withdraw-btn', 'Processing Withdrawal...');

        try {
            // Step 1: Prepare withdrawal
            this.updateLoadingProgress('withdraw-btn', 25, 'Preparing withdrawal...');
            
            const response = await this.apiRequest('/api/withdrawals', {
                method: 'POST',
                body: {
                    amount: amount,
                    payment_method: paymentMethod
                }
            });

            console.log(' Withdrawal response:', response);

            if (response.success) {
                // Step 2: Track withdrawal
                this.updateLoadingProgress('withdraw-btn', 75, 'Tracking transaction...');
                
                // Track in history
                this.trackWithdrawal(amount, fee, netAmount, paymentMethod);
                
                // Step 3: Complete
                this.updateLoadingProgress('withdraw-btn', 100, 'Finalizing...');

                this.showSuccessAnimation(' Withdrawal request submitted!', () => {
                    this.closeModal('withdraw-modal');
                    
                    // Clear form
                    e.target.reset();
                    
                    // Update user balance in state
                    if (this.state.currentUser) {
                        this.state.currentUser.balance -= amount;
                    }
                    
                    // Update dashboard after 2 seconds
                    setTimeout(() => {
                        this.updateDashboard();
                        this.loadUserTransactions(); // Refresh transaction history
                    }, 2000);

                    // Show admin notification (simulated)
                    this.showAdminNotification('withdrawal', amount, this.state.currentUser.email);
                });

            } else {
                this.showToast(response.message || 'Withdrawal failed', 'error');
                this.resetLoadingButton('withdraw-btn');
            }
        } catch (error) {
            console.error(' Withdrawal error:', error);
            this.showToast('Error processing withdrawal: ' + (error.message || 'Please try again'), 'error');
            this.resetLoadingButton('withdraw-btn');
        }
    },

    async showWithdrawalConfirmation(amount, fee, netAmount, paymentMethod) {
        return new Promise((resolve) => {
            const confirmationHTML = `
                <div class="withdrawal-confirmation">
                    <div class="confirmation-header">
                        <i class="fas fa-money-bill-wave"></i>
                        <h3>Confirm Withdrawal</h3>
                    </div>
                    <div class="confirmation-body">
                        <div class="withdrawal-details">
                            <div class="detail-item">
                                <span>Withdrawal Amount:</span>
                                <strong>${amount.toLocaleString()}</strong>
                            </div>
                            <div class="detail-item">
                                <span>Platform Fee (${this.config.PLATFORM_FEE_PERCENT}%):</span>
                                <strong class="fee">-${fee.toLocaleString()}</strong>
                            </div>
                            <div class="detail-item total">
                                <span>Amount You'll Receive:</span>
                                <strong class="net-amount">${netAmount.toLocaleString()}</strong>
                            </div>
                            <div class="detail-item">
                                <span>Payment Method:</span>
                                <strong>${paymentMethod.replace('_', ' ').toUpperCase()}</strong>
                            </div>
                            <div class="processing-time">
                                <i class="fas fa-clock"></i>
                                <span>Processing time: 24-48 hours</span>
                            </div>
                        </div>
                    </div>
                    <div class="confirmation-footer">
                        <button class="btn btn-outline" id="withdraw-cancel">Cancel</button>
                        <button class="btn btn-primary" id="withdraw-confirm">Confirm Withdrawal</button>
                    </div>
                </div>
            `;

            // Create modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'withdrawal-confirm-modal';
            modal.innerHTML = confirmationHTML;
            document.body.appendChild(modal);

            // Show modal
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // Add event listeners
            document.getElementById('withdraw-cancel').addEventListener('click', () => {
                document.body.removeChild(modal);
                resolve(false);
            });

            document.getElementById('withdraw-confirm').addEventListener('click', () => {
                document.body.removeChild(modal);
                resolve(true);
            });

            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                    resolve(false);
                }
            });
        });
    },

    trackWithdrawal(amount, fee, netAmount, paymentMethod) {
        const withdrawals = JSON.parse(localStorage.getItem('withdrawal_history') || '[]');
        withdrawals.push({
            amount: amount,
            fee: fee,
            netAmount: netAmount,
            paymentMethod: paymentMethod,
            timestamp: new Date().toISOString(),
            userId: this.state.currentUser?._id,
            status: 'pending'
        });
        localStorage.setItem('withdrawal_history', JSON.stringify(withdrawals.slice(-1000)));
    },

    showAdminNotification(type, amount, userEmail) {
        // This would typically send a notification to admin
        // For now, we'll just log it
        console.log(` Admin Notification: ${type.toUpperCase()} request from ${userEmail} for ${amount.toLocaleString()}`);
        
        // In a real app, you would:
        // 1. Send WebSocket notification to admin panel
        // 2. Send email to admin
        // 3. Add to admin notification queue
    },

    // ==================== ADVANCED REFERRAL SYSTEM ====================
    async loadReferralData() {
        if (!this.state.currentUser) return;

        try {
            console.log(' Loading advanced referral data...');
            
            const response = await this.apiRequest('/api/referrals/stats');
            
            if (response.success && response.data) {
                const stats = response.data.stats || {};
                const referrals = response.data.referrals || [];

                console.log(' Advanced referral stats:', stats);

                // Generate referral link
                const baseUrl = window.location.origin;
                const referralLink = `${baseUrl}/register?ref=${this.state.currentUser.referral_code || ''}`;
                
                // Update referral link and code
                const linkInput = document.getElementById('referral-link');
                const codeInput = document.getElementById('referral-code');
                
                if (linkInput) linkInput.value = referralLink;
                if (codeInput) codeInput.value = this.state.currentUser.referral_code || '';

                // Calculate detailed statistics
                const referralStats = this.calculateReferralStats(referrals);
                
                // Update UI with detailed stats
                this.updateReferralDisplay(referralStats, referrals);
                
                // Cache referral data
                this.cacheReferralData({
                    stats: referralStats,
                    referrals: referrals,
                    timestamp: new Date().toISOString()
                });

                console.log(' Advanced referral data loaded');
            } else {
                console.error(' Failed to load referral data:', response.message);
                
                // Try cached data
                const cachedData = this.getCachedReferralData();
                if (cachedData) {
                    this.showToast(' Using cached referral data', 'warning');
                    this.updateReferralDisplay(cachedData.stats, cachedData.referrals);
                } else {
                    this.showToast('Failed to load referral data', 'error');
                }
            }
        } catch (error) {
            console.error(' Failed to load referral data:', error);
            
            // Try cached data
            const cachedData = this.getCachedReferralData();
            if (cachedData) {
                this.showToast(' Using cached referral data', 'warning');
                this.updateReferralDisplay(cachedData.stats, cachedData.referrals);
            }
        }
    },

    calculateReferralStats(referrals) {
        const totalReferrals = referrals.length;
        const activeReferrals = referrals.filter(r => r.status === 'active').length;
        const pendingReferrals = referrals.filter(r => r.status === 'pending').length;
        const completedReferrals = referrals.filter(r => r.status === 'completed').length;
        
        const totalEarnings = referrals.reduce((sum, r) => sum + (r.earnings || 0), 0);
        const pendingEarnings = referrals
            .filter(r => r.status === 'active' && !r.earnings_paid)
            .reduce((sum, r) => sum + (r.earnings || 0), 0);
        
        const avgEarningsPerReferral = totalReferrals > 0 ? totalEarnings / totalReferrals : 0;
        
        // Calculate estimated future earnings
        const estimatedFutureEarnings = pendingEarnings * 1.5; // Simple projection
        
        return {
            totalReferrals: totalReferrals,
            activeReferrals: activeReferrals,
            pendingReferrals: pendingReferrals,
            completedReferrals: completedReferrals,
            totalEarnings: totalEarnings,
            pendingEarnings: pendingEarnings,
            avgEarningsPerReferral: avgEarningsPerReferral,
            estimatedFutureEarnings: estimatedFutureEarnings,
            commissionRate: this.config.REFERRAL_COMMISSION_PERCENT
        };
    },

    updateReferralDisplay(stats, referrals) {
        // Update stats display
        const statElements = {
            'total-referrals': stats.totalReferrals,
            'active-referrals': stats.activeReferrals,
            'total-referral-earnings': `${stats.totalEarnings.toLocaleString()}`,
            'pending-referral-earnings': `${stats.pendingEarnings.toLocaleString()}`,
            'estimated-future-earnings': `${stats.estimatedFutureEarnings.toLocaleString()}`,
            'avg-earnings-per-referral': `${Math.round(stats.avgEarningsPerReferral).toLocaleString()}`,
            'commission-rate': `${stats.commissionRate}%`
        };

        Object.entries(statElements).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        });

        // Update referral list
        this.updateReferralList(referrals);
        
        // Update referral progress
        this.updateReferralProgress(stats);
    },

    updateReferralProgress(stats) {
        const progressBar = document.getElementById('referral-progress');
        if (!progressBar) return;

        const progress = stats.totalReferrals > 0 ? 
                       (stats.activeReferrals / stats.totalReferrals) * 100 : 0;
        
        progressBar.innerHTML = `
            <div class="progress-container">
                <div class="progress-label">
                    <span>Referral Progress</span>
                    <span>${stats.activeReferrals}/${stats.totalReferrals} Active</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progress}%"></div>
                </div>
                <div class="progress-stats">
                    <div class="stat">
                        <span>Total Earnings</span>
                        <strong>${stats.totalEarnings.toLocaleString()}</strong>
                    </div>
                    <div class="stat">
                        <span>Pending</span>
                        <strong>${stats.pendingEarnings.toLocaleString()}</strong>
                    </div>
                </div>
            </div>
        `;
    },

    async processReferralBonus(userId, investmentAmount) {
        try {
            console.log(` Processing referral bonus for user: ${userId}, investment: ${investmentAmount.toLocaleString()}`);
            
            // The backend automatically processes referral bonuses
            // This function is for frontend tracking and UI updates
            
            // Check if user was referred
            const userResponse = await this.apiRequest(`/api/users/${userId}/referrer`);
            
            if (userResponse.success && userResponse.data.referred_by) {
                const referrerId = userResponse.data.referred_by;
                const commissionPercent = this.config.REFERRAL_COMMISSION_PERCENT;
                const bonusAmount = investmentAmount * (commissionPercent / 100);
                
                console.log(` Referral bonus calculated: ${bonusAmount.toLocaleString()} for referrer: ${referrerId}`);
                
                // Show notification to referrer if they're online
                // (In a real app, you would use WebSockets for real-time notifications)
                
                // Update local referral data
                this.updateLocalReferralBonus(referrerId, bonusAmount);
                
                // Show success message
                this.showToast(` You earned ${bonusAmount.toLocaleString()} referral bonus!`, 'success', 5000);
                
                // Refresh referral data
                setTimeout(() => {
                    this.loadReferralData();
                }, 3000);
            }
        } catch (error) {
            console.error(' Error processing referral bonus:', error);
        }
    },

    updateLocalReferralBonus(referrerId, bonusAmount) {
        // Update local referral cache
        const cachedData = this.getCachedReferralData();
        if (cachedData) {
            cachedData.stats.totalEarnings += bonusAmount;
            cachedData.stats.pendingEarnings += bonusAmount;
            this.cacheReferralData(cachedData);
        }
    },

    // ==================== TRANSACTION HISTORY SYSTEM ====================
    async loadUserTransactions() {
        try {
            console.log(' Loading transaction history...');
            
            const response = await this.apiRequest('/api/transactions?limit=20&sort=-createdAt');
            
            const container = document.getElementById('recent-transactions-list');
            if (!container) return;

            if (response.success && response.data && response.data.transactions) {
                const transactions = response.data.transactions;
                
                // Cache transactions
                this.cacheTransactions(transactions);
                
                // Update display
                this.updateTransactionsDisplay(transactions);
                
                // Update transaction summary
                this.updateTransactionSummary(transactions);
                
                // Check for new transactions since last update
                this.checkForNewTransactions(transactions);
            }
        } catch (error) {
            console.error(' Failed to load transactions:', error);
            
            // Try cached transactions
            const cachedTransactions = this.getCachedTransactions();
            if (cachedTransactions && cachedTransactions.length > 0) {
                this.showToast(' Using cached transaction data', 'warning');
                this.updateTransactionsDisplay(cachedTransactions);
            }
        }
    },

    updateTransactionsDisplay(transactions) {
        const container = document.getElementById('recent-transactions-list');
        if (!container) return;

        if (!transactions || transactions.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exchange-alt"></i>
                    <p>No transactions yet</p>
                    <p class="small">Your transaction history will appear here</p>
                </div>
            `;
            return;
        }

        // Group transactions by date
        const groupedTransactions = this.groupTransactionsByDate(transactions);
        
        // Generate HTML for grouped transactions
        let html = '';
        
        Object.entries(groupedTransactions).forEach(([date, dayTransactions]) => {
            html += `
                <div class="transaction-day">
                    <div class="day-header">
                        <span class="date">${this.formatTransactionDate(date)}</span>
                        <span class="day-total">${this.calculateDayTotal(dayTransactions).toLocaleString()}</span>
                    </div>
                    <div class="day-transactions">
                        ${dayTransactions.map(txn => this.createTransactionHTML(txn)).join('')}
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
        
        // Add click handlers for transaction details
        this.setupTransactionDetails();
    },

    groupTransactionsByDate(transactions) {
        const groups = {};
        
        transactions.forEach(txn => {
            const date = new Date(txn.createdAt).toISOString().split('T')[0];
            if (!groups[date]) {
                groups[date] = [];
            }
            groups[date].push(txn);
        });
        
        return groups;
    },

    formatTransactionDate(dateString) {
        const date = new Date(dateString);
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        
        if (date.toDateString() === today.toDateString()) {
            return 'Today';
        } else if (date.toDateString() === yesterday.toDateString()) {
            return 'Yesterday';
        } else {
            return date.toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric' 
            });
        }
    },

    calculateDayTotal(transactions) {
        return transactions.reduce((sum, txn) => sum + (txn.amount || 0), 0);
    },

    createTransactionHTML(transaction) {
        const type = transaction.type || 'transaction';
        const amount = transaction.amount || 0;
        const description = transaction.description || 'Transaction';
        const date = new Date(transaction.createdAt);
        const time = date.toLocaleTimeString('en-US', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        const isPositive = amount > 0;
        const icon = this.getTransactionIcon(type);
        const status = transaction.status || 'completed';
        
        return `
            <div class="transaction-item" data-id="${transaction._id}">
                <div class="transaction-icon ${type}">
                    <i class="fas fa-${icon}"></i>
                </div>
                <div class="transaction-details">
                    <div class="transaction-description">${description}</div>
                    <div class="transaction-meta">
                        <span class="time">${time}</span>
                        <span class="status status-${status}">${status}</span>
                    </div>
                </div>
                <div class="transaction-amount ${isPositive ? 'positive' : 'negative'}">
                    ${isPositive ? '+' : ''}${Math.abs(amount).toLocaleString()}
                </div>
            </div>
        `;
    },

    updateTransactionSummary(transactions) {
        // Calculate summary statistics
        const summary = {
            totalIncome: transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0),
            totalExpenses: Math.abs(transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0)),
            netFlow: transactions.reduce((sum, t) => sum + t.amount, 0),
            transactionCount: transactions.length
        };

        // Update summary display
        const summaryElement = document.getElementById('transaction-summary');
        if (summaryElement) {
            summaryElement.innerHTML = `
                <div class="summary-grid">
                    <div class="summary-item">
                        <span>Total Income</span>
                        <strong class="positive">${summary.totalIncome.toLocaleString()}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Total Expenses</span>
                        <strong class="negative">${summary.totalExpenses.toLocaleString()}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Net Flow</span>
                        <strong class="${summary.netFlow >= 0 ? 'positive' : 'negative'}">
                            ${summary.netFlow >= 0 ? '+' : ''}${Math.abs(summary.netFlow).toLocaleString()}
                        </strong>
                    </div>
                    <div class="summary-item">
                        <span>Total Transactions</span>
                        <strong>${summary.transactionCount}</strong>
                    </div>
                </div>
            `;
        }
    },

    checkForNewTransactions(transactions) {
        // Get last seen transaction ID
        const lastSeenId = localStorage.getItem('last_transaction_id');
        
        if (transactions.length > 0) {
            const latestId = transactions[0]._id;
            
            if (lastSeenId && latestId !== lastSeenId) {
                // New transactions detected
                this.showNewTransactionsNotification(transactions.length);
            }
            
            // Update last seen ID
            localStorage.setItem('last_transaction_id', latestId);
        }
    },

    showNewTransactionsNotification(count) {
        const notification = document.createElement('div');
        notification.className = 'new-transactions-notification';
        notification.innerHTML = `
            <i class="fas fa-bell"></i>
            <span>${count} new transaction${count > 1 ? 's' : ''} detected</span>
            <button class="close-btn">&times;</button>
        `;
        
        notification.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            animation: slideInRight 0.3s ease;
        `;
        
        document.body.appendChild(notification);
        
        // Close button
        notification.querySelector('.close-btn').addEventListener('click', () => {
            notification.remove();
        });
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    },

    // ==================== ADVANCED UI COMPONENTS ====================
    showLoadingWithProgress(buttonId, text) {
        const button = document.getElementById(buttonId);
        if (!button) return;

        button.innerHTML = `
            <div class="btn-loading-progress">
                <div class="spinner"></div>
                <span class="loading-text">${text}</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 0%"></div>
                </div>
            </div>
        `;
        button.disabled = true;
    },

    updateLoadingProgress(buttonId, percent, text) {
        const button = document.getElementById(buttonId);
        if (!button) return;

        const progressBar = button.querySelector('.progress');
        const loadingText = button.querySelector('.loading-text');
        
        if (progressBar) {
            progressBar.style.width = `${percent}%`;
        }
        
        if (loadingText && text) {
            loadingText.textContent = text;
        }
    },

    resetLoadingButton(buttonId) {
        const button = document.getElementById(buttonId);
        if (!button) return;

        button.innerHTML = `
            <span class="btn-text">${button.dataset.originalText || 'Submit'}</span>
            <div class="btn-loading" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i>
            </div>
        `;
        button.disabled = false;
    },

    showSuccessAnimation(message, callback) {
        // Create success animation overlay
        const overlay = document.createElement('div');
        overlay.className = 'success-animation-overlay';
        overlay.innerHTML = `
            <div class="success-animation">
                <div class="checkmark">
                    <svg class="checkmark-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                </div>
                <div class="success-message">${message}</div>
            </div>
        `;
        
        document.body.appendChild(overlay);
        
        // Add styles
        const style = document.createElement('style');
        style.textContent = `
            .success-animation-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(15, 23, 42, 0.95);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            }
            .success-animation {
                text-align: center;
                padding: 2rem;
            }
            .checkmark {
                width: 80px;
                height: 80px;
                margin: 0 auto 1.5rem;
            }
            .checkmark-circle {
                stroke: #10b981;
                stroke-width: 2;
                animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
                fill: none;
            }
            .checkmark-check {
                transform-origin: 50% 50%;
                stroke: #10b981;
                stroke-width: 2;
                stroke-dasharray: 48;
                stroke-dashoffset: 48;
                animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
            }
            .success-message {
                color: white;
                font-size: 1.25rem;
                font-weight: 600;
                animation: fadeInUp 0.5s ease 1s forwards;
                opacity: 0;
            }
            @keyframes stroke {
                100% { stroke-dashoffset: 0; }
            }
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);
        
        // Remove after animation completes
        setTimeout(() => {
            overlay.remove();
            style.remove();
            if (callback) callback();
        }, 2000);
    },

    showSubtleNotification(message, type, duration = 3000) {
        const notification = document.createElement('div');
        notification.className = `subtle-notification ${type}`;
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 6px;
            background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
            color: white;
            font-size: 0.875rem;
            z-index: 9998;
            animation: slideInUp 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        `;
        
        document.body.appendChild(notification);
        
        // Auto-remove
        setTimeout(() => {
            notification.style.animation = 'slideOutDown 0.3s ease';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 300);
        }, duration);
    },

    showDashboardLoading(show) {
        const loading = document.getElementById('dashboard-loading');
        if (!loading) {
            // Create loading indicator
            const loader = document.createElement('div');
            loader.id = 'dashboard-loading';
            loader.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(15, 23, 42, 0.8);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 100;
                backdrop-filter: blur(4px);
            `;
            loader.innerHTML = `
                <div class="spinner-container">
                    <div class="spinner"></div>
                    <p>Updating dashboard data...</p>
                </div>
            `;
            
            const dashboard = document.querySelector('.dashboard-container');
            if (dashboard) {
                dashboard.style.position = 'relative';
                dashboard.appendChild(loader);
            }
        }
        
        const loader = document.getElementById('dashboard-loading');
        if (loader) {
            loader.style.display = show ? 'flex' : 'none';
        }
    },

    showDataFreshnessIndicator() {
        const indicator = document.getElementById('data-freshness');
        if (!indicator) return;

        const now = new Date();
        const options = { 
            hour: '2-digit', 
            minute: '2-digit',
            second: '2-digit'
        };
        const timeString = now.toLocaleTimeString('en-US', options);
        
        indicator.innerHTML = `
            <div class="freshness-indicator">
                <i class="fas fa-sync-alt"></i>
                <span>Updated: ${timeString}</span>
                <button class="refresh-btn" onclick="app.updateDashboard()">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
        `;
    },

    // ==================== CACHING SYSTEM ====================
    cacheUserData(user) {
        localStorage.setItem('cached_user', JSON.stringify(user));
        localStorage.setItem('user_cache_timestamp', Date.now());
    },

    cacheDashboardData(data) {
        localStorage.setItem('cached_dashboard', JSON.stringify(data));
        localStorage.setItem('dashboard_cache_timestamp', Date.now());
    },

    cacheReferralData(data) {
        localStorage.setItem('cached_referrals', JSON.stringify(data));
        localStorage.setItem('referrals_cache_timestamp', Date.now());
    },

    cacheTransactions(transactions) {
        localStorage.setItem('cached_transactions', JSON.stringify(transactions));
        localStorage.setItem('transactions_cache_timestamp', Date.now());
    },

    getCachedDashboardData() {
        const cached = localStorage.getItem('cached_dashboard');
        const timestamp = localStorage.getItem('dashboard_cache_timestamp');
        
        if (cached && timestamp) {
            const age = Date.now() - parseInt(timestamp);
            // Return cache if less than 1 hour old
            if (age < 60 * 60 * 1000) {
                return JSON.parse(cached);
            }
        }
        return null;
    },

    getCachedReferralData() {
        const cached = localStorage.getItem('cached_referrals');
        const timestamp = localStorage.getItem('referrals_cache_timestamp');
        
        if (cached && timestamp) {
            const age = Date.now() - parseInt(timestamp);
            if (age < 60 * 60 * 1000) {
                return JSON.parse(cached);
            }
        }
        return null;
    },

    getCachedTransactions() {
        const cached = localStorage.getItem('cached_transactions');
        const timestamp = localStorage.getItem('transactions_cache_timestamp');
        
        if (cached && timestamp) {
            const age = Date.now() - parseInt(timestamp);
            if (age < 60 * 60 * 1000) {
                return JSON.parse(cached);
            }
        }
        return null;
    },

    // ==================== SYNC SYSTEM ====================
    async syncPendingData() {
        // Check for pending operations that need to be synced
        const pendingOperations = JSON.parse(localStorage.getItem('pending_operations') || '[]');
        
        if (pendingOperations.length > 0) {
            console.log(` Syncing ${pendingOperations.length} pending operations...`);
            
            for (const operation of pendingOperations) {
                try {
                    await this.syncOperation(operation);
                } catch (error) {
                    console.error('Failed to sync operation:', operation, error);
                }
            }
            
            // Clear successfully synced operations
            const failedOperations = pendingOperations.filter(op => !op.synced);
            localStorage.setItem('pending_operations', JSON.stringify(failedOperations));
            
            if (failedOperations.length === 0) {
                this.showToast(' All pending data synced successfully!', 'success');
            }
        }
    },

    async syncOperation(operation) {
        // Implement specific sync logic for each operation type
        switch(operation.type) {
            case 'investment':
                // Sync investment
                break;
            case 'withdrawal':
                // Sync withdrawal
                break;
            case 'deposit':
                // Sync deposit
                break;
        }
        
        operation.synced = true;
    },

    // ==================== UTILITY FUNCTIONS ====================
    getCurrentPage() {
        const pages = ['home', 'dashboard', 'investments', 'profile', 'referrals', 'support', 'admin'];
        for (const page of pages) {
            const element = document.getElementById(`${page}-page`);
            if (element && element.style.display !== 'none') {
                return page;
            }
        }
        return 'home';
    },

    getTransactionIcon(type) {
        const icons = {
            'deposit': 'arrow-down',
            'withdrawal': 'arrow-up',
            'investment': 'chart-line',
            'earning': 'money-bill-wave',
            'referral': 'user-friends',
            'bonus': 'gift',
            'fee': 'credit-card',
            'refund': 'undo'
        };
        return icons[type] || 'exchange-alt';
    },

    setupTransactionDetails() {
        document.querySelectorAll('.transaction-item').forEach(item => {
            item.addEventListener('click', (e) => {
                if (!e.target.closest('.transaction-details')) return;
                
                const transactionId = item.dataset.id;
                this.showTransactionDetails(transactionId);
            });
        });
    },

    async showTransactionDetails(transactionId) {
        try {
            const response = await this.apiRequest(`/api/transactions/${transactionId}`);
            
            if (response.success && response.data) {
                const txn = response.data;
                this.showTransactionModal(txn);
            }
        } catch (error) {
            console.error('Failed to load transaction details:', error);
        }
    },

    showTransactionModal(transaction) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.id = 'transaction-details-modal';
        
        const date = new Date(transaction.createdAt);
        const formattedDate = date.toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Transaction Details</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="transaction-details-modal">
                    <div class="transaction-header">
                        <div class="transaction-type ${transaction.type}">
                            <i class="fas fa-${this.getTransactionIcon(transaction.type)}"></i>
                            <span>${transaction.type.toUpperCase()}</span>
                        </div>
                        <div class="transaction-amount ${transaction.amount >= 0 ? 'positive' : 'negative'}">
                            ${transaction.amount >= 0 ? '+' : ''}${Math.abs(transaction.amount).toLocaleString()}
                        </div>
                    </div>
                    
                    <div class="transaction-info">
                        <div class="info-row">
                            <span>Description:</span>
                            <span>${transaction.description}</span>
                        </div>
                        <div class="info-row">
                            <span>Date & Time:</span>
                            <span>${formattedDate}</span>
                        </div>
                        <div class="info-row">
                            <span>Reference:</span>
                            <span class="reference">${transaction.reference || 'N/A'}</span>
                        </div>
                        <div class="info-row">
                            <span>Status:</span>
                            <span class="status status-${transaction.status}">${transaction.status}</span>
                        </div>
                        ${transaction.balance_before !== undefined ? `
                        <div class="info-row">
                            <span>Balance Before:</span>
                            <span>${transaction.balance_before.toLocaleString()}</span>
                        </div>
                        ` : ''}
                        ${transaction.balance_after !== undefined ? `
                        <div class="info-row">
                            <span>Balance After:</span>
                            <span>${transaction.balance_after.toLocaleString()}</span>
                        </div>
                        ` : ''}
                    </div>
                    
                    ${transaction.metadata ? `
                    <div class="transaction-metadata">
                        <h4>Additional Information</h4>
                        <pre>${JSON.stringify(transaction.metadata, null, 2)}</pre>
                    </div>
                    ` : ''}
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        this.openModal('transaction-details-modal');
        
        // Add close handler
        modal.querySelector('.close-modal').addEventListener('click', () => {
            this.closeModal('transaction-details-modal');
        });
    },

    // ==================== ENHANCED API REQUEST ====================
    async apiRequest(endpoint, options = {}) {
        const url = `${this.config.API_BASE_URL}${endpoint}`;
        
        const headers = {
            'Content-Type': 'application/json',
            ...options.headers
        };

        if (this.state.token) {
            headers['Authorization'] = `Bearer ${this.state.token}`;
        }

        const config = {
            method: options.method || 'GET',
            headers: headers,
            credentials: 'include',
            ...options
        };

        if (options.body instanceof FormData) {
            delete config.headers['Content-Type'];
            config.body = options.body;
        } else if (options.body && typeof options.body === 'object') {
            config.body = JSON.stringify(options.body);
        }

        try {
            // Show loading for non-background requests
            if (!options.background) {
                this.showLoadingSpinner(true);
            }
            
            console.log(` API Request: ${config.method} ${url}`);
            
            const startTime = Date.now();
            const response = await fetch(url, config);
            const endTime = Date.now();
            
            console.log(` API Response time: ${endTime - startTime}ms`);
            
            // Handle specific status codes
            if (response.status === 401) {
                this.handleTokenExpired();
                throw new Error('Authentication required');
            }

            if (response.status === 403) {
                throw new Error('Access denied');
            }

            if (response.status === 429) {
                throw new Error('Too many requests. Please try again later.');
            }

            const data = await response.json().catch(() => ({}));

            if (!response.ok) {
                const errorMessage = data.message || data.error || `HTTP ${response.status}`;
                throw new Error(errorMessage);
            }

            console.log(` API Response: ${endpoint}`, data);
            return data;
        } catch (error) {
            console.error(` API Request Error [${endpoint}]:`, error);
            
            // Store pending operations for offline sync
            if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                this.storePendingOperation(endpoint, options, error);
                
                if (!options.background) {
                    this.showToast(' Network error. Operation queued for sync.', 'warning');
                }
            } else if (error.message.includes('401') || error.message.includes('token')) {
                // Already handled in handleTokenExpired
            } else {
                if (!options.background) {
                    this.showToast(error.message || 'An error occurred', 'error');
                }
            }
            
            throw error;
        } finally {
            if (!options.background) {
                this.showLoadingSpinner(false);
            }
        }
    },

    storePendingOperation(endpoint, options, error) {
        const pendingOperations = JSON.parse(localStorage.getItem('pending_operations') || '[]');
        
        pendingOperations.push({
            endpoint: endpoint,
            options: options,
            error: error.message,
            timestamp: new Date().toISOString(),
            synced: false
        });
        
        localStorage.setItem('pending_operations', JSON.stringify(pendingOperations.slice(-50))); // Keep last 50
    },

    handleTokenExpired() {
        console.log(' Token expired or invalid');
        
        // Clear session data
        this.clearSessionData();
        
        // Show notification
        this.showToast('Your session has expired. Please login again.', 'warning');
        
        // Redirect to login after delay
        setTimeout(() => {
            this.showPage('login');
        }, 3000);
    },

    // ==================== EVENT LISTENERS SETUP ====================
    setupEventListeners() {
        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => this.toggleTheme());
        }

        // Mobile menu
        const hamburger = document.getElementById('hamburger');
        if (hamburger) {
            hamburger.addEventListener('click', () => this.openMobileMenu());
        }

        const closeMobileMenu = document.getElementById('close-mobile-menu');
        if (closeMobileMenu) {
            closeMobileMenu.addEventListener('click', () => this.closeMobileMenu());
        }

        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
        if (mobileMenuOverlay) {
            mobileMenuOverlay.addEventListener('click', () => this.closeMobileMenu());
        }

        // Back to top
        const backToTop = document.getElementById('back-to-top');
        if (backToTop) {
            backToTop.addEventListener('click', () => this.scrollToTop());
        }

        // Form submissions
        this.setupFormListeners();

        // Password toggles
        this.initPasswordToggles();

        // File upload previews
        this.initFileUploadPreviews();

        // Scroll events
        window.addEventListener('scroll', () => this.handleScroll());

        // Withdrawal amount changes
        const withdrawAmount = document.getElementById('withdraw-amount');
        if (withdrawAmount) {
            withdrawAmount.addEventListener('input', () => this.updateWithdrawalFee());
        }

        // Global error handling
        window.addEventListener('error', (e) => this.handleGlobalError(e));
        window.addEventListener('unhandledrejection', (e) => this.handlePromiseRejection(e));

        // Page visibility
        document.addEventListener('visibilitychange', () => this.handleVisibilityChange());
    },

    setupFormListeners() {
        const forms = {
            'registration-form': (e) => this.handleRegistration(e),
            'login-form': (e) => this.handleLogin(e),
            'invest-form': (e) => this.handleInvestment(e),
            'deposit-form': (e) => this.handleDeposit(e),
            'withdraw-form': (e) => this.handleWithdrawal(e),
            'personal-form': (e) => this.handleProfileUpdate(e),
            'bank-form': (e) => this.handleBankUpdate(e),
            'kyc-form': (e) => this.handleKYCSubmission(e),
            'support-form': (e) => this.handleSupportRequest(e),
            'password-reset-form': (e) => this.handlePasswordReset(e),
            'password-change-form': (e) => this.handlePasswordChange(e),
            'preferences-form': (e) => this.handlePreferencesUpdate(e)
        };

        Object.entries(forms).forEach(([formId, handler]) => {
            const form = document.getElementById(formId);
            if (form) {
                // Store original button text
                const submitBtn = form.querySelector('button[type="submit"]');
                if (submitBtn) {
                    const btnText = submitBtn.querySelector('.btn-text');
                    if (btnText) {
                        submitBtn.dataset.originalText = btnText.textContent;
                    }
                }
                
                form.addEventListener('submit', handler);
            }
        });
    },

    initPasswordToggles() {
        document.querySelectorAll('.password-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const input = this.previousElementSibling;
                const icon = this.querySelector('i');

                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        });
    },

    initFileUploadPreviews() {
        const fileInputs = [
            { input: 'investment-proof', preview: 'investment-preview' },
            { input: 'deposit-proof', preview: 'deposit-preview' },
            { input: 'id-front', preview: 'id-front-preview' },
            { input: 'id-back', preview: 'id-back-preview' },
            { input: 'selfie-with-id', preview: 'selfie-with-id-preview' }
        ];

        fileInputs.forEach(({ input, preview }) => {
            const inputElement = document.getElementById(input);
            const previewElement = document.getElementById(preview);

            if (inputElement && previewElement) {
                inputElement.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 10 * 1024 * 1024) {
                            this.showToast('File size exceeds 10MB limit', 'error');
                            e.target.value = '';
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = (e) => {
                            previewElement.src = e.target.result;
                            previewElement.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        });
    },

    handleScroll() {
        const navbar = document.querySelector('.navbar');
        const backToTop = document.getElementById('back-to-top');

        if (navbar && window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else if (navbar) {
            navbar.classList.remove('scrolled');
        }

        if (backToTop && window.scrollY > 300) {
            backToTop.classList.add('visible');
        } else if (backToTop) {
            backToTop.classList.remove('visible');
        }
    },

    scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    },

    handleVisibilityChange() {
        if (!document.hidden && this.state.isAuthenticated) {
            // Page became visible, refresh data
            console.log(' Page became visible, refreshing data...');
            this.backgroundDataRefresh();
        }
    },

    handleGlobalError(event) {
        console.error('Global error:', event.error);
        // Log to error tracking service
        this.logError(event.error);
    },

    handlePromiseRejection(event) {
        console.error('Unhandled promise rejection:', event.reason);
        // Log to error tracking service
        this.logError(event.reason);
    },

    logError(error) {
        // Store errors for debugging
        const errors = JSON.parse(localStorage.getItem('error_logs') || '[]');
        errors.push({
            message: error.message,
            stack: error.stack,
            timestamp: new Date().toISOString(),
            url: window.location.href,
            user: this.state.currentUser?.email
        });
        localStorage.setItem('error_logs', JSON.stringify(errors.slice(-100))); // Keep last 100 errors
    },

    // ==================== PAGE MANAGEMENT ====================
    showPage(page) {
        // Track page view
        this.trackPageView(page);
        
        const pages = [
            'home-page', 'registration-page', 'login-page', 'dashboard-page',
            'investment-plans-page', 'profile-page', 'referral-page',
            'support-page', 'admin-page'
        ];

        pages.forEach(pageId => {
            const element = document.getElementById(pageId);
            if (element) element.style.display = 'none';
        });

        const pageMap = {
            'home': 'home-page',
            'register': 'registration-page',
            'login': 'login-page',
            'dashboard': 'dashboard-page',
            'investment-plans': 'investment-plans-page',
            'profile': 'profile-page',
            'referral': 'referral-page',
            'support': 'support-page',
            'admin': 'admin-page'
        };

        const pageId = pageMap[page];
        if (pageId) {
            const element = document.getElementById(pageId);
            if (element) {
                element.style.display = page === 'home' ? 'block' : 'flex';
                
                // Trigger animation
                element.classList.add('page-enter');
                setTimeout(() => {
                    element.classList.remove('page-enter');
                }, 300);
            }
        }

        // Page-specific initialization
        switch(page) {
            case 'dashboard':
                setTimeout(() => this.updateDashboard(), 100);
                break;
            case 'investment-plans':
                setTimeout(() => this.loadInvestmentPlans(), 100);
                break;
            case 'profile':
                setTimeout(() => this.loadProfileData(), 100);
                break;
            case 'referral':
                setTimeout(() => this.loadReferralData(), 100);
                break;
            case 'admin':
                setTimeout(() => this.loadAdminData(), 100);
                break;
        }

        this.closeMobileMenu();
        window.scrollTo(0, 0);
        this.updateNavigation();
    },

    trackPageView(page) {
        if (this.state.activityTracker.pageViews[page]) {
            this.state.activityTracker.pageViews[page]++;
        } else {
            this.state.activityTracker.pageViews[page] = 1;
        }
        
        // Store in analytics
        const pageViews = JSON.parse(localStorage.getItem('page_views') || '[]');
        pageViews.push({
            page: page,
            timestamp: new Date().toISOString(),
            user: this.state.currentUser?.email
        });
        localStorage.setItem('page_views', JSON.stringify(pageViews.slice(-1000)));
    },

    updateNavigation() {
        const navButtons = document.querySelector('.nav-buttons');
        if (!navButtons) return;

        if (this.state.isAuthenticated) {
            navButtons.innerHTML = `
                <button class="theme-toggle" id="theme-toggle">
                    <i class="fas ${document.body.classList.contains('light-mode') ? 'fa-sun' : 'fa-moon'}"></i>
                </button>
                <button class="btn btn-outline" onclick="app.showPage('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="btn btn-primary" onclick="app.logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            `;
        } else {
            navButtons.innerHTML = `
                <button class="theme-toggle" id="theme-toggle">
                    <i class="fas ${document.body.classList.contains('light-mode') ? 'fa-sun' : 'fa-moon'}"></i>
                </button>
                <button class="btn btn-outline" onclick="app.showPage('login')">Login</button>
                <button class="btn btn-primary" onclick="app.showPage('register')">Register</button>
            `;
        }

        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => this.toggleTheme());
        }
    },

    logout() {
        console.log(' Logging out...');
        
        // Clear all data
        this.clearSessionData();
        
        // Show logout notification
        this.showToast('You have been logged out successfully.', 'info');
        
        // Redirect to home
        setTimeout(() => {
            this.showPage('home');
        }, 1500);
    },

    // ==================== LOADING SPINNER ====================
    showLoadingSpinner(show) {
        const spinner = document.getElementById('loading-spinner');
        if (spinner) {
            spinner.style.display = show ? 'flex' : 'none';
        }
    },

    // ==================== TOAST NOTIFICATIONS ====================
    showToast(message, type = 'info', duration = 5000) {
        const container = document.getElementById('toast-container');
        if (!container) return;

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        else if (type === 'error') icon = 'exclamation-circle';
        else if (type === 'warning') icon = 'exclamation-triangle';

        // Check if message is HTML
        if (message.startsWith('<')) {
            toast.innerHTML = message;
        } else {
            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
        }

        container.appendChild(toast);

        // Remove toast after duration
        setTimeout(() => {
            if (toast.parentNode === container) {
                toast.style.animation = 'slideOutUp 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode === container) {
                        container.removeChild(toast);
                    }
                }, 300);
            }
        }, duration);
    },

    // ==================== THEME MANAGEMENT ====================
    toggleTheme() {
        const body = document.body;
        const icon = document.querySelector('#theme-toggle i');

        if (body.classList.contains('light-mode')) {
            body.classList.remove('light-mode');
            icon.classList.remove('fa-sun');
            icon.classList.add('fa-moon');
            localStorage.setItem('theme', 'dark');
        } else {
            body.classList.add('light-mode');
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
            localStorage.setItem('theme', 'light');
        }
    },

    initTheme() {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
            const themeIcon = document.querySelector('#theme-toggle i');
            if (themeIcon) {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
        }
    },

    // ==================== MOBILE MENU ====================
    openMobileMenu() {
        const mobileMenu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('mobile-menu-overlay');
        
        if (mobileMenu) mobileMenu.classList.add('active');
        if (overlay) overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
    },

    closeMobileMenu() {
        const mobileMenu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('mobile-menu-overlay');
        
        if (mobileMenu) mobileMenu.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
    },

    // ==================== MODAL MANAGEMENT ====================
    openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // Modal-specific setup
            switch(modalId) {
                case 'withdraw-modal':
                    if (this.state.currentUser) {
                        this.updateWithdrawalModal();
                    }
                    break;

                case 'invest-modal':
                    this.loadInvestmentPlansForModal();
                    break;

                case 'deposit-modal':
                    this.showDepositInstructions();
                    break;
            }
        }
    },

    updateWithdrawalModal() {
        const balanceElement = document.getElementById('available-balance');
        if (balanceElement) {
            // Calculate total available (balance + earnings)
            const totalAvailable = (this.state.userStats.balance || 0) + 
                                 (this.state.userStats.totalEarnings || 0) + 
                                 (this.state.userStats.referralEarnings || 0);
            
            balanceElement.textContent = `${totalAvailable.toLocaleString()}`;
        }
        
        this.updateWithdrawalFee();
    },

    updateWithdrawalFee() {
        const amountInput = document.getElementById('withdraw-amount');
        const feeNotice = document.getElementById('withdrawal-fee-notice');
        
        if (!amountInput || !feeNotice) return;

        const amount = parseFloat(amountInput.value) || 0;
        const fee = amount * (this.config.PLATFORM_FEE_PERCENT / 100);
        const netAmount = amount - fee;

        if (amount > 0) {
            feeNotice.innerHTML = `
                <i class="fas fa-info-circle"></i>
                <span>
                    Platform Fee (${this.config.PLATFORM_FEE_PERCENT}%): <strong>${fee.toLocaleString()}</strong><br>
                    Net Amount You'll Receive: <strong>${netAmount.toLocaleString()}</strong>
                </span>
            `;
            feeNotice.style.display = 'block';
        } else {
            feeNotice.style.display = 'none';
        }
    },

    showDepositInstructions() {
        const form = document.getElementById('deposit-form');
        if (form) {
            // Remove existing instructions if any
            const existingInstructions = document.querySelector('.bank-instructions');
            if (existingInstructions) {
                existingInstructions.remove();
            }

            const instructionsHTML = `
                <div class="bank-instructions">
                    <h3><i class="fas fa-bank"></i> Bank Transfer Instructions</h3>
                    <div class="bank-details">
                        <div class="detail">
                            <span>Bank Name:</span>
                            <strong>OPay</strong>
                        </div>
                        <div class="detail">
                            <span>Account Number:</span>
                            <strong>7072859483</strong>
                        </div>
                        <div class="detail">
                            <span>Account Name:</span>
                            <strong>JOSEPH INALEGWU ISRAEL</strong>
                        </div>
                    </div>
                    <div class="instructions">
                        <p><i class="fas fa-info-circle"></i> Transfer the exact amount to the account above</p>
                        <p><i class="fas fa-info-circle"></i> Use your registered name as transfer reference</p>
                        <p><i class="fas fa-info-circle"></i> Upload payment proof screenshot after transfer</p>
                    </div>
                </div>
            `;
            form.insertAdjacentHTML('afterbegin', instructionsHTML);
        }
    },

    closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';

            const form = modal.querySelector('form');
            if (form) form.reset();

            const previews = modal.querySelectorAll('.file-preview');
            previews.forEach(preview => {
                preview.style.display = 'none';
                preview.src = '';
            });

            const fileInputs = modal.querySelectorAll('input[type="file"]');
            fileInputs.forEach(input => input.value = '');
        }
    },

    loadInvestmentPlansForModal() {
        const select = document.getElementById('investment-plan');
        if (!select) return;

        select.innerHTML = '<option value="">Choose a raw material</option>' +
            this.state.investmentPlans.map(plan => `
                <option value="${plan._id}">
                    ${plan.name} - Min: ${(plan.min_amount || 0).toLocaleString()} | Daily: ${plan.daily_interest}%
                </option>
            `).join('');
    },

    openInvestmentModal(planId) {
        const plan = this.state.investmentPlans.find(p => p._id === planId);
        if (!plan) return;

        const modalId = 'invest-modal';
        const modal = document.getElementById(modalId);
        if (!modal) return;

        // Set plan selection
        const planSelect = document.getElementById('investment-plan');
        if (planSelect) {
            planSelect.value = planId;
        }

        // Set minimum amount
        const amountInput = document.getElementById('investment-amount');
        if (amountInput) {
            amountInput.min = plan.min_amount;
            amountInput.placeholder = `Minimum: ${plan.min_amount.toLocaleString()}`;
        }

        // Open modal
        this.openModal(modalId);
    },

    // ==================== INITIAL DATA LOADING ====================
    async loadInitialData() {
        // Load investment plans
        await this.loadInvestmentPlans();
        
        // Check for referral code in URL
        this.checkReferralFromURL();
        
        // Initialize animations
        this.initAnimations();
    },

    async loadInvestmentPlans() {
        try {
            console.log(' Loading investment plans...');
            const response = await this.apiRequest('/api/plans', { background: true });
            
            if (response.success && response.data && response.data.plans) {
                this.state.investmentPlans = response.data.plans;
                this.renderInvestmentPlans();
                console.log(` Loaded ${this.state.investmentPlans.length} investment plans`);
            } else {
                // Fallback to default plans
                console.log(' Using default investment plans');
                this.state.investmentPlans = this.getDefaultPlans();
                this.renderInvestmentPlans();
            }
        } catch (error) {
            console.error(' Failed to load investment plans:', error);
            this.state.investmentPlans = this.getDefaultPlans();
            this.renderInvestmentPlans();
        }
    },

    getDefaultPlans() {
        return [
            {
                _id: '1',
                name: 'Cocoa Beans',
                description: 'Invest in premium cocoa beans with stable returns',
                min_amount: 3500,
                daily_interest: 10,
                total_interest: 300,
                duration: 30,
                risk_level: 'low',
                raw_material: 'Cocoa',
                category: 'agriculture',
                is_popular: true,
                features: ['Low Risk', 'Stable Returns', 'Beginner Friendly', 'Daily Payouts'],
                color: '#10b981',
                icon: ''
            },
            {
                _id: '2',
                name: 'Gold',
                description: 'Precious metal investment with high liquidity',
                min_amount: 50000,
                daily_interest: 15,
                total_interest: 450,
                duration: 30,
                risk_level: 'medium',
                raw_material: 'Gold',
                category: 'metals',
                is_popular: true,
                features: ['Medium Risk', 'Higher Returns', 'High Liquidity', 'Market Stability'],
                color: '#fbbf24',
                icon: ''
            },
            {
                _id: '3',
                name: 'Crude Oil',
                description: 'Energy sector investment with premium returns',
                min_amount: 100000,
                daily_interest: 20,
                total_interest: 600,
                duration: 30,
                risk_level: 'high',
                raw_material: 'Crude Oil',
                category: 'energy',
                features: ['High Risk', 'Maximum Returns', 'Premium Investment', 'Energy Sector'],
                color: '#dc2626',
                icon: ''
            }
        ];
    },

    renderInvestmentPlans() {
        const containers = [
            document.getElementById('plans-container'),
            document.getElementById('investment-plans-list')
        ];

        containers.forEach(container => {
            if (!container) return;

            container.innerHTML = this.state.investmentPlans.map(plan => `
                <div class="plan-card card-hover">
                    ${plan.is_popular ? '<div class="plan-badge">Most Popular</div>' : ''}
                    <div class="plan-header">
                        <h3 class="plan-name">${plan.name}</h3>
                        <div class="plan-icon">${plan.icon || ''}</div>
                        <div class="plan-price">${(plan.min_amount || 0).toLocaleString()}+</div>
                        <div class="plan-period">Minimum Investment</div>
                    </div>
                    <div class="plan-features">
                        ${(plan.features || []).map(feature => `
                            <div class="plan-feature">
                                <i class="fas fa-check-circle"></i>
                                <span>${feature}</span>
                            </div>
                        `).join('')}
                        <div class="plan-feature">
                            <i class="fas fa-chart-line"></i>
                            <span>Daily Returns: ${plan.daily_interest || 0}%</span>
                        </div>
                        <div class="plan-feature">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Duration: ${plan.duration || 0} Days</span>
                        </div>
                        <div class="plan-feature">
                            <i class="fas fa-shield-alt"></i>
                            <span>Risk Level: ${plan.risk_level || 'Medium'}</span>
                        </div>
                    </div>
                    <div class="plan-description">${plan.description || ''}</div>
                    <button class="btn btn-primary plan-button" onclick="app.openInvestmentModal('${plan._id}')">
                        Invest Now
                    </button>
                </div>
            `).join('');
        });
    },

    checkReferralFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const referralCode = urlParams.get('ref');
        if (referralCode && document.getElementById('referral')) {
            document.getElementById('referral').value = referralCode;
            
            // Track referral source
            localStorage.setItem('referral_source', referralCode);
        }
    },

    initAnimations() {
        if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate');
                        observer.unobserve(entry.target);
                    }
                });
            }, { 
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            document.querySelectorAll('.feature, .plan-card, .step, .testimonial-card').forEach(el => {
                observer.observe(el);
            });
        }
    },

    // ==================== IDLE TIMEOUT HANDLING ====================
    handleIdleTimeout() {
        console.log(' User idle for 30 minutes');
        
        // Show idle notification
        if (this.state.isAuthenticated) {
            this.showToast('You have been idle for 30 minutes. Session will remain active.', 'info', 5000);
        }
    },

    // ==================== ADDITIONAL FUNCTIONS ====================
    // These functions are placeholders that need to be implemented based on your backend
    async handleDeposit(e) {
        e.preventDefault();
        // Implement deposit handling
        this.showToast('Deposit functionality would be implemented here', 'info');
    },

    async handleProfileUpdate(e) {
        e.preventDefault();
        // Implement profile update
        this.showToast('Profile update functionality would be implemented here', 'info');
    },

    async handleBankUpdate(e) {
        e.preventDefault();
        // Implement bank update
        this.showToast('Bank update functionality would be implemented here', 'info');
    },

    async handleKYCSubmission(e) {
        e.preventDefault();
        // Implement KYC submission
        this.showToast('KYC submission functionality would be implemented here', 'info');
    },

    async handleSupportRequest(e) {
        e.preventDefault();
        // Implement support request
        this.showToast('Support request functionality would be implemented here', 'info');
    },

    async handlePasswordReset(e) {
        e.preventDefault();
        // Implement password reset
        this.showToast('Password reset functionality would be implemented here', 'info');
    },

    async handlePasswordChange(e) {
        e.preventDefault();
        // Implement password change
        this.showToast('Password change functionality would be implemented here', 'info');
    },

    async handlePreferencesUpdate(e) {
        e.preventDefault();
        // Implement preferences update
        this.showToast('Preferences update functionality would be implemented here', 'info');
    },

    async showTwoFactorPrompt() {
        // Implement 2FA prompt
        this.showToast('Two-factor authentication would be implemented here', 'info');
    },

    async updateInvestmentsDisplay(investments) {
        // Implement investments display update
        const container = document.getElementById('active-investments-list');
        if (container) {
            // Update investments display
        }
    },

    createAdvancedCharts(stats) {
        // Implement advanced chart creation
        // This would create performance charts, growth charts, etc.
    },

    async loadNotifications() {
        // Implement notifications loading
    },

    updateNotificationBadges() {
        // Implement notification badge updates
    },

    async loadAdminData() {
        // Implement admin data loading
        if (this.state.isAdmin) {
            // Load admin-specific data
        }
    }
};

// ==================== GLOBAL EVENT HANDLERS ====================
window.addEventListener('DOMContentLoaded', function() {
    console.log(' DOM fully loaded and parsed');
    app.init();
});

window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        app.closeModal(event.target.id);
    }
};

document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (modal.style.display === 'flex') {
                app.closeModal(modal.id);
            }
        });
    }
});

// Auto-refresh dashboard every 5 minutes when on dashboard
setInterval(() => {
    if (app.state.isAuthenticated && !app.state.isAdmin && 
        app.getCurrentPage() === 'dashboard') {
        console.log(' Scheduled dashboard refresh...');
        app.updateDashboard();
    }
}, 300000); // 5 minutes

// Auto-refresh admin data every 5 minutes when on admin page
setInterval(() => {
    if (app.state.isAdmin && app.getCurrentPage() === 'admin') {
        console.log(' Scheduled admin data refresh...');
        app.loadAdminData();
    }
}, 300000); // 5 minutes

// Check for daily interest every hour (as backup)
setInterval(() => {
    if (app.state.isAuthenticated) {
        const now = new Date();
        const utcHours = now.getUTCHours();
        const utcMinutes = now.getUTCMinutes();
        
        // Check if it's around midnight UTC (with some tolerance)
        if (utcHours === 0 && utcMinutes < 10) {
            console.log(' Checking for daily interest (backup)...');
            app.checkAndShowDailyInterest();
        }
    }
}, 60 * 60 * 1000); // 1 hour

// Refresh token every 12 hours
setInterval(() => {
    if (app.state.isAuthenticated) {
        console.log(' Refreshing authentication token...');
        app.refreshTokenSilently();
    }
}, 12 * 60 * 60 * 1000); // 12 hours

// Clear old cache periodically
setInterval(() => {
    console.log(' Cleaning old cache...');
    
    // Clear cache older than 7 days
    const oneWeekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
    
    ['user_cache_timestamp', 'dashboard_cache_timestamp', 'referrals_cache_timestamp', 
     'transactions_cache_timestamp'].forEach(key => {
        const timestamp = localStorage.getItem(key);
        if (timestamp && parseInt(timestamp) < oneWeekAgo) {
            localStorage.removeItem(key.replace('_timestamp', ''));
            localStorage.removeItem(key);
        }
    });
}, 24 * 60 * 60 * 1000); // 24 hours</script>
</body>
</html>
